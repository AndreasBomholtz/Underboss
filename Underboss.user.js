// ==UserScript==
// @name        The Underboss
// @namespace   Underboss
// @author      MrAnderson
// @description A bot for the game The Godfather from kabam.com
// @include     https://www.kabam.com/games/the-godfather/play*
// @include     https://www.kabam.com/*/games/the-godfather/play*
// @include     https://*godfather.*.com/platforms/kabam/game*
// @version     2.0.5
// @grant       GM_addStyle
// @downloadURL https://raw.githubusercontent.com/AndreasBomholtz/Underboss/master/Underboss.user.js
// ==/UserScript==
function combine(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];if(void 0!==e)for(var s=Object.keys(e),n=0;n<s.length;n++){var a=s[n];t[a]=e[a]}}return t}function convertToSource(t){var i,e=[],s=[];if("object"==typeof t&&void 0==t.join){e.push("{");for(i in t)s.push(i+": "+convertToSource(t[i]));e.push(s.join(",")),e.push("}")}else if("object"==typeof t&&void 0!=t.join){e.push("[");for(var n=0;n<t.length;n++)s.push("'"+t[n]+"'");e.push(s.join(",")),e.push("]")}else if("function"==typeof t){var a=t.toString();-1!=a.indexOf("random")||e.push(a)}else e.push(JSON.stringify(t));return e.join("")}function inject(t){var i=document.createElement("script");i.innerHTML=t,i.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(i)}var attackUnits={g:{type:"Basic",h:"All",i:!0,j:{k:750,l:281,m:563,o:281,p:10},q:2250},s:{type:"Basic",h:"All",i:!0,t:{u:{v:1},A:{B:2}},j:{k:1100,l:825,m:413,o:413,p:10},q:3300},C:{type:"Intermediate",h:"All",i:!0,t:{u:{D:4},A:{F:3,B:3}},j:{k:1700,l:638,m:1274,o:638,p:20},q:5100},G:{type:"Intermediate",h:"All",i:!0,t:{u:{H:6},A:{I:3,B:4}},j:{k:2700,l:2025,m:1013,o:1013,p:20},q:8100},J:{type:"Advanced",h:"All",i:!0,t:{u:{H:7,D:7},A:{B:6,I:5,F:5}},j:{k:3800,l:1900,m:1900,o:1900,p:30}},K:{type:"Advanced",h:"All",i:!0,t:{u:{D:8},A:{F:6,B:7}},j:{k:5700,l:2138,m:4250,o:2138,p:30},q:17100},L:{type:"Expert",h:"All",i:!0,t:{u:{H:10},A:{I:6,B:8}}},M:{type:"Expert",h:"All",i:!0,t:{u:{D:12},A:{F:9,B:9}}},N:{type:"Elite",h:"All",i:!0,t:{u:{H:14,D:14},A:{B:9,I:9,F:9}},q:46800},O:{type:"Elite",h:"All",i:!0,t:{u:{H:16,P:17},A:{I:9,B:9}}},R:{type:"Femme Fatale",h:"All",i:!0,t:{u:{H:17},A:{B:9,I:9}},q:56628},S:{type:"Femme Fatale",h:"All",i:!0,t:{u:{D:17},A:{B:9,F:9}},q:56628},T:{type:"Normal",h:"All",i:!0,j:{k:500,l:188,m:188,o:375,p:10}},U:{type:"Normal",h:"All",i:!0,t:{u:{V:6,W:8},A:{B:5,F:2}}},X:{},Y:{type:"Pulitori",h:"LittleItaly",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},_:{type:"Pulitori",h:"Queens",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},aa:{type:"Pulitori",h:"GreenwichVillage",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ba:{type:"Pulitori",h:"Brooklyn",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ca:{type:"Pulitori",h:"ParkAve",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},da:{type:"Pulitori",h:"AtlanticCity",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ea:{type:"Pulitori",h:"Chinatown",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},fa:{type:"Pulitori",h:"Capital",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ga:{type:"Pulitori",h:"Harlem",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ha:{type:"Johnney Law",i:!0,h:"Queens",t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ia:{type:"Johnney Law",i:!0,h:"GreenwichVillage",t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ja:{type:"Johnney Law",i:!0,h:"LittleItaly",t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ka:{type:"Johnney Law",h:"Brooklyn",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},la:{type:"Johnney Law",h:"ParkAve",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ma:{type:"Johnney Law",h:"Chinatown",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},na:{type:"Johnney Law",i:!0,h:"AtlanticCity",t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},oa:{type:"Johnney Law",h:"Harlem",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},pa:{type:"Clean-up Crew",q:75e3},qa:{type:"Clean-up Crew",q:75e3},ra:{type:"Clean-up Crew",q:75e3},sa:{type:"Clean-up Crew",q:75e3},ta:{type:"Clean-up Crew",q:75e3},ua:{type:"Clean-up Crew",q:75e3},va:{type:"Clean-up Crew",q:75e3},wa:{i:!1},xa:{i:!1},ya:{i:!1},za:{i:!1},Aa:{i:!1},Ba:{i:!1},Ca:{i:!1},Da:{i:!1},Ea:{i:!1},Fa:{i:!1},Ga:{i:!1},Ha:{i:!1}},buildings={Ia:{Ja:1,j:{k:600,l:200,m:200,o:500}},Ka:{Ja:1,j:{k:600,l:200,m:500,o:200}},La:{Ja:1,j:{k:600,l:500,m:200,o:200}},Ma:{Ja:6,j:{k:500,l:100,m:100,o:100}},B:{j:{k:1200,l:500,m:500,o:500}},Na:{Oa:1,t:{A:{5:{Pa:5},7:{Pa:7},8:{Pa:8}}},j:{k:2500,l:300,m:300,o:300}},Qa:{Oa:2,j:{k:2500,l:1500,m:200,o:200}},Ra:{t:{Sa:4},j:{k:1500,l:1e3,m:300,o:300}},F:{t:{A:{2:{Ka:5}},Sa:9},j:{k:2e3,l:300,m:1e3,o:300}},Ta:{t:{Sa:3},j:{k:3e3,l:300,m:300,o:1e3}},I:{t:{Sa:7},j:{k:3e3,l:300,m:1e3,o:300}},Ua:{t:{Sa:6},j:{k:2e3,l:500,m:300,o:300}},Pa:{j:{k:6e3,l:1e3,m:1e3,o:1e3}},Va:{t:{A:{0:{Ia:3}},Sa:8},j:{k:1500,l:300,m:300,o:1e3}},Wa:{t:{Sa:3},j:{k:3e3,l:300,m:300,o:1e3}},Xa:{t:{Sa:5},j:{k:1500,l:500,m:1500,o:500}},Ya:{Oa:2,t:{A:{2:{Ua:3}}},j:{k:3e3,l:300,m:300,o:1e3}}},defenseUnits={Za:{h:"All",i:!0,t:{u:{v:4},A:{Va:2,Pa:2}},j:{k:1700,l:638,m:638,o:1275}},$a:{h:"All",i:!0,t:{u:{v:8},A:{Va:4,Pa:4}},j:{k:1700,l:638,m:638,o:1275}},_a:{h:"All",i:!0,t:{u:{v:12},A:{Va:6,Pa:6}}},ab:{h:"All",i:!0,t:{u:{v:14},A:{Va:7,Pa:7}}},bb:{h:"All",i:!0,t:{u:{v:16},A:{Va:8,Pa:8}}},cb:{h:"All",i:!0,t:{u:{v:18},A:{Va:9,Pa:9}}},eb:{h:"Capital",i:!0,t:{u:{Z:16,$:16},A:{B:10,Va:10,Pa:10}}},fb:{i:!1},gb:{i:!1},hb:{i:!1}},items={ib:{j:1},jb:{j:3},kb:{j:5},lb:{j:10},mb:{j:15},nb:{j:40},ob:{j:65},pb:{j:95},qb:{j:10},rb:{j:7},sb:{j:7},tb:{j:7},ub:{j:35},vb:{j:35},wb:{j:40},xb:{j:40},yb:{j:40},zb:{j:25},Ab:{j:40},Bb:{j:10},Cb:{j:35},Db:{j:35},Eb:{j:30},Fb:{j:7},Gb:{j:9},Hb:{j:25},Ib:{j:5},Jb:{j:10},Kb:{j:2},Lb:{j:10},Mb:{j:150},Nb:{j:300},Ob:{j:300},Pb:{j:35},Qb:{j:35},Rb:{j:40},Sb:{j:40},Tb:{j:40},Ub:{j:40},Vb:{j:1,Wb:!0},Xb:{j:2,Wb:!0},Yb:{j:5,Wb:!0},Zb:{j:1,Wb:!0},$b:{j:2,Wb:!0},_b:{j:2,Wb:!0},ac:{j:5,Wb:!0},bc:{j:9,Wb:!0},cc:{j:1,Wb:!0},dc:{j:1,Wb:!0},ec:{j:3,Wb:!0},fc:{j:5,Wb:!0},gc:{j:6,Wb:!0},hc:{j:1,Wb:!0},ic:{j:2,Wb:!0},jc:{j:3,Wb:!0},kc:{j:4,Wb:!0},lc:{j:5,Wb:!0},mc:{j:5},nc:{j:5},oc:{j:5},pc:{j:5},qc:{j:5},rc:{j:5},sc:{j:5},tc:{j:5},uc:{j:5},vc:{j:5},wc:{j:5},xc:{j:5},yc:{j:5},zc:{j:5},Ac:{j:20},Bc:{j:20},Cc:{j:5},Dc:{j:5},Ec:{j:40},Fc:{j:95},Gc:{j:12},Hc:{j:10},Ic:{j:20},Jc:{j:35},Kc:{j:40},Lc:{j:75},Mc:{j:35},Nc:{j:40},Oc:{j:60},Pc:{j:75},Qc:{j:30},Rc:{j:30},Sc:{j:30},Tc:{j:30},Uc:{j:30},Vc:{j:30},Wc:{j:30},Xc:{j:30},Yc:{j:30},Zc:{j:30},$c:{j:5,Wb:!0},_c:{j:10,Wb:!0},ad:{j:9,Wb:!0},bd:{j:9,Wb:!0}},research={W:{Oa:4,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:250,l:175,m:175,o:175}},dd:{Oa:5,t:{u:["Capacity"],A:"Garage"},j:{k:400,l:200,m:200,o:200}},ed:{Oa:2,t:{u:["Logistics"],A:"CementFactory"},j:{k:150,l:100,m:100,o:200}},fd:{Oa:4,t:{u:["Maneuver"]},j:{k:400,l:200,m:200,o:200}},P:{Oa:2,t:{u:["Logistics"],A:"Restaurant"},j:{k:150,l:200,m:100,o:100}},H:{Oa:5,t:{u:["Capacity"],A:"Hideout"},j:{k:400,l:200,m:200,o:200}},v:{Oa:1,t:{u:[],A:"Library"},j:{k:225,l:150,m:300,o:150}},gd:{Oa:3,t:{u:["Spying"],A:"Garage"},j:{k:250,l:175,m:175,o:175}},V:{Oa:4,t:{u:["Trafficking"]},j:{k:250,l:175,m:175,o:175}},Z:{Oa:6,t:{u:["Construction","Corruption"]},j:{k:500,l:250,m:250,o:250}},$:{Oa:6,t:{u:["Proficiency","Mechanics"],hd:"GaurdPost"},j:{k:500,l:250,m:250,o:250}},D:{Oa:5,t:{u:["Mechanics"],A:"Workshop"},j:{k:400,l:200,m:200,o:200}},jd:{Oa:2,t:{u:["Logistics"]},j:{k:200,l:150,m:150,o:150}},kd:{Oa:2,t:{u:["Logistics"],A:"SteelMill"},j:{k:150,l:100,m:200,o:100}},ld:{Oa:3,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:200,l:150,m:150,o:150}}},css=".panel,.hiddenPanel{background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');border:1px solid darkred;color:white;position:absolute;top:0;right:0;width:300px;height:688px;z-index:10}.hiddenPanel{height:25px}.header{background-color:darkred;color:white;width:100%;height:25px;text-align:center;font-size:150%;font-weight:bold}.info{width:295px;height:260px}.textinfo{width:295px;height:95px}.prize_info{width:295px;height:200px}div.option{width:110px;float:left}div.stats{width:100%}input.button{background-color:darkred;color:white;border-color:red}.tab-box{border-bottom:1px solid darkred;padding-bottom:5px;margin-top:5px}.tab-box a{border:1px solid red;color:white;padding:5px 5px;text-decoration:none;background-color:darkred}.tab-box a.activeLink{background-color:red;border-bottom:0;padding:6px 5px;border-color:darkred}.tabcontent{border:1px solid darkred;border-top:0;overflow-y:auto;height:430px}.hide{display:none}.unit_count{width:25px}input.number{width:35px;margin-right:5px}h7{font-weight:bold;display:block}.overlay{position:absolute;top:50%;left:50%;width:930px;height:640px;margin-left:-1120px;margin-top:-335px;background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');color:white;text-align:center;border-radius:5px;z-index:20;box-shadow:0 0 0 9999px rgba(0,0,0,0.5)}#overview table{width:100%;text-align:left}#overview #total{border-top:double;border-bottom:solid}input.close{position:absolute;top:0;right:0}",armorBot={md:function(){this.trace(),this.nd(this.od)},od:function(t){if(this.trace(),!t||t.armory)return void this.debugArmor("City do not have armor",t);for(var i=0;i<t.pd.length;i++){var e=t.pd[i].equipped_armory_item.item_id;this.debugArmor("Has item id "+e,t);var s=this.qd(e);s?this.debugArmor(s[0]+" ("+s[1]+") Lvl "+s[2]):this.debugArmor(e+" not found",t)}},qd:function(t){return 31>t?t>20?["Piano Wire","Gold",t-19]:t>10?["Stilettos","Silver",t-9]:["Bat","Bronze",t]:61>t?t>50?["Tommy Gun","Gold",t-49]:t>40?["Magnum","Silver",t-39]:["Molotov","Bronze",t-29]:91>t?t>80?["Italian Suit","Gold",t-79]:t>70?["Fedora","Silver",t-69]:["Scarf","Bronze",t-59]:t>110?["Caddy","Gold",t-109]:t>100?["Speedster","Silver",t-99]:["Motorcycle","Bronze",t-89]}},attackBot={rd:function(){this.trace(),this.options.sd=3,this.options.td={},this.ud()},ud:function(){if(this.trace(),!this.vd||!this.vd[0]||!this.vd[0].data)return void setTimeout(this.bind(this.ud),1e3);this.options.sd+=2;var t=10*((this.options.sd-1)/2);this.options.td||(this.options.td={}),this.nd(function(i){var e=i.x-t;0>e&&(e=750+e);var s=i.y-t;0>s&&(s=750+s);for(var n=0;n<this.options.sd;n++)for(var a=0;a<this.options.sd;a++){var o=(e+10*n)%750,h=(s+10*a)%750;this.options.td[o]||(this.options.td[o]={}),this.options.td[o][h]?this.debugAttack("Not reloading ("+o+","+h+")"):(this.options.td[o][h]=!0,this.debugAttack("Get map ("+o+","+h+")"),this.wd("Get map ("+o+","+h+")","map.json","x="+o+"&y="+h,i,this.bind(this.xd)))}}),this.yd()},zd:function(t,i){this.trace(),this.debugAttack("FindBestGang for "+t.type+" with lvl "+i);var e=new Date,s={Ad:0},n=1e3;for(var a in this.options.map)for(var o in this.options.map[a]){var h=this.options.map[a][o];if(h.Ad!=i&&i>1&&h.Ad!=i-1)this.debugAttack("Gang has wrong level ("+h.Ad+" != "+i,t);else if(s.Ad>h.Ad)this.debugAttack("Selected gang is better ("+s.Ad+" > "+h.Ad+")",t);else if(h.Bd&&h.Bd>=e.getTime())this.debugAttack("Gang already attacked",t);else{var r=Math.abs(a-t.x);r>250&&(r=Math.abs(750-r));var d=Math.abs(o-t.y);d>250&&(d=Math.abs(750-d)),r+d>n&&s.Ad===h.Ad?this.debugAttack("Selected gang is closer",t):(n=r+d,s=h,this.debugAttack("Found better Gang "+s.Ad+" at ("+a+","+o+") with dist ("+r+" + "+d+") = "+n,t))}}return s},Cd:function(){this.trace();var t=6e4,i=new Date;return this.options.map?this.vd&&this.options.Dd?(this.nd(function(e){if(e.Ed<=1)return void this.debugAttack("No more energy",e);if("DoriaAirport"==e.type)return void this.debugAttack(e.type+" is not attackable",e);for(var s={Fd:0},n=0;n<this.options.Dd.length;n++){var a=this.options.Dd[n];if(this.debugAttack("Order: "+a.Fd+" City: "+a.h+" Units: "+a.units,e),a.h&&"all"!=a.h&&a.h!=e.type)this.debugAttack("Wrong city ("+a.h+" != "+e.type+")",e);else{var o=!0,h=JSON.parse(a.units);for(var r in h)if(!e.units[r]||e.units[r]<h[r]){this.debugAttack("Do not have "+r+" ("+h[r]+")",e),o=!1;break}if(o){var d=parseInt(s.Fd,10),u=parseInt(a.Fd,10);u>d&&(s=a)}}}if(s.units){var l=this.zd(e,s.Fd);if(0===l.Ad)return void this.debugAttack("Failed to find a gang to attack",e);this.debugAttack("Attack "+l.Ad+" Gang at ("+l.x+","+l.y+")",e),l.Ad<=10&&(l.Bd=i.getTime()+18e5);var f=s.units;s.Gd&&(f=this.Hd(e)),this.attack(l.x,l.y,f,e),t=6e5,this.yd()}}),t):(this.debugAttack("City or orders not ready"),1e4):(this.ud(),1e4)},Hd:function(t){if(this.trace(),t&&t.units){var i=jQuery.extend(!0,{},t.units);for(var e in this.Id)i[e]&&delete i[e];var s=0;for(var n in i)s>=t.Jd?delete i[n]:(i[n]>t.Jd-s&&(i[n]=t.Jd-s),this.debugAttack("Add attack units "+n+" => "+i[n]+" ("+s+"/"+t.Jd+")",t),s+=i[n]);return JSON.stringify(i)}return""},attack:function(t,i,e,s){this.trace(),this.Kd("Attack ("+t+","+i+") from "+s.type,"cities/"+s.id+"/marches.json","_method=post&march[x]="+t+"&march[y]="+i+"&march[units]="+e,s),this.Ld("Attack",1)}},bailoutBot={Md:function(){this.trace(),this.nd(function(t){"DoriaAirport"!=t.type&&this.Nd("Update bail","cities/"+t.id+"/cash_jail.json","",t)})},Od:function(t){if(this.trace(),!t||t.q)return void this.debugBailout("No city or bailout",t);var i=0;t.Pd?i=parseInt(t.Pd.k,10):this.debugBailout("No resources",t);var e="",s="",n=0;for(var a in t.q){var o=0;if(this.Qd[a]&&this.Qd[a].q){var h=this.Qd[a].q,r=parseInt(t.q[a],10),d=h*r;this.debugBailout(a+" costs "+d+" and all units costs "+n+" and I have "+i,t);var u=parseInt((i-n)/h,10);if(u>0){u=u>r?r:u;var l=u*h;this.debugBailout("I can affort "+u+" "+a+" because it cost "+l+" and I have "+(i-n)+" ("+i+")",t),o=u,n+=l}else this.debugBailout("Can't affort "+a+" because it cost "+h+" and I have "+(i-n)+" ("+i+")",t)}else this.debug("Missing bailout for "+a,t);o>0&&(e+="&units["+a+"]="+o,s+=o+" "+a+", ")}t.q={},""!==e?(this.debugBailout(s,t),this.Kd("Pay Bailout in "+t.type,"cities/"+t.id+"/cash_jail/bail.json","payment_method=cash"+e,t)):this.debugBailout("No bailout data to send",t)}},bondsBot={Rd:function(){if(this.debugBonds("Get Bonds"),this.vd){var t=this.vd[0];this.Nd("Get Bonds","bonds.json","action=index",t)}},Sd:function(){if(this.debugBonds("Handle bonds"),this.vd){var t=this.vd[0];this.Kd("Collect Bonds","bonds/redeem.json","action=index",t)}}},bot={Td:{Ud:{},hd:{},Vd:{},Wd:{},Xd:{},Yd:{},Zd:{},$d:{},_d:{},ae:{},Ya:{},be:{event:"player:items"},ce:{},de:{},ee:{},fe:{event:"city:armor:update"}},ge:function(t){this["changeEnable"+t]=function(){this.options["enable"+t]=this.he["enable_"+t].checked,this.yd(),this.debug("Enable "+t+": "+this.options["enable"+t])}},ie:function(t,i){i.event?this.je(i.event,function(i,e){this.vd&&this.options["enable"+t]&&this["do"+t+"Event"](e)}):(this["auto"+t+"Thread"]=function(){var i=this.bind(this["auto"+t+"Thread"]),e=6e4;if(this.vd&&this.options["enable"+t]){var s=this["do"+t]();s&&(e=s)}setTimeout(i,e)},this["auto"+t+"Thread"]())},ke:function(t){if(!this.vd)return void 0;for(var i=0;i<this.vd.length;i++)if(this.vd[i].id==t)return this.vd[i];return void 0},Ld:function(t,i){this.options.le||(this.options.le={}),this.options.le[t]||(this.options.le[t]=0),this.options.le[t]+=i,this.yd(),this.me()},ne:function(t,i,e){if(this.trace(),!t||!t.oe)return!1;for(var s=!0,n=0;n<t.oe.length;n++)if(void 0===e){if(t.oe[n].pe&&t.oe[n].pe===i){s=!1;break}}else if(t.oe[n].qe&&t.oe[n].qe===e){s=!1;break}if(s){var a=new Date,o=a.getTime(),h={re:o};void 0===e?h.pe=i:h.qe=e,t.oe.push(h)}return s},se:function(t){if(this.trace(),t&&t.id){var i="unknown";t.type&&(i=t.type),this.te("Load city "+i,"cities/"+t.id+".json","",t),this.te("Load city "+i+" neighborhood","cities/"+t.id+"/neighborhood_buildings.json","",t);var e=new Date;t.ue=e.getTime()}},ve:function(){this.trace(),this.nd(function(t){this.se(t)})},we:function(){this.trace(),this.nd(function(t){var i=new Date;(!t.ue||t.ue<i.getTime()+300)&&this.se(t)})},xe:function(){this.trace(),this.nd(function(t){this.ye("Load Game Data","player/game_loaded.json","_method=put",t)}),this.ve()},ze:function(){this.trace(),this.te("Load Player","player.json")},Ae:function(){this.trace();var t=this.bind(this.xe);this.te("Load Player Init","player.json","",void 0,t)},Be:function(t){this.trace(),"building"==t&&this.options.enableBuild?this.ve():"research"==t&&this.options.enableResearch?this.Ce():"units"==t&&this.options.enableTrain?this.De():"defense_units"==t&&this.options.enableDefense?this.Ee():-1!=t.indexOf("collect")&&this.options.enableCollect&&this.Fe()},Ge:function(){var t=this.bind(this.main),i=1e3;if(this.vd)for(var e=new Date,s=e.getTime()/1e3,n=0;n<this.vd.length;n++){var a=this.vd[n];if(a&&a.oe)for(var o=0;o<a.oe.length;o++){var h=a.oe[o],r=h.re+this.He;if(s>=r){this.se(a),a.oe.splice(o,1),i=1e4,this.Be(h.pe);break}}}setTimeout(t,i)},init:function(t){this.Ie(),this.pe=[],this.Je=[],this.Ke=[],this.Le="data",this.Me={},this.he={},this.Ne=!1,this.Oe=t.apiServer+"/",this.Oe=this.Oe.replace("http","https"),this.Pe=t.Qe,this.Re=t.sessionId,this.Se=t.Te,this.Sa=t.Sa;for(var i in this.Td)this.ie(i,this.Td[i]),this.ge(i),this.Ue(i),this.Ve(i);this.Ae(),this.We&&this.We();var e=this.bind(this.Xe);void 0===this.options.Ye&&(this.options.Ye=800,this.yd()),setInterval(e,this.options.Ye);var s=this.bind(this.we);setInterval(s,6e4),this.Ge(),this.Ze()},start:function(){"undefined"!=typeof C?this.init(C.attrs):window.setTimeout(this.bind(this.start),1e3)}},buildBot={$e:function(t,i){var e=0;return this._e(function(i,s){if(s.af)for(var n=s.af,a=0;a<n.length;a++)n[a].type==t&&e<n[a].level&&(e=n[a].level)}),e},bf:function(t,i){this.trace();var e=0;if(t&&t.af)for(var s=t.af,n=0;n<s.length;n++)"neighborhood"==s[n].location&&(void 0!==i||s[n].hasOwnProperty("unlocked")||"Exchange"==s[n].type?s[n].type==i&&e++:e++);return e},cf:function(t){this.trace();var i=[],e=0;for(e=0;45>e;e++)i[e]=!0;if(t&&t.af)for(var s=t.af,n=0;n<s.length;n++)s[n].hasOwnProperty("slot")&&"neighborhood"==s[n].location&&(i[s[n].df]=!1);for(e=0;e<i.length;e++)if(i[e])return e;return 0},ef:function(t,i){return i*Math.pow(2,t-1)},ff:function(t,i,e,s,n){if(e&&t&&t.Pd){var a=t.Pd;for(var o in e){var h=0;if(h=n?n(parseInt(s,10),e[o]):e[o]*s,h>parseInt(a[o],10))return void 0===n?this.debugTrain("Can't train "+i+" because "+o+" ("+h+") is more then "+a[o],t):n==this.ef?this.debugBuild("Can't build "+i+" because "+o+" ("+h+") is more then "+a[o],t):this.debugResearch("Can't research "+i+" because "+o+" ("+h+") is more then "+a[o],t),!1}for(var r in e){var d;d=n?n(parseInt(s,10),e[r]):e[r]*s,t.Pd[r]=parseInt(t.Pd[r],10)-d}}else e?void 0===n?this.debugTrain("Missing city data"):n==this.ef?this.debugBuild("Missing city data"):this.debugResearch("Missing city data"):void 0===n?this.debugTrain("Missing cost for "+i):n==this.ef?this.debugBuild("Missing cost for "+i):this.debugResearch("Missing cost for "+i);return!0},gf:function(t){if(this.trace(),t&&t.af&&t.h){var i=t.h;if("DoriaAirport"==i.type)return this.debugBuild("Do not build new building in Doria Airport",i),!1;var e=this.$e("Mansion",t.h),s=3*e+10,n=this.bf(t);if(this.debugBuild("Man Level: "+e+" Total building: "+n+" => "+s,i),s>n){var a=this.cf(t),o="Hideout";for(var h in this.af){var r=this.af[h],d=0;if(this.options.A[h]?d=this.options.A[h]:r.Ja&&(d=r.Ja),d){var u=this.bf(t,h);if(d>u){var l=r.j;if(!this.ff(i,h,l,1,this.ef))continue;o=h;break}}}this.hf("Build new "+o+" at slot "+a,i);var f="_method=post&city_building[building_type]="+o;return f+="&city_building[include_requirements]=false&city_building[instant_build]=false",f+="&city_building[neighborhood_id]="+t.id+"&city_building[slot]="+a,this.Kd("Build new "+o+" at slot "+a+" in "+i.type,"cities/"+i.id+"/buildings.json",f,i),this.Ld("Build",1),t.af.push({df:a,location:"neighborhood",type:o}),!0}this.debugBuild("No more slots for new buildings ("+s+")",i)}else this.debugBuild("Can't find neighborhood or buildings",i);return!1},if:function(t,i){this.trace();for(var e=["Hideout","Apartment"],s=0;s<e.length;s++){var n=e[s],a=this.$e(n,t.h);if(9>a&&t&&t.af)for(var o=t.af,h=0;h<o.length;h++){var r=o[h];if(r.type==n&&r.level==a)return i.Ad=r.level,i.id=r.id,i.name=r.type,i.location=r.location,this.debugBuild("Build Importent "+i.name,t.h),i}}return this.debugBuild("Failed to find impotent building",t.h),i},jf:function(t){if(this.trace(),this.gf(t))return!0;var i={};if(i.Ad=20,i.id="",i.location="",!t||!t.af)return!1;for(var e=t.af,s=t.h,n=0;n<e.length;n++){var a=e[n];if(!(a.hasOwnProperty("unlocked")||a.level>=9)){var o=!0,h=this.af[a.type];if(h&&h.t){var r=h.t;if(r.A){var d=r.A[a.level];if(d)for(var u in d){var l=this.$e(u,t.h);if(l<d[u]){this.debugBuild("Can't build "+a.type+" because "+u+" is not "+d[u],s),o=!1;break}this.debugBuild(a.type+" has req "+u+" ("+d[u]+") and it is "+l,s)}}if(r.Sa&&r.Sa>this.kf){this.debugBuild("Can't build "+a.type+" because gangster is not "+r.Sa,s),o=!1;break}r.Sa&&this.debugBuild(a.type+" has gangster "+r.Sa+" and we are "+this.kf,s)}else this.debugBuild(a.type+" has no requirements",s);o&&h&&h.j?this.ff(s,a.type,h.j,a.level,this.ef)?this.debugBuild("Lots of resources",s):o=!1:o&&this.debugBuild("Not cost info for "+a.type,s),o&&(i.Ad>a.level||a.level>3&&i.Ad==a.level&&"neighborhood"==i.location)&&(i.Ad=a.level,i.id=a.id,i.name=a.type,i.location=a.location,i.lf=a)}}if(20!=i.Ad){if(i.Ad>5){var f=this.if(t,i);if(!f)return this.debugBuild("Faild to find a building",s),!1;this.af[f.name]?this.ff(s,f.name,this.af[f.name].j,f.Ad,this.ef)?i=f:this.debugBuild("Do not upgrade importent building, not egnogh rescources",s):this.debug("Missing info for: "+f.name,s)}return this.hf("Build "+i.name+" "+(i.Ad+1),s),this.Kd("Build "+i.name+" "+(i.Ad+1)+" in "+s.type,"cities/"+s.id+"/buildings/"+i.id+".json","_method=put",s),i.lf.level++,!0}return!1},mf:function(){if(this.trace(),this.vd)for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if("DoriaAirport"==i.type)return void this.debugBuild("Build is disabled for Doria Airport",i);var e=this.ne(i,"building");if(e)if(i.nf)for(var s=0;s<i.nf.length&&!this.jf(i.nf[s]);s++);else this.debugBuild("Neighborhood not ready",i);else this.debugBuild("Build queue not ready",i)}else this.debugBuild("Cities not ready")}},cityscapeBot={pf:function(){if(this.trace(),!this.vd)return this.debugCityscape("Cities not ready"),5e3;for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if(i&&i.qf)for(var e=0;e<i.qf.length;e++){var s=i.qf[e];if(s)if("CityScape"==s.type){var n=new Date,a=n.getTime()/1e3,o=a-s.last_collected_at,h=21600;o>=h?(this.debugCityscape("Collect cityscapes",i),this.Kd("Collect Cityscape in "+i.type,"cities/"+i.id+"/wildernesses/collect_all.json","",i),this.Ld("CityScape",1)):this.debugCityscape("Diff is "+o+" < "+h)}else this.debugCityscape("Wild is "+s.type,i);else this.debugCityscape("Wild "+e+" is empty",i)}else this.debugCityscape("Wilderness is not ready",i)}return 36e5}},collectBot={Fe:function(){if(this.trace(),!this.vd)return this.debugCollect("Cities is not ready"),5e3;for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if(i&&i.nf)for(var e=0;e<i.nf.length;e++){var s=i.nf[e];if(s&&s.af)for(var n=s.af,a=0;a<n.length;a++){var o=n[a];if(o.hasOwnProperty("unlocked")&&o.unlocked){var h=this.ne(s.h,void 0,o.id);if(h){this.debugCollect("Collect "+o.type,i);var r="cities/"+s.h.id+"/npc_buildings/"+o.id+".json",d="_method=put&city_building_id="+o.id;this.Kd("Collect "+o.type+" in "+i.type,r,d,s.h),this.Ld("Collect",1)}}else this.debugCollect(o.type+" is not unlocked",i)}else this.debugCollect("Building not ready",i)}else this.debugCollect("Neighborhood not ready",i)}return 1e3},rf:function(){if(this.trace(),!(this.vd&&this.vd[0]&&this.vd[0].nf&&this.vd[0].nf.length))return this.debugCollect("Neighborhood not ready"),0;var t=this.vd[0];if(t&&t.nf&&t.nf.length)for(var i=0;i<this.vd[0].nf.length;i++){var e=this.vd[0].nf[i];if(e&&e.af){for(var s=0;s<e.af.length;s++)if("Exchange"==e.af[s].type){if(!e.af[s].sf){this.debugExchange("No free ticket",t);break}var n="cities/"+t.city_id+"/exchanges/"+e.af[s].id+"/collect.json",a="_method=put&_action=collect&city_building_id="+e.af[s].id;return this.Kd("Collect Exchange",n,a,this.vd[0]),e.af[s].sf=!1,this.hf("Collect Exchange"),this.Ld("Exchange",1),36e5}}else this.debugCollect("Building not ready",t)}return 0},tf:function(){return this.trace(),this.vd&&this.vd[0]&&(this.debugLoyaltyToken("Checking token"),this.Nd("Update tokes","loyalty_tokens.json","",this.vd[0],this.bind(this.uf))),36e5},uf:function(){if(this.trace(),!this.vf)return void this.debugLoyaltyToken("No tokens");for(var t=0;t<this.vf.length;t++)this.vf[t].collectable&&(this.debugLoyaltyToken("Collect token: "+this.token[t].type+" ("+t+")"),this.Kd("Collect token","loyalty_tokens/collect.json","type="+this.vf[t].type,this.vd[0]),this.Ld("Token",1))},wf:function(){if(this.trace(),!this.xf)return void this.debugQuests("No Quests yet");if(!this.xf.Completed)return void this.debugQuests("No Completed Quests");var t=this.xf.Completed[0].name;this.debugQuests("Collect quest: "+t),this.Kd("Collect Quest","player_quests/claim.json","quest_name="+t+"&_method=put",this.vd[0])}},debugBot={trace:function(){this.Ne&&this.debug(arguments.callee.caller.name)},yf:function(t){this.zf=t},debug:function(t,i,e){if(i&&this.zf&&"All"!=this.zf&&this.zf!=i.type)return"";var s=new Date;return"object"==typeof t&&(t=""),i&&i.type&&(t=i.type+": "+t),e&&(t=e+": "+t),t=s.toLocaleTimeString()+": "+t},Ve:function(t){this["enableDebug"+t]=!1,this["debug"+t]=function(i,e){this["enableDebug"+t]&&this.debug(i,e,t)}},Ue:function(t){this["changeDebugEnable"+t]=function(){this["enableDebug"+t]=this.he["enable_debug_"+t].checked,this.debug("Enable Debug "+t+": "+this["enableDebug"+t])}},Af:function(){this.Ne=!this.Ne},Bf:function(){var cmd=window.prompt("Enter CMD","");try{var res=eval(cmd);res&&this.debug(res)}catch(t){alert(t)}}},itemBot={Cf:function(){this.Df()},Df:function(){if(!this.Ef)return void this.debugItems("Items is not ready");if(!this.vd)return void this.debugItems("Cities is not ready");var t=this.vd[0];for(var i in this.Ff)this.Ff[i].Wb&&this.Ef[i]?(this.debugItems(i+": "+this.Ef[i]),this.Ef[i]--,this.Kd("Use "+i,"player_items/"+i+".json","_method=delete",t),this.Ld("Item",1)):this.debugItems("Can't find "+i+" in items",t)}},optionsBot={yd:function(){localStorage.setItem("gfb_options",JSON.stringify(this.options))},Ie:function(){var t=localStorage.getItem("gfb_options");t?this.options=JSON.parse(t):this.options={}}},parserBot={Gf:function(t){var i,e,s;if(t){if("string"==typeof t&&(t=JSON.parse(t)),t.timestamp){var n=new Date,a=n.getTime()/1e3;this.He=a-t.timestamp}if(t.vd&&t.vd[0]&&t.vd[0].id&&(this.vd||(this.vd=t.vd,this.Hf("cities:update"))),t.If&&(this.If=t.If,this.Hf("player:armor:update")),t.neighborhoods)for(s in t.neighborhoods){var o=t.neighborhoods[s];if(o&&o.af&&o.af.length){var h=o.af;if(h[0]&&h[0].city_id&&(e=this.ke(t.neighborhoods.nf.af[0].city_id))){e.nf||(e.nf=[]),o.h=e;var r=!0;for(i=0;i<e.nf.length;i++)if(e.nf[i].id==o.id){r=!1;break}r&&e.nf.push(o)}}}if(t.h&&(e=this.ke(t.h.id))){if(e.type=t.h.type,e.oe&&t.h.oe)for(i=0;i<e.oe.length;i++){var d=!1;for(s=0;s<t.h.oe.length;s++)if(e.oe[i].pe==t.h.oe[s].pe){d=!0;break}!d&&e.oe[i].pe&&e.oe[i].id&&this.Be(e.oe[i].pe)}t.h.units&&(e.units=t.h.units,this.Hf("units:update")),t.h.u&&(e.u=t.h.u,this.Hf("research:update")),t.h.Pd&&(e.Pd=t.h.Pd,this.Hf("resources:update")),t.h.figures&&t.h.figures.marches&&(e.Jd=t.h.figures.marches.Jd),t.h.qf&&(e.qf=t.h.qf),t.h.oe&&(e.oe=t.h.oe,this.Hf("jobs:update")),t.h.Jf&&(e.pd=t.h.Jf,this.Hf("city:armor:update",e)),e.data=t.h}if(t.terrain){this.options.map||(this.options.map={});for(var u in t.terrain){var l=t.terrain[u];for(var f in l){var c=l[f];("Gang"==c[0]||"BossGang"==c[0])&&(this.options.map[c[2]]||(this.options.map[c[2]]={}),this.options.map[c[2]][c[3]]||(this.options.map[c[2]][c[3]]={}),this.options.map[c[2]][c[3]].Ad="Gang"==c[0]?c[1]:parseInt(c[1],10)+10,this.options.map[c[2]][c[3]].x=c[2],this.options.map[c[2]][c[3]].y=c[3])}}}if(t.Kf&&(this.sf=t.Kf),t.Ff&&(this.Ef=t.Ff,this.Hf("player:items")),t.xf&&(this.xf=t.xf,this.Hf("player:quests")),t.level&&(this.kf=t.level),t.result){if(t.result.Lf)this.Mf=t.result.Lf,this.Nf=t.result.Nf;else if(t.result.item_won)for(var p in t.result.item_won)this.vd?this.Of("Won: "+p,this.vd[0]):this.Of("Won: "+p);if(t.result.prize)if(e=this.ke(t.result.city_id),t.result.prize.prize_type)this.Of("Won: "+t.result.prize.prize_type,e);else for(var g in t.result.prize)"cash_multiplier"!=g&&this.Of("Won: "+g+" "+t.result.prize[g],e);if(t.result.job&&(e=this.ke(t.result.job.city_id),e&&(e.oe||(e.oe=[]),e.oe.push(t.result.job),this.Hf("jobs:update"))),this.Me.h&&t.result.units&&(this.Me.h.q=t.result.units,this.Od(this.Me.h)),t.result.vf&&(this.vf=t.result.vf),t.result.Pf&&(this.debugReport("Update reports"),this.Qf={},this.Qf.total=t.result.total,this.Qf.Qf=t.result.Pf,this.Hf("report:update")),t.result.bonds_list)for(i=0;i<t.result.bonds_list.length;i++){var v=t.result.bonds_list[i];"BearerBond"==v.name&&100==v.quantity&&this.Sd()}}t.Ed&&this.Me.h&&(this.Me.h.Ed=t.Ed)}}},prizeBot={Rf:function(){this.trace(),this.vd&&this.vd[0]&&this.Nf&&(this.debugPrize("Get Prize"),this.Kd("Get Prize","minigames/save_result.json","minigame_timestamp="+this.Nf,this.vd[0]),this.Ld("Prize",1))},Sf:function(){if(this.trace(),this.vd&&this.vd[0]){if(!(this.sf||this.Ff&&this.Ff.DailyChance&&this.Ff.DailyChance>0))return this.debugPrize("No prize ticket - Update player data"),this.ze(),3e5;this.debugPrize("Update Prize"),this.Nd("Update Prize","minigames/index.json","",this.vd[0],this.bind(this.Tf))}else this.debugPrize("Cities not ready");return 0},Tf:function(){this.trace();var t={j:1e3,name:""};if(this.Mf&&this.Mf.length){for(var i=0;i<this.Mf.length;i++)if(this.Ff[this.Mf[i].type]){var e=this.Ff[this.Mf[i].type];t.j>e.j&&(t.j=e.j,t.name=this.Mf[i].type)}else this.Of(this.Mf[i].type+" is unknown"),this.Uf(this.Mf[i].type);t.j>=10&&(this.Rf(),this.sf?this.sf=!1:this.Ff&&this.Ff.DailyChance&&this.Ff.DailyChance>0&&this.Ff.DailyChance--,this.ze())}},Uf:function(t){this.options.Vf||(this.options.Vf=[]),this.options.Vf.push(t),this.yd()},Ze:function(){if(this.trace(),this.options.Vf){for(var t=0;t<this.options.Vf.length;t++){var i=this.options.Vf[t];this.Ff[i]?this.options.Vf.splice(t,1):this.debug("Missing prize info: "+i)}this.yd()}}},queueBot={Wf:function(t,i,e,s,n,a,o){this.trace(),void 0!==n&&(""!==e&&(e+="&"),e+="city_id="+n.id);var h={};h.name=t,h.type=s,h.url=this.Oe+i,h.h=n,h.data=e+"&_session_id="+this.Re+"&gangster="+this.Sa+"&user_id="+this.Se,h.Xf=a,"slow"===o?this.Yf(this.Ke,h):"data"===o?this.Yf(this.Je,h):this.Yf(this.pe,h)},Yf:function(t,i){for(var e=0;e<t.length;e++)if(t[e].url==i.url&&t[e].data==i.data&&-1==i.name.indexOf("Collect "))return void this.debug("Dropping double command: "+i.name,i.h);t.push(i),this.Hf("queue:update")},Kd:function(t,i,e,s,n){this.Wf(t,i,e,"POST",s,n,"cmd")},Nd:function(t,i,e,s,n){this.Wf(t,i,e,"GET",s,n,"cmd")},Zf:function(t,i,e,s,n){this.Wf(t,i,e,"POST",s,n,"slow")},wd:function(t,i,e,s,n){this.Wf(t,i,e,"GET",s,n,"slow")},ye:function(t,i,e,s,n){this.Wf(t,i,e,"POST",s,n,"data")},te:function(t,i,e,s,n){this.Wf(t,i,e,"GET",s,n,"data")},Xe:function(){var t;"data"===this.Le?this.Je.length?t=this.Je:this.pe.length&&(t=this.pe,this.Le="cmd",this.Hf("queue:change")):this.pe.length?t=this.pe:this.Je.length&&(t=this.Je,this.Le="data",this.Hf("queue:change")),void 0===t&&this.Ke.length&&(t=this.Ke),this.Me?(this.debug("Resending last command"),this.$f(this.Me)):t&&this.$f(t.shift())},$f:function(t){if(t){this.Me=t,this.Hf("queue:update");var i=this;$.ajax({type:this.Me.type,url:this.Me.url,data:this.Me.data,_f:function(t){i.ag(t)},error:function(t){i.bg(t)}})}},bg:function(t,i,e){"string"==typeof t&&(t=JSON.parse(t)),this.debug("Error sending command: "+t.responseText),this.debug(this.Me),void 0!==this.Me.Xf&&this.Me.Xf()},ag:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&t.result&&(t.result._f||(this.debug("Command send Error: "+t.result.errors[0]),this.debug(this.Me))),this.Gf(t),void 0!==this.Me.Xf&&this.Me.Xf(),this.Me=void 0}},reportBot={cg:function(){this.debugReport("Do Reports"),this.Nd("Reports","reports.json","count=18&page=1&category=reports")},dg:function(){if(this.debugReport("Handle Reports"),this.Qf&&this.Qf.Qf){for(var t="",i=0;i<this.Qf.Qf.length;i++){var e=this.Qf.Qf[i];"attacking"==e.battle_side&&"Won"==e.battle_result&&null===e.read_at&&(t+=e.id+"|")}this.debugReport("Ids: "+t),""!==t&&this.Kd("Delete reports","reports/bulk_delete.json","_method=delete&ids="+t)}}},researchBot={eg:function(t,i){for(var e=1;t>e;e++)i*=1.5;return i},fg:function(t){this.trace();var i={Ad:20,gg:20,id:""};if(!t)return void this.debugResearch("No city");
if(!t.u)return void this.debugResearch("Missing research",t);if(!t.nf)return void this.debugResearch("Missing neighborhood",t);for(var e in this.u){var s=this.u[e],n=t.u[e],a=!1;void 0===n&&(n=0);var o=s.t;if(o){if(o.A){var h=this.$e(o.A,t);if(this.debugResearch(e+" ("+n+"/"+(n-4)+") has req "+o.A+" and it is "+h+" ("+4*h+")",t),h*="Garage"==o.A||"Workshop"==o.A||"GuardPost"==o.A?4:2,n>1&&n>=h){this.debugResearch("skip because "+h+" is less then "+n,t);continue}}if(o.u){for(var r=0;r<o.u.length;r++){var d=o.u[r],u=t.u[d];if(void 0===u&&(u=0),this.debugResearch(e+" has req "+d+" and it is "+u,t),n>=u){this.debugResearch("Skip because "+u+" is less then "+n,t),a=!0;break}}if(a)continue}}this.ff(t,e,s.j,n,this.eg)?(i.Ad>n||i.Ad==n&&i.gg>this.u[e].Oa)&&(i.Ad=n,i.name=e,i.gg=this.u[e].Oa):this.debugResearch("Skip because we can't affort it",t)}20!=i.Ad&&(this.hf("Research "+i.name+" lvl "+(i.Ad+1),t),this.Kd("Research "+i.name+" lvl "+(i.Ad+1)+" in "+t.type,"cities/"+t.id+"/researches.json","research[research_type]="+i.name,t),this.Ld("Research",1),t.u[i.name]=i.Ad+1)},Ce:function(){if(this.trace(),!this.vd)return void this.debugResearch("Cities not ready");for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if("DoriaAirport"!=i.type){var e=this.ne(i,"research");e?this.fg(i):this.debugResearch("Already researching",i)}else this.debugResearch("Can't research in "+i.type,i)}}},trainBot={hg:function(t,i,e,s){if(i.A)for(var n in i.A){var a=this.$e(n,e);if(this["debug"+s](t+" has build req "+n+" of "+i.A[n]+" and it is "+a,e),a<i.A[n])return this["debug"+s]("Skipping "+t,e),!1}if(i.u)for(var o in i.u){var h=e.u[o];if(void 0===h&&(h=0),this["debug"+s](t+" has req "+o+" of "+i.u[o]+" and it is "+h,e),h<i.u[o])return this["debug"+s]("Skiping "+t,e),!1}return!0},De:function(){if(this.trace(),!this.vd)return void this.debugTrain("Cities is not ready");if(!this.options.ig)return void this.debugTrain("Train data is not ready");this.debugTrain(this.options.ig);for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if(i&&"DoriaAirport"!=i.type)for(var e in this.Qd){var s=this.Qd[e];if(s.i)if(s.h&&"All"!=s.h&&s.h!=i.type)this.debugTrain(e+" can't be trained in "+i.type+" only in "+s.h);else{var n=this.options.ig[e];if(n){i.units||this.debugTrain("city.units is missing",i);var a=s.t;if(this.hg(e,a,i,"Train")){var o=10,h=0,r=s.j;if(i.units[e]&&(h=i.units[e]),h>=n)this.debugTrain("Do not train "+e+", there is "+h,i);else if(this.ne(i,"units")){if(void 0===r||this.ff(i,e,r,o,void 0)){this.debugTrain("Train "+o+" "+e,i),this.jg(e,o,i),this.Ld("Train",o);break}}else this.debugTrain("Already training units",i)}}else this.debugTrain("Do not train "+n+" "+e,i)}else this.debugTrain(e+" is not trainable",i)}}},Ee:function(){if(this.trace(),!this.vd)return void this.debugDefense("Cities not ready");for(var t=0;t<this.vd.length;t++){var i=this.vd[t];if("DoriaAirport"!=i.type)if(this.ne(i,"defense_units")){var e=void 0,s=10;for(var n in this.Id){var a=this.Id[n];if(a.i)if(a.h&&"All"!=a.h&&a.h!=i.type)this.debugDefense(n+" can't be trained in "+i.type+" only in "+a.h);else{var o=this.Id[n].t;if(this.hg(n,o,i,"Defense")){var h=this.Id[n].j;(!h||this.ff(i,n,h,s,void 0))&&(e=n,this.debugDefense("Can build "+n,i))}}else this.debugDefense(n+" is not trainable",i)}e?(this.jg(e,s,i),this.debugTrain("Train "+s+" "+n,i),this.Ld("Defense",s)):this.debugDefense("Failed to find a unit to train",i)}else this.debugDefense("Already training defense units",i)}},jg:function(t,i,e){this.Kd("Train "+i+" "+t+" in "+e.type,"cities/"+e.id+"/units.json","_method=post&units[include_requirements]=false&units[quantity]="+i+"&units[unit_type]="+t,e)}},utilBot={bind:function(t){if(t){var i=this;return function(){return t.apply(i,arguments)}}},Hf:function(t,i){void 0===i?$(document).trigger(t):$(document).trigger(t,i)},je:function(t,i){$(document).bind(t,this.bind(i))},kg:function(t){return t=parseInt(t,10),t>=1e9?(t=Math.floor(t/1e8),t/=10,t+=" B"):t>=1e6?(t=Math.floor(t/1e5),t/=10,t+=" M"):t>=1e3&&(t=Math.floor(t/100),t/=10,t+=" K"),t},nd:function(t){if(this.vd)for(var i=0;i<this.vd.length;i++)this.vd[i]&&this.vd[i].id&&t(this.vd[i])},_e:function(t){this.nd(function(i){if(i.nf&&i.nf.length)for(var e=0;e<i.nf.length;e++){var s=i.nf[e];s&&t(i,neighbothood)}})}},guiBot={We:function(){var t=document.createElement("div");t.setAttribute("id","panel"),t.setAttribute("class","panel"),document.body.appendChild(t);var i=document.createElement("p");i.className="header",i.innerHTML="The Underboss",i.onclick=function(){$("#panel").hasClass("panel")?($("#panel").removeClass("panel").addClass("hiddenPanel"),$("#mainPanel").hide()):($("#panel").removeClass("hiddenPanel").addClass("panel"),$("#mainPanel").show())},t.appendChild(i);var e=document.createElement("div");e.setAttribute("id","mainPanel"),t.appendChild(e),this.he.lg=e;for(var s in this.Td)this.mg(s);this.ng(),this.og(),this.pg(),this.qg();var n=document.createElement("div");e.appendChild(n);var a=document.createElement("div");a.className="tab-box",n.appendChild(a);for(var o=["Info","Prizes","Attack","Map","Build","Debug"],h=0;h<o.length;h++){a.appendChild(this.rg("info-"+(h+1),o[h]));var r=this.sg("info-"+(h+1));n.appendChild(r),this.he[o[h]+"InfoData"]=r,this["draw"+o[h]+"Tab"]&&this["draw"+o[h]+"Tab"](r)}},mg:function(t){void 0===this.options["enable"+t]&&(this.options["enable"+t]=!0,this.yd());var i=this.tg(t,this.he.lg,"enable_","changeEnable",this.options["enable"+t]),e=document.createElement("span");e.innerHTML=" - ",i.appendChild(e),this.ug(t+" Now",this.bind(this["do"+t]),i)},vg:function(t){this.tg(t,this.he.DebugInfoData,"enable_debug_","changeDebugEnable",!1)},tg:function(t,i,e,s,n){var a=document.createElement("div");i.appendChild(a);var o=document.createElement("div");o.className="option",o.innerHTML=t+": ",a.appendChild(o);var h=document.createElement("input");return h.type="checkbox",h.name=e+t,h.id=e+t,h.checked=n,h.onclick=this.bind(this[s+t]),a.appendChild(h),this.he[e+t]=h,a},ug:function(t,i,e){var s=$("<button/>").val(t).click(i);void 0===e?$(this.he.lg).append(s):$(e).append(s)},rg:function(t,i){var e=document.createElement("a");return e.href="javascript:;",e.className="tabLink",e.id=t,e.innerHTML=i,e.onclick=function(){var t=$(this).attr("id");return $(".tabLink").removeClass("activeLink"),$(this).addClass("activeLink"),$(".tabcontent").addClass("hide"),$("#"+t+"_data").removeClass("hide"),!1},e},sg:function(t){var i=document.createElement("div");return i.id=t+"_data",i.className="tabcontent",1!=t&&(i.className+=" hide"),i},wg:function(t){$(t).he("<h7>Debug Info</h7>").append($("<div/>").attr("id","debug_queue")),this.ug("Update Jobs",this.bind(this.ve),t),this.ug("Execute",this.bind(this.Bf),t),this.ug("Trace",this.bind(this.Af),t),$(t).append("<select id='debug_city' />"),$("#debug_city").change(this.bind(this.xg,this));for(var i in this.Td)this.vg(i);this.je("queue:update",this.yg),this.je("queue:change",this.yg),this.je("city:update",this.zg),this.je("report:update",this.dg)},xg:function(){this.zf=$("#debug_city").val()},zg:function(){$("#debug_city").he("").append("<option value='All'>All</option>");for(var t=0;t<this.vd.length;t++){var i=this.vd[t];i&&i.type&&$("#debug_city").append("<option value='"+i.type+"'>"+i.type+"</option>")}},yg:function(){$("#debug_queue").he("<h7>CMD Queue: "+this.pe.length+"</h7><h7>Data Queue: "+this.Je.length+"</h7><h7>Slow Queue: "+this.Ke.length+"</h7><h7>Queue Type: "+this.Le+"</h7>")},Ag:function(t){this.options.A||(this.options.A={}),$(t).append("<h7>Build Orders</h7>"),$(t).append("<p>Build this amount of buildings and the rest will be Hideout.</p>");var i=$("<table/>");$(t).append(i);var e=!1;for(var s in this.af)if(this.af[s].Ja){var n=$("<input id='build_"+s+"' />");this.options.A[s]&&"number"==typeof this.options.A[s]?n.val(this.options.A[s]):(n.val(this.af[s].Ja),e=!0),this.Bg(i,s,n)}e&&this.Cg(),this.ug("Save",this.bind(this.Cg),t)},Cg:function(){this.options.A={};for(var t in this.af)this.af[t].Ja&&(this.options.A[t]=parseInt($("#build_"+t).val(),10));this.yd()},xd:function(){this.he.Dg||(this.he.Dg=document.createElement("div"),this.he.MapInfoData.appendChild(this.he.Dg)),this.options.sd||(this.options.sd=2,this.ud()),this.he.Dg.innerHTML="<p>Scan size: "+this.options.sd+"</p>";var t,i,e={};for(i in this.options.map)for(var s in this.options.map[i]){var n=this.options.map[i][s];e[n.Ad]||(e[n.Ad]=0),e[n.Ad]++}for(t=1;10>=t;t++)e[t]&&(this.he.Dg.innerHTML+="<p>Lvl "+t+" Gangs: "+e[t]+"</p>");for(t=1;5>=t;t++)e[10+t]&&(this.he.Dg.innerHTML+="<p>Murder Inc. "+t+": "+e[10+t]+"</p>")},Eg:function(t){t.innerHTML="<h7>Map</h7>",this.ug("Update Map",this.bind(this.ud),t),this.ug("Reset Map",this.bind(this.rd),t),this.xd()},Fg:function(t){this.he.order={},t.innerHTML="<h7>Attack Orders</h7>",$("<div>City:</div>").append($('<select id="select_attack_city"></select>')).appendTo($(t)),this.je("cities:update",function(){var t=$("#select_attack_city");if(t.empty(),t.append($('<option value="all">All</option>')),this.vd)for(var i=0;i<this.vd.length;i++)t.append($('<option value="'+this.vd[i].type+'">'+this.vd[i].type+"</option>"))}),$("<div>Gang Level:</div>").append($('<select id="select_gang"></select>')).appendTo($(t));for(var i=$("#select_gang"),e=1;15>=e;e++)i.append($('<option value="'+e+'">'+e+"</option>"));$('<div id="units_p">Units:</div>').append($('<select id="select_units"></select>')).appendTo($(t));var s=$("#select_units");for(var n in this.Qd)s.append($('<option value="'+n+'">'+n+"</option>"));$('<input type="text" id="unit_count" value="0" class="unit_count" />').appendTo($("#units_p")),this.ug("Add",this.bind(this.Gg),document.getElementById("units_p")),$("<div>Use All:</div>").append('<input type="checkbox" id="check_attack_all" value="all"/>').appendTo($(t)),$('<textarea id="total_units" class="textinfo"></textarea>').appendTo($(t)),this.ug("Save",this.bind(this.Hg),t),this.ug("Clear",this.bind(this.Ig),t);var a=document.createElement("hr");t.appendChild(a);var o=document.createElement("select");o.size="10",o.width="100%",t.appendChild(o),this.he.order.list=o,this.ug("Delete",this.bind(this.Jg),t),this.Kg()},Jg:function(){var t=this.he.order.list.value;this.options.Dd.splice(t,1),this.Kg()},Kg:function(){if(this.he.order.list.innerHTML="",this.options.Dd)for(var t=0;t<this.options.Dd.length;t++){var i=this.options.Dd[t];i.h||(i.h="all"),i.Gd||(i.Gd=!1);var e=document.createElement("option");this.he.order.list.appendChild(e),e.value=t,e.innerHTML=i.h+" | "+i.Fd+" | "+(i.Gd?"t":"f")+" | "+i.units}},Gg:function(){var t=$("#total_units");""!==t.val()&&t.val(t.val()+","),t.val(t.val()+'"'+$("#select_units").val()+'":'+$("#unit_count").val())},Hg:function(){var t={};t.Fd=parseInt($("#select_gang").val(),10),t.units="{"+$("#total_units").val()+"}",t.h=$("#select_attack_city").val(),t.Gd=$("#check_attack_all").is(":checked"),this.options.Dd||(this.options.Dd=[]),this.options.Dd.push(t),this.yd(),this.Ig(),this.Kg()},Ig:function(){$("#total_units").val("")},me:function(){var t=$("#stats").he("<h3><u>Stats</u></h3>");if(this.options.le)for(var i in this.options.le)t.append($("<p>"+i+": "+this.options.le[i]+"</p>"))},Lg:function(t){this.ug("Overview",this.showoverview,t),this.ug("Traning",this.showtrainview,t),$(t).append($("<textarea></textarea>").addClass("info").attr("id","debug_info"))},Mg:function(t){$(t).he("<h7>Prizes</h7>").append("<p>Prize Info:</p>").append($("<textarea/>").addClass("prize_info"))},hf:function(t,i){$("#debug_info").text(this.debug(t,i)+"\n"+$("#debug_info").text())},Of:function(t,i){$(".prize_info").text(this.debug(t,i)+"\n"+$(".prize_info").text())},Ng:function(t,i){$("#panel").append("<dialog id='"+t+"' class='overlay'><h1>"+i+"</h1><button class='close' id='"+t+"_close'>Close</button></dialog>"),$("#"+t+"_close").click(function(){$("#"+t).hide()}),this["show"+t]=function(){$("#"+t).show()}},og:function(){this.Ng("armorView","Armor View")},Bg:function(t,i,e){var s=$("<td/>").append(i),n=$("<td/>").append(e);t.append($("<tr/>").append(s,n))},qg:function(){this.Ng("optionsview","Options");var t=$("#optionsview");t.append("<h7>Options</h7>");var i=$("<table/>");t.append(i),this.Bg(i,"Reload Time",""),this.Bg(i,"Underboss Size",""),this.Bg(i,"Queue Send Interval",""),this.Bg(i,"Hide side panel",""),this.Bg(i,"",""),this.createButton(t,"Save",this.bind(this.saveOptionsPage,this))},pg:function(){this.Ng("trainview","Traning View"),$("#trainview").append("<h7>Training Orders</h7>");var t=$("<table/>");$("#trainview").append(t);var i,e=0;for(var s in this.Qd)this.Qd[s].i&&(e%3===0&&(i=$("<tr/>"),t.append(i)),i.append($("<td/>").text(s).append($("<td/>").append($("<input class='number'/>").attr("id","unit_"+s)))),this.options.ig&&this.options.ig[s]&&$("#unit_"+s).val(this.options.ig[s]),e++);this.ug("Save",this.bind(this.Og),$("#trainview"))},Og:function(){this.trace(),this.options.ig||(this.options.ig={});for(var t in this.Qd)this.options.ig[t]=$("#unit_"+t).val();this.yd()},ng:function(){this.Ng("overview","Overview"),$("#overview").append("<button id='overview_update'>Update</button>"),$("#overview_update").click(this.bind(this.Pg,this)),$("#overview").append("<table id='overview_table'></table>"),$("#overview_table").append("<tr><td>City</td><th>Cash</th><th>Cement</th><th>Food</th><th>Steel</th><th>Jobs</th></tr><tr id='total'><td>Total</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),$("#overview").append($("<div></div>").addClass("stats").attr("id","stats")),this.je("jobs:update",this.Pg),this.je("cities:update",this.Pg),this.je("resources:update",this.Pg),this.Pg(),this.me()},Pg:function(){var t=$("#overview_table"),i=t.find("#total"),e=this.kg;if(this.vd){for(var s={},n=0;n<this.vd.length;n++){var a=this.vd[n];if(a&&a.type){var o=t.find("#"+a.type);if(0===o.length&&(i.before("<tr id='"+a.type+"'><td>"+a.type+"</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),o=t.find("#"+a.type)),a.Pd&&$.each(a.Pd,function(t,i){var n=s[t]||0;n+=parseInt(i,10),s[t]=n,o.find("#"+t).he(e(i))}),a.oe){var h,r,d,u,l;h=r=d=u=l="&nbsp;";for(var f=0;f<a.oe.length;f++)"research"==a.oe[f].pe&&(r="R"),"building"==a.oe[f].pe&&(h="B"),"units"==a.oe[f].pe&&(d="U"),"defense_units"==a.oe[f].pe&&(u="D"),"march"==a.oe[f].pe&&(l="M");o.find("#jobs").he("("+a.oe.length+") "+h+" "+r+" "+d+" "+u+" "+l)}}}$.each(s,function(t,s){i.find("#"+t).he(e(s))})}}};if($&&$("#game_frame")&&($("#game_frame").width("1281px"),setTimeout(function(){location.reload()},72e5)),GM_addStyle(css),-1!=window.location.href.indexOf("platforms/kabam/game")){combine(bot,attackBot,bondsBot,buildBot,guiBot,itemBot,reportBot,trainBot,bailoutBot,collectBot,prizeBot,researchBot,optionsBot,parserBot,queueBot,debugBot,utilBot,armorBot),bot.Qd=attackUnits,bot.Id=defenseUnits,bot.af=buildings,bot.u=research,bot.Ff=items;var src=convertToSource(bot);src="var bot = "+src+";\n",src+="bot.start();",inject(src)}