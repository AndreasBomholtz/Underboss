// ==UserScript==
// @name        The Underboss
// @namespace   Underboss
// @author      MrAnderson
// @description A bot for the game The Godfather from kabam.com
// @include     https://www.kabam.com/games/the-godfather/play*
// @include     https://www.kabam.com/*/games/the-godfather/play*
// @include     https://*godfather.*.com/platforms/kabam/game*
// @version     2.0.5
// @grant       GM_addStyle
// @downloadURL https://raw.githubusercontent.com/AndreasBomholtz/Underboss/master/Underboss.user.js
// ==/UserScript==
function combine(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(void 0!==i)for(var s=Object.keys(i),n=0;n<s.length;n++){var a=s[n];t[a]=i[a]}}return t}function convertToSource(t){var e,i=[],s=[];if("object"==typeof t&&void 0==t.join){i.push("{");for(e in t)s.push(e+": "+convertToSource(t[e]));i.push(s.join(",")),i.push("}")}else if("object"==typeof t&&void 0!=t.join){i.push("[");for(var n=0;n<t.length;n++)s.push("'"+t[n]+"'");i.push(s.join(",")),i.push("]")}else if("function"==typeof t){var a=t.toString();-1!=a.indexOf("random")||i.push(a)}else i.push(JSON.stringify(t));return i.join("")}function inject(t){var e=document.createElement("script");e.innerHTML=t,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)}var attackUnits={g:{type:"Basic",h:"All",i:!0,j:{k:750,l:281,m:563,o:281,p:10},q:2250},s:{type:"Basic",h:"All",i:!0,t:{u:{v:1},A:{B:2}},j:{k:1100,l:825,m:413,o:413,p:10},q:3300},C:{type:"Intermediate",h:"All",i:!0,t:{u:{D:4},A:{F:3,B:3}},j:{k:1700,l:638,m:1274,o:638,p:20},q:5100},G:{type:"Intermediate",h:"All",i:!0,t:{u:{H:6},A:{I:3,B:4}},j:{k:2700,l:2025,m:1013,o:1013,p:20},q:8100},J:{type:"Advanced",h:"All",i:!0,t:{u:{H:7,D:7},A:{B:6,I:5,F:5}},j:{k:3800,l:1900,m:1900,o:1900,p:30}},K:{type:"Advanced",h:"All",i:!0,t:{u:{D:8},A:{F:6,B:7}},j:{k:5700,l:2138,m:4250,o:2138,p:30},q:17100},L:{type:"Expert",h:"All",i:!0,t:{u:{H:10},A:{I:6,B:8}}},M:{type:"Expert",h:"All",i:!0,t:{u:{D:12},A:{F:9,B:9}}},N:{type:"Elite",h:"All",i:!0,t:{u:{H:14,D:14},A:{B:9,I:9,F:9}},q:46800},O:{type:"Elite",h:"All",i:!0,t:{u:{H:16,P:17},A:{I:9,B:9}}},R:{type:"Femme Fatale",h:"All",i:!0,t:{u:{H:17},A:{B:9,I:9}},q:56628},S:{type:"Femme Fatale",h:"All",i:!0,t:{u:{D:17},A:{B:9,F:9}},q:56628},T:{type:"Normal",h:"All",i:!0,j:{k:500,l:188,m:188,o:375,p:10}},U:{type:"Normal",h:"All",i:!0,t:{u:{V:6,W:8},A:{B:5,F:2}}},X:{},Y:{type:"Pulitori",h:"LittleItaly",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},_:{type:"Pulitori",h:"GreenwichVillage",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},aa:{type:"Pulitori",h:"Brooklyn",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ba:{type:"Pulitori",h:"ParkAvenue",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ca:{type:"Pulitori",h:"AtlanticCity",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},da:{type:"Pulitori",h:"Chinatown",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ea:{type:"Pulitori",h:"Captial",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},fa:{type:"Pulitori",h:"Harlem",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ga:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ha:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ia:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ja:{type:"Johnney Law",h:"ParkAvenue",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ka:{type:"Johnney Law",h:"Chinatown",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},la:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ma:{type:"Johnney Law",h:"Harlem",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},na:{type:"Clean-up Crew",q:75e3},oa:{type:"Clean-up Crew",q:75e3},pa:{type:"Clean-up Crew",q:75e3},qa:{type:"Clean-up Crew",q:75e3},ra:{type:"Clean-up Crew",q:75e3},sa:{type:"Clean-up Crew",q:75e3},ta:{type:"Clean-up Crew",q:75e3},ua:{i:!1},va:{i:!1},wa:{i:!1},xa:{i:!1},ya:{i:!1},za:{i:!1},Aa:{i:!1},Ba:{i:!1},Ca:{i:!1},Da:{i:!1},Ea:{i:!1},Fa:{i:!1}},buildings={Ga:{Ha:1,j:{k:600,l:200,m:200,o:500}},Ia:{Ha:1,j:{k:600,l:200,m:500,o:200}},Ja:{Ha:1,j:{k:600,l:500,m:200,o:200}},Ka:{Ha:6,j:{k:500,l:100,m:100,o:100}},B:{j:{k:1200,l:500,m:500,o:500}},La:{Ma:1,t:{A:{5:{Na:5},7:{Na:7},8:{Na:8}}},j:{k:2500,l:300,m:300,o:300}},Oa:{Ma:2,j:{k:2500,l:1500,m:200,o:200}},Pa:{t:{Qa:4},j:{k:1500,l:1e3,m:300,o:300}},F:{t:{A:{2:{Ia:5}},Qa:9},j:{k:2e3,l:300,m:1e3,o:300}},Ra:{t:{Qa:3},j:{k:3e3,l:300,m:300,o:1e3}},I:{t:{Qa:7},j:{k:3e3,l:300,m:1e3,o:300}},Sa:{t:{Qa:6},j:{k:2e3,l:500,m:300,o:300}},Na:{j:{k:6e3,l:1e3,m:1e3,o:1e3}},Ta:{t:{A:{0:{Ga:3}},Qa:8},j:{k:1500,l:300,m:300,o:1e3}},Ua:{t:{Qa:3},j:{k:3e3,l:300,m:300,o:1e3}},Va:{t:{Qa:5},j:{k:1500,l:500,m:1500,o:500}},Wa:{Ma:2,t:{A:{2:{Sa:3}}},j:{k:3e3,l:300,m:300,o:1e3}}},defenseUnits={Xa:{h:"All",i:!0,t:{u:{v:4},A:{Ta:2,Na:2}},j:{k:1700,l:638,m:638,o:1275}},Ya:{h:"All",i:!0,t:{u:{v:8},A:{Ta:4,Na:4}},j:{k:1700,l:638,m:638,o:1275}},Za:{h:"All",i:!0,t:{u:{v:12},A:{Ta:6,Na:6}}},$a:{h:"All",i:!0,t:{u:{v:14},A:{Ta:7,Na:7}}},_a:{h:"All",i:!0,t:{u:{v:16},A:{Ta:8,Na:8}}},ab:{h:"All",i:!0,t:{u:{v:18},A:{Ta:9,Na:9}}},bb:{h:"Captial",i:!0,t:{u:{Z:16,$:16},A:{B:10,Ta:10,Na:10}}},cb:{i:!1},eb:{i:!1},fb:{i:!1}},items={gb:{j:1},hb:{j:3},ib:{j:5},jb:{j:10},kb:{j:15},lb:{j:40},mb:{j:65},nb:{j:95},ob:{j:10},pb:{j:7},qb:{j:7},rb:{j:7},sb:{j:35},tb:{j:35},ub:{j:40},vb:{j:40},wb:{j:40},xb:{j:25},yb:{j:40},zb:{j:10},Ab:{j:35},Bb:{j:35},Cb:{j:30},Db:{j:7},Eb:{j:9},Fb:{j:25},Gb:{j:5},Hb:{j:10},Ib:{j:2},Jb:{j:10},Kb:{j:150},Lb:{j:300},Mb:{j:300},Nb:{j:35},Ob:{j:35},Pb:{j:40},Qb:{j:40},Rb:{j:40},Sb:{j:40},Tb:{j:1,Ub:!0},Vb:{j:2,Ub:!0},Wb:{j:5,Ub:!0},Xb:{j:1,Ub:!0},Yb:{j:2,Ub:!0},Zb:{j:2,Ub:!0},$b:{j:5,Ub:!0},_b:{j:9,Ub:!0},ac:{j:1,Ub:!0},bc:{j:1,Ub:!0},cc:{j:3,Ub:!0},dc:{j:5,Ub:!0},ec:{j:6,Ub:!0},fc:{j:1,Ub:!0},gc:{j:2,Ub:!0},hc:{j:3,Ub:!0},ic:{j:4,Ub:!0},jc:{j:5,Ub:!0},kc:{j:5},lc:{j:5},mc:{j:5},nc:{j:5},oc:{j:5},pc:{j:5},qc:{j:5},rc:{j:5},sc:{j:5},tc:{j:5},uc:{j:5},vc:{j:5},wc:{j:5},xc:{j:5},yc:{j:20},zc:{j:20},Ac:{j:5},Bc:{j:5},Cc:{j:40},Dc:{j:95},Ec:{j:12},Fc:{j:10},Gc:{j:20},Hc:{j:35},Ic:{j:40},Jc:{j:75},Kc:{j:35},Lc:{j:40},Mc:{j:60},Nc:{j:75},Oc:{j:30},Pc:{j:30},Qc:{j:30},Rc:{j:30},Sc:{j:30},Tc:{j:30},Uc:{j:30},Vc:{j:30},Wc:{j:30},Xc:{j:30},Yc:{j:5,Ub:!0},Zc:{j:10,Ub:!0},$c:{j:9,Ub:!0},_c:{j:9,Ub:!0}},research={W:{Ma:4,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:250,l:175,m:175,o:175}},ad:{Ma:5,t:{u:["Capacity"],A:"Garage"},j:{k:400,l:200,m:200,o:200}},bd:{Ma:2,t:{u:["Logistics"],A:"CementFactory"},j:{k:150,l:100,m:100,o:200}},dd:{Ma:4,t:{u:["Maneuver"]},j:{k:400,l:200,m:200,o:200}},P:{Ma:2,t:{u:["Logistics"],A:"Restaurant"},j:{k:150,l:200,m:100,o:100}},H:{Ma:5,t:{u:["Capacity"],A:"Hideout"},j:{k:400,l:200,m:200,o:200}},v:{Ma:1,t:{u:[],A:"Library"},j:{k:225,l:150,m:300,o:150}},ed:{Ma:3,t:{u:["Spying"],A:"Garage"},j:{k:250,l:175,m:175,o:175}},V:{Ma:4,t:{u:["Trafficking"]},j:{k:250,l:175,m:175,o:175}},Z:{Ma:6,t:{u:["Construction","Corruption"]},j:{k:500,l:250,m:250,o:250}},$:{Ma:6,t:{u:["Proficiency","Mechanics"],fd:"GaurdPost"},j:{k:500,l:250,m:250,o:250}},D:{Ma:5,t:{u:["Mechanics"],A:"Workshop"},j:{k:400,l:200,m:200,o:200}},gd:{Ma:2,t:{u:["Logistics"]},j:{k:200,l:150,m:150,o:150}},hd:{Ma:2,t:{u:["Logistics"],A:"SteelMill"},j:{k:150,l:100,m:200,o:100}},jd:{Ma:3,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:200,l:150,m:150,o:150}}},css=".panel,.hiddenPanel{background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');border:1px solid darkred;color:white;position:absolute;top:0;right:0;width:300px;height:688px;z-index:10}.hiddenPanel{height:25px}.header{background-color:darkred;color:white;width:100%;height:25px;text-align:center;font-size:150%;font-weight:bold}.info{width:295px;height:260px}.textinfo{width:295px;height:95px}.prize_info{width:295px;height:200px}div.option{width:110px;float:left}div.stats{width:100%}input.button{background-color:darkred;color:white;border-color:red}.tab-box{border-bottom:1px solid darkred;padding-bottom:5px;margin-top:5px}.tab-box a{border:1px solid red;color:white;padding:5px 5px;text-decoration:none;background-color:darkred}.tab-box a.activeLink{background-color:red;border-bottom:0;padding:6px 5px;border-color:darkred}.tabcontent{border:1px solid darkred;border-top:0;overflow-y:auto;height:430px}.hide{display:none}.unit_count{width:25px}input.number{width:35px;margin-right:5px}h7{font-weight:bold;display:block}.overlay{position:absolute;top:50%;left:50%;width:930px;height:640px;margin-left:-1120px;margin-top:-335px;background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');color:white;text-align:center;border-radius:5px;z-index:20;box-shadow:0 0 0 9999px rgba(0,0,0,0.5)}#overview table{width:100%;text-align:left}#overview #total{border-top:double;border-bottom:solid}",armorBot={kd:function(){if(this.trace(),!this.ld)return void this.debugArmor("Cities is not ready");for(var t=0;t<this.ld.length;t++){var e=this.ld[t];e&&this.md(e)}},md:function(t){if(this.trace(),!t||t.armory)return void this.debugArmor("City do not have armor",t);for(var e=0;e<t.nd.length;e++){var i=t.nd[e].equipped_armory_item.item_id;this.debugArmor("Has item id "+i,t);var s=this.od(i);s?this.debugArmor(s[0]+" ("+s[1]+") Lvl "+s[2]):this.debugArmor(i+" not found",t)}},od:function(t){return 31>t?t>20?["Piano Wire","Gold",t-19]:t>10?["Stilettos","Silver",t-9]:["Bat","Bronze",t]:61>t?t>50?["Tommy Gun","Gold",t-49]:t>40?["Magnum","Silver",t-39]:["Molotov","Bronze",t-29]:91>t?t>80?["Italian Suit","Gold",t-79]:t>70?["Fedora","Silver",t-69]:["Scarf","Bronze",t-59]:t>110?["Caddy","Gold",t-109]:t>100?["Speedster","Silver",t-99]:["Motorcycle","Bronze",t-89]}},attackBot={pd:function(){if(this.trace(),!this.ld||!this.ld[0]||!this.ld[0].data)return void setTimeout(this.bind(this.pd),1e3);this.options.qd+=2;var t=10*((this.options.qd-1)/2);this.options.rd||(this.options.rd={});for(var e=0;e<this.ld.length;e++){var i=this.ld[e];if(i){var s=i.x-t;0>s&&(s=750+s);var n=i.y-t;0>n&&(n=750+n);for(var a=0;a<this.options.qd;a++)for(var o=0;o<this.options.qd;o++){var h=(s+10*a)%750,r=(n+10*o)%750;this.options.rd[h]||(this.options.rd[h]={}),this.options.rd[h][r]?this.debugAttack("Not reloading ("+h+","+r+")"):(this.options.rd[h][r]=!0,this.debugAttack("Get map ("+h+","+r+")"),this.sd("Get map ("+h+","+r+")","map.json","x="+h+"&y="+r,i,this.bind(this.td)))}}else this.debugAttack("No city for index "+e)}this.ud()},vd:function(t,e){this.trace(),this.debugAttack("FindBestGang for "+t.type+" with lvl "+e);var i=new Date,s={wd:0},n=1e3;for(var a in this.options.map)for(var o in this.options.map[a]){var h=this.options.map[a][o];if(h.wd!=e&&e>1&&h.wd!=e-1)this.debugAttack("Gang has wrong level ("+h.wd+" != "+e,t);else if(s.wd>h.wd)this.debugAttack("Selected gang is better ("+s.wd+" > "+h.wd+")",t);else if(h.xd&&h.xd>=i.getTime())this.debugAttack("Gang already attacked",t);else{var r=Math.abs(a-t.x);r>250&&(r=Math.abs(750-r));var d=Math.abs(o-t.y);d>250&&(d=Math.abs(750-d)),r+d>n&&s.wd===h.wd?this.debugAttack("Selected gang is closer",t):(n=r+d,s=h,this.debugAttack("Found better Gang "+s.wd+" at ("+a+","+o+") with dist ("+r+" + "+d+") = "+n,t))}}return s},yd:function(){this.trace();var t=6e4,e=new Date;if(!this.options.map)return this.pd(),1e4;if(!this.ld||!this.options.zd)return this.debugAttack("City or orders not ready"),1e4;for(var i=0;i<this.ld.length;i++){var s=this.ld[i];if(s)if(s.Ad<=1)this.debugAttack("No more energy",s);else if("DoriaAirport"!=s.type){for(var n={Bd:0},a=0;a<this.options.zd.length;a++){var o=this.options.zd[a];if(this.debugAttack("Order: "+o.Bd+" City: "+o.h+" Units: "+o.units,s),o.h&&"all"!=o.h&&o.h!=s.type)this.debugAttack("Wrong city ("+o.h+" != "+s.type+")",s);else{var h=!0,r=JSON.parse(o.units);for(var d in r)if(!s.units[d]||s.units[d]<r[d]){this.debugAttack("Do not have "+d+" ("+r[d]+")",s),h=!1;break}if(h){var l=parseInt(n.Bd,10),u=parseInt(o.Bd,10);u>l&&(n=o)}}}if(n.units){var c=this.vd(s,n.Bd);if(0!==c.wd){this.debugAttack("Attack "+c.wd+" Gang at ("+c.x+","+c.y+")",s),c.wd<=10&&(c.xd=e.getTime()+18e5);var f=n.units;n.Cd&&(f=this.Dd(s)),this.attack(c.x,c.y,f,s),t=6e5,this.ud()}else this.debugAttack("Failed to find a gang to attack",s)}}else this.debugAttack(s.type+" is not attackable",s);else this.debugAttack("No city at index "+i)}return t},Dd:function(t){if(this.trace(),t&&t.units){var e=jQuery.extend(!0,{},t.units);for(var i in this.Ed)e[i]&&delete e[i];var s=0;for(var n in e)s>=t.Fd?delete e[n]:(e[n]>t.Fd-s&&(e[n]=t.Fd-s),this.debugAttack("Add attack units "+n+" => "+e[n]+" ("+s+"/"+t.Fd+")",t),s+=e[n]);return JSON.stringify(e)}return""},attack:function(t,e,i,s){this.trace(),this.Gd("Attack ("+t+","+e+") from "+s.type,"cities/"+s.id+"/marches.json","_method=post&march[x]="+t+"&march[y]="+e+"&march[units]="+i,s),this.Hd("Attack",1)}},bailoutBot={Id:function(){if(this.trace(),this.ld)for(var t=0;t<this.ld.length;t++){var e=this.ld[t];"DoriaAirport"!=e.type&&this.Jd("Update bail","cities/"+e.id+"/cash_jail.json","",e)}},Kd:function(t){if(this.trace(),t)if(t.q){var e=0;t.Ld?e=parseInt(t.Ld.k,10):this.debugBailout("No resources",t);var i="",s="",n=0;for(var a in t.q){var o=0;if(this.Md[a]&&this.Md[a].q){var h=this.Md[a].q,r=parseInt(t.q[a],10),d=h*r;this.debugBailout(a+" costs "+d+" and all units costs "+n+" and I have "+e,t);var l=parseInt((e-n)/h,10);if(l>0){l=l>r?r:l;var u=l*h;this.debugBailout("I can affort "+l+" "+a+" because it cost "+u+" and I have "+(e-n)+" ("+e+")",t),o=l,n+=u}else this.debugBailout("Can't affort "+a+" because it cost "+h+" and I have "+(e-n)+" ("+e+")",t)}else this.debug("Missing bailout for "+a,t);o>0&&(i+="&units["+a+"]="+o,s+=o+" "+a+", ")}t.q={},""!==i?(this.debugBailout(s,t),this.Gd("Pay Bailout in "+t.type,"cities/"+t.id+"/cash_jail/bail.json","payment_method=cash"+i,t)):this.debugBailout("No bailout data to send",t)}else this.debugBailout("No bailout",t);else this.debugBailout("City is missing")}},bondsBot={Nd:function(){if(this.debugBonds("Get Bonds"),this.ld){var t=this.ld[0];this.Jd("Get Bonds","bonds.json","action=index",t)}},Od:function(){if(this.debugBonds("Handle bonds"),this.ld){var t=this.ld[0];this.Gd("Collect Bonds","bonds/redeem.json","action=index",t)}}},bot={Pd:{Qd:{},fd:{},Rd:{},Sd:{},Td:{},Ud:{},Vd:{},Wd:{},Xd:{},Yd:{},Wa:{},Zd:{event:"player:items"},$d:{},_d:{},ae:{},be:{event:"city:armor:update"}},ce:function(t){this["changeEnable"+t]=function(){this.options["enable"+t]=this.de["enable_"+t].checked,this.ud(),this.debug("Enable "+t+": "+this.options["enable"+t])}},ee:function(t,e){e.event?this.fe(e.event,function(e,i){this.ld&&this.options["enable"+t]&&this["do"+t+"Event"](i)}):(this["auto"+t+"Thread"]=function(){var e=this.bind(this["auto"+t+"Thread"]),i=6e4;if(this.ld&&this.options["enable"+t]){var s=this["do"+t]();s&&(i=s)}setTimeout(e,i)},this["auto"+t+"Thread"]())},ge:function(t){if(this.ld)for(var e=0;e<this.ld.length;e++)if(this.ld[e].id==t)return this.ld[e];return void 0},Hd:function(t,e){this.options.he||(this.options.he={}),this.options.he[t]||(this.options.he[t]=0),this.options.he[t]+=e,this.ud(),this.ie()},je:function(t,e,i){this.trace();var s=!1;if(t&&t.ke){s=!0;for(var n=0;n<t.ke.length;n++)if(void 0===i){if(t.ke[n].le&&t.ke[n].le===e){s=!1;break}}else if(t.ke[n].me&&t.ke[n].me===i){s=!1;break}if(s){var a=new Date,o=a.getTime(),h={ne:o};void 0===i?h.le=e:h.me=i,t.ke.push(h)}}return s},oe:function(t){if(this.trace(),t&&t.id){var e="unknown";t.type&&(e=t.type),this.Jd("Load city "+e,"cities/"+t.id+".json","",t),this.Jd("Load city "+e+" neighborhood","cities/"+t.id+"/neighborhood_buildings.json","",t);var i=new Date;t.pe=i.getTime()}},qe:function(){if(this.trace(),this.ld)for(var t=0;t<this.ld.length;t++)this.oe(this.ld[t])},re:function(){if(this.trace(),this.ld)for(var t=0;t<this.ld.length;t++){var e=new Date;(!this.ld[t].pe||this.ld[t].pe<e.getTime()+300)&&this.oe(this.ld[t])}},se:function(){if(this.trace(),this.ld&&this.ld[0]&&this.ld[0].id){for(var t=0;t<this.ld.length;t++)this.Gd("Load Game Data","player/game_loaded.json","_method=put",this.ld[t]);this.qe()}},te:function(){this.trace(),this.Jd("Load Player","player.json")},ue:function(){this.trace();var t=this.bind(this.se);this.Jd("Load Player Init","player.json","",void 0,t)},ve:function(t){this.trace(),"building"==t&&this.options.enableBuild?this.qe():"research"==t&&this.options.enableResearch?this.we():"units"==t&&this.options.enableTrain?this.xe():"defense_units"==t&&this.options.enableDefense?this.ye():-1!=t.indexOf("collect")&&this.options.enableCollect&&this.ze()},Ae:function(){var t=this.bind(this.main),e=1e3;if(this.ld)for(var i=new Date,s=i.getTime()/1e3,n=0;n<this.ld.length;n++){var a=this.ld[n];if(a&&a.ke)for(var o=0;o<a.ke.length;o++){var h=a.ke[o],r=h.ne+this.Be;if(s>=r){this.oe(a),a.ke.splice(o,1),e=1e4,this.ve(h.le);break}}}setTimeout(t,e)},init:function(t){this.Ce(),this.le=[],this.De=[],this.Ee={},this.de={},this.Fe=!1,this.Ge=t.apiServer+"/",this.Ge=this.Ge.replace("http","https"),this.He=t.Ie,this.Je=t.sessionId,this.Ke=t.Le,this.Qa=t.Qa;for(var e in this.Pd)this.ee(e,this.Pd[e]),this.ce(e),this.Me(e),this.Ne(e);this.ue(),this.Oe();var i=this.bind(this.Pe);setInterval(i,800);var s=this.bind(this.re);setInterval(s,6e4),this.Ae(),this.Qe()},start:function(){"undefined"!=typeof C?this.init(C.attrs):window.setTimeout(this.bind(this.start,this),1e3)}},buildBot={Re:function(t,e){var i=0;if(e&&e.Se&&e.Se.length)for(var s=0;s<e.Se.length;s++){var n=e.Se[s];if(n&&n.Te)for(var a=n.Te,o=0;o<a.length;o++)a[o].type==t&&i<a[o].level&&(i=a[o].level)}return i},Ue:function(t,e){this.trace();var i=0;if(t&&t.Te)for(var s=t.Te,n=0;n<s.length;n++)"neighborhood"==s[n].location&&(void 0!==e||s[n].hasOwnProperty("unlocked")||"Exchange"==s[n].type?s[n].type==e&&i++:i++);return i},Ve:function(t){this.trace();var e=[],i=0;for(i=0;45>i;i++)e[i]=!0;if(t&&t.Te)for(var s=t.Te,n=0;n<s.length;n++)s[n].hasOwnProperty("slot")&&"neighborhood"==s[n].location&&(e[s[n].We]=!1);for(i=0;i<e.length;i++)if(e[i])return i;return 0},Xe:function(t,e){return e*Math.pow(2,t-1)},Ye:function(t,e,i,s,n){if(i&&t&&t.Ld){var a=t.Ld;for(var o in i){var h=0;if(h=n?n(parseInt(s,10),i[o]):i[o]*s,h>parseInt(a[o],10))return void 0===n?this.debugTrain("Can't train "+e+" because "+o+" ("+h+") is more then "+a[o],t):n==this.Xe?this.debugBuild("Can't build "+e+" because "+o+" ("+h+") is more then "+a[o],t):this.debugResearch("Can't research "+e+" because "+o+" ("+h+") is more then "+a[o],t),!1}for(var r in i){var d;d=n?n(parseInt(s,10),i[r]):i[r]*s,t.Ld[r]=parseInt(t.Ld[r],10)-d}}else i?void 0===n?this.debugTrain("Missing city data"):n==this.Xe?this.debugBuild("Missing city data"):this.debugResearch("Missing city data"):void 0===n?this.debugTrain("Missing cost for "+e):n==this.Xe?this.debugBuild("Missing cost for "+e):this.debugResearch("Missing cost for "+e);return!0},Ze:function(t){if(this.trace(),t&&t.Te&&t.h){var e=t.h;if("DoriaAirport"==e.type)return this.debugBuild("Do not build new building in Doria Airport",e),!1;var i=this.Re("Mansion",t.h),s=3*i+10,n=this.Ue(t);if(this.debugBuild("Man Level: "+i+" Total building: "+n+" => "+s,e),s>n){var a=this.Ve(t),o="Hideout";for(var h in this.Te){var r=this.Te[h],d=0;if(this.options.A[h]?d=this.options.A[h]:r.Ha&&(d=r.Ha),d){var l=this.Ue(t,h);if(d>l){var u=r.j;if(!this.Ye(e,h,u,1,this.Xe))continue;o=h;break}}}this.$e("Build new "+o+" at slot "+a,e);var c="_method=post&city_building[building_type]="+o;return c+="&city_building[include_requirements]=false&city_building[instant_build]=false",c+="&city_building[neighborhood_id]="+t.id+"&city_building[slot]="+a,this.Gd("Build new "+o+" at slot "+a+" in "+e.type,"cities/"+e.id+"/buildings.json",c,e),this.Hd("Build",1),t.Te.push({We:a,location:"neighborhood",type:o}),!0}this.debugBuild("No more slots for new buildings ("+s+")",e)}else this.debugBuild("Can't find neighborhood or buildings",e);return!1},_e:function(t,e){this.trace();for(var i=["Hideout","Apartment"],s=0;s<i.length;s++){var n=i[s],a=this.Re(n,t.h);if(9>a&&t&&t.Te)for(var o=t.Te,h=0;h<o.length;h++){var r=o[h];if(r.type==n&&r.level==a)return e.wd=r.level,e.id=r.id,e.name=r.type,e.location=r.location,this.debugBuild("Build Importent "+e.name,t.h),e}}return this.debugBuild("Failed to find impotent building",t.h),e},af:function(t){if(this.trace(),this.Ze(t))return!0;var e={};if(e.wd=20,e.id="",e.location="",!t||!t.Te)return!1;for(var i=t.Te,s=t.h,n=0;n<i.length;n++){var a=i[n];if(!(a.hasOwnProperty("unlocked")||a.level>=9)){var o=!0,h=this.Te[a.type];if(h&&h.t){var r=h.t;if(r.A){var d=r.A[a.level];if(d)for(var l in d){var u=this.Re(l,t.h);if(u<d[l]){this.debugBuild("Can't build "+a.type+" because "+l+" is not "+d[l],s),o=!1;break}this.debugBuild(a.type+" has req "+l+" ("+d[l]+") and it is "+u,s)}}if(r.Qa&&r.Qa>this.bf){this.debugBuild("Can't build "+a.type+" because gangster is not "+r.Qa,s),o=!1;break}r.Qa&&this.debugBuild(a.type+" has gangster "+r.Qa+" and we are "+this.bf,s)}else this.debugBuild(a.type+" has no requirements",s);o&&h&&h.j?this.Ye(s,a.type,h.j,a.level,this.Xe)?this.debugBuild("Lots of resources",s):o=!1:o&&this.debugBuild("Not cost info for "+a.type,s),o&&(e.wd>a.level||a.level>3&&e.wd==a.level&&"neighborhood"==e.location)&&(e.wd=a.level,e.id=a.id,e.name=a.type,e.location=a.location,e.cf=a)}}if(20!=e.wd){if(e.wd>5){var c=this._e(t,e);if(!c)return this.debugBuild("Faild to find a building",s),!1;this.Te[c.name]?this.Ye(s,c.name,this.Te[c.name].j,c.wd,this.Xe)?e=c:this.debugBuild("Do not upgrade importent building, not egnogh rescources",s):this.debug("Missing info for: "+c.name,s)}return this.$e("Build "+e.name+" "+(e.wd+1),s),this.Gd("Build "+e.name+" "+(e.wd+1)+" in "+s.type,"cities/"+s.id+"/buildings/"+e.id+".json","_method=put",s),e.cf.level++,!0}return!1},df:function(){if(this.trace(),this.ld)for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if("DoriaAirport"==e.type)return void this.debugBuild("Build is disabled for Doria Airport",e);var i=this.je(e,"building");if(i)if(e.Se)for(var s=0;s<e.Se.length&&!this.af(e.Se[s]);s++);else this.debugBuild("Neighborhood not ready",e);else this.debugBuild("Build queue not ready",e)}else this.debugBuild("Cities not ready")}},collectBot={ze:function(){if(this.trace(),!this.ld)return this.debugCollect("Cities is not ready"),5e3;for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if(e&&e.Se)for(var i=0;i<e.Se.length;i++){var s=e.Se[i];if(s&&s.Te)for(var n=s.Te,a=0;a<n.length;a++){var o=n[a];if(o.hasOwnProperty("unlocked")&&o.unlocked){var h=this.je(s.h,void 0,o.id);if(h){this.debug("Collect "+o.type,e);var r="cities/"+s.h.id+"/npc_buildings/"+o.id+".json",d="_method=put&city_building_id="+o.id;this.Gd("Collect "+o.type+" in "+e.type,r,d,s.h),this.Hd("Collect",1)}}else this.debugCollect(o.type+" is not unlocked",e)}else this.debugCollect("Building not ready",e)}else this.debugCollect("Neighborhood not ready",e)}return 1e3},ef:function(){if(this.trace(),!this.ld)return this.collect("Cities not ready"),5e3;for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if(e&&e.ff)for(var i=0;i<e.ff.length;i++){var s=e.ff[i];if(s)if("CityScape"==s.type){var n=new Date,a=n.getTime()/1e3,o=a-s.last_collected_at,h=21600;o>=h?(this.debugCityscape("Collect cityscapes",e),this.Gd("Collect Cityscape in "+e.type,"cities/"+e.id+"/wildernesses/collect_all.json","",e),this.Hd("CityScape",1)):this.debugCityscape("Diff is "+o+" < "+h)}else this.debugCityscape("Wild is "+s.type,e);else this.debugCollect("Wild "+i+" is empty",e)}else this.debugCollect("Wilderness is not ready",e)}return 36e5},gf:function(){if(this.trace(),!(this.ld&&this.ld[0]&&this.ld[0].Se&&this.ld[0].Se.length))return void this.debugCollect("Neighborhood not ready");var t=this.ld[0];if(t&&t.Se&&t.Se.length)for(var e=0;e<this.ld[0].Se.length;e++){var i=this.ld[0].Se[e];if(i&&i.Te){for(var s=0;s<i.Te.length;s++)if("Exchange"==i.Te[s].type){if(!i.Te[s].hf){this.debugExchange("No free ticket",t);break}var n="cities/"+t.city_id+"/exchanges/"+i.Te[s].id+"/collect.json",a="_method=put&_action=collect&city_building_id="+i.Te[s].id;return this.Gd("Collect Exchange",n,a,this.ld[0]),i.Te[s].hf=!1,this.$e("Collect Exchange"),this.Hd("Exchange",1),36e5}}else this.debugCollect("Building not ready",t)}return 0},if:function(){return this.trace(),this.ld&&this.ld[0]&&(this.debugLoyaltyToken("Checking token"),this.Jd("Update tokes","loyalty_tokens.json","",this.ld[0],this.bind(this.jf))),36e5},jf:function(){if(this.trace(),!this.kf)return void this.debugLoyaltyToken("No tokens");for(var t=0;t<this.kf.length;t++)this.kf[t].collectable&&(this.debugLoyaltyToken("Collect token: "+this.token[t].type+" ("+t+")"),this.Gd("Collect token","loyalty_tokens/collect.json","type="+this.kf[t].type,this.ld[0]),this.Hd("Token",1))},lf:function(){if(this.trace(),!this.mf)return void this.debugQuests("No Quests yet");if(!this.mf.Completed)return void this.debugQuests("No Completed Quests");var t=this.mf.Completed[0].name;this.debugQuests("Collect quest: "+t),this.Gd("Collect Quest","player_quests/claim.json","quest_name="+t+"&_method=put",this.ld[0])}},debugBot={trace:function(){this.Fe&&this.debug(arguments.callee.caller.name)},nf:function(t){this.pf=t},debug:function(t,e,i){if(e&&this.pf&&"All"!=this.pf&&this.pf!=e.type)return"";var s=new Date;return"object"==typeof t&&(t=""),e&&e.type&&(t=e.type+": "+t),i&&(t=i+": "+t),t=s.toLocaleTimeString()+": "+t},Ne:function(t){this["enableDebug"+t]=!1,this["debug"+t]=function(e,i){this["enableDebug"+t]&&this.debug(e,i,t)}},Me:function(t){this["changeDebugEnable"+t]=function(){this["enableDebug"+t]=this.de["enable_debug_"+t].checked,this.debug("Enable Debug "+t+": "+this["enableDebug"+t])}},qf:function(){this.Fe=!this.Fe},rf:function(){var cmd=window.prompt("Enter CMD","");try{var res=eval(cmd);res&&this.debug(res)}catch(t){alert(t)}}},guiBot={Oe:function(){var t=document.createElement("div");t.setAttribute("id","panel"),t.setAttribute("class","panel"),document.body.appendChild(t),this.de.sf=t;var e=document.createElement("p");e.className="header",e.innerHTML="The Underboss",e.onclick=function(){$("#panel").hasClass("panel")?($("#panel").removeClass("panel").addClass("hiddenPanel"),$("#mainPanel").hide()):($("#panel").removeClass("hiddenPanel").addClass("panel"),$("#mainPanel").show())},t.appendChild(e);var i=document.createElement("div");i.setAttribute("id","mainPanel"),this.de.sf.appendChild(i),this.de.tf=i;for(var s in this.Pd)this.uf(s);this.vf(),this.wf();var n=document.createElement("div");i.appendChild(n);var a=document.createElement("div");a.className="tab-box",n.appendChild(a);for(var o=["Info","Prizes","Attack","Map","Train","Build","Debug"],h=0;h<o.length;h++){a.appendChild(this.xf("info-"+(h+1),o[h]));var r=this.yf("info-"+(h+1));n.appendChild(r),this.de[o[h]+"InfoData"]=r,this["draw"+o[h]+"Tab"]&&this["draw"+o[h]+"Tab"](r)}this.fe("queue:update",this.zf)},uf:function(t){var e=this.Af(t,this.de.tf,"enable_","changeEnable",this.options["enable"+t]),i=document.createElement("span");i.innerHTML=" - ",e.appendChild(i),this.Bf(t+" Now",this.bind(this["do"+t]),e)},Cf:function(t){this.Af(t,this.de.DebugInfoData,"enable_debug_","changeDebugEnable",!1)},Af:function(t,e,i,s,n){var a=document.createElement("div");e.appendChild(a);var o=document.createElement("div");o.className="option",o.innerHTML=t+": ",a.appendChild(o);var h=document.createElement("input");return h.type="checkbox",h.name=i+t,h.id=i+t,h.checked=n,h.onclick=this.bind(this[s+t]),a.appendChild(h),this.de[i+t]=h,a},Bf:function(t,e,i){var s=document.createElement("input");s.name=t,s.value=t,s.type="button",s.onclick=e,void 0===i?this.de.tf.appendChild(s):i.appendChild(s)},xf:function(t,e){var i=document.createElement("a");return i.href="javascript:;",i.className="tabLink",i.id=t,i.innerHTML=e,i.onclick=function(){var t=$(this).attr("id");return $(".tabLink").removeClass("activeLink"),$(this).addClass("activeLink"),$(".tabcontent").addClass("hide"),$("#"+t+"_data").removeClass("hide"),!1},i},yf:function(t){var e=document.createElement("div");return e.id=t+"_data",e.className="tabcontent hide",e},Df:function(t){$(t).de("<h7>Debug Info</h7>").append($("<div/>").attr("id","debug_queue")),this.Bf("Update Jobs",this.bind(this.qe),t),this.Bf("Execute",this.bind(this.rf),t),this.Bf("Trace",this.bind(this.qf),t),this.Bf("Overview",this.showoverview,t),$(t).append("<select id='debug_city' />");for(var e in this.Pd)this.Cf(e);this.fe("city:update",this.Ef),this.fe("report:update",this.Ff)},Ef:function(){$("debug_city").de("").append("<option value='All'>All</option>")},zf:function(){$("#debug_queue").de("<h7>Queue: "+this.le.length+"</h7><h7>Slow Queue: "+this.De.length+"</h7>")},Gf:function(t){this.de.A={},this.options.A||(this.options.A={}),t.innerHTML="<h7>Build Orders</h7>",t.innerHTML+="<p>Build this amount of buildings and the rest will be Hideout.</p>";var e=document.createElement("table");t.appendChild(e);var i=!1;for(var s in this.Te)if(this.Te[s].Ha){var n=document.createElement("tr");e.appendChild(n);var a=document.createElement("td");a.innerHTML=s,n.appendChild(a),a=document.createElement("td"),n.appendChild(a);var o=document.createElement("input");this.options.A.hasOwnProperty(s)&&"number"==typeof this.options.A[s]?o.value=this.options.A[s]:(o.value=this.Te[s].Ha,i=!0),this.de.A[s]=o,a.appendChild(o)}i&&this.Hf(),this.Bf("Save",this.bind(this.Hf),t)},Hf:function(){this.options.A={};for(var t in this.Te)this.Te[t].Ha&&(this.options.A[t]=parseInt(this.de.A[t].value,10));this.ud()},If:function(t){t.innerHTML="<h7>Training Orders</h7>";var e=$("<table/>");$(t).append(e);var i,s=0;for(var n in this.Md)this.Md[n].i&&(s%3===0&&(i=$("<tr/>"),e.append(i)),i.append($("<td/>").text(n).append($("<td/>").append($("<input class='number'/>").attr("id","unit_"+n)))),this.options.Jf&&this.options.Jf[n]&&$("#unit_"+n).val(this.options.Jf[n]),s++);this.Bf("Save",this.bind(this.Kf),t)},Kf:function(){this.trace(),this.options.Jf||(this.options.Jf={});for(var t in this.Md)this.options.Jf[t]=$("#unit_"+t).val();this.ud()},td:function(){this.de.Lf||(this.de.Lf=document.createElement("div"),this.de.MapInfoData.appendChild(this.de.Lf)),this.options.qd||(this.options.qd=2,this.pd()),this.de.Lf.innerHTML="<p>Scan size: "+this.options.qd+"</p>";var t,e,i={};for(e in this.options.map)for(var s in this.options.map[e]){var n=this.options.map[e][s];i[n.wd]||(i[n.wd]=0),i[n.wd]++}for(t=1;10>=t;t++)i[t]&&(this.de.Lf.innerHTML+="<p>Lvl "+t+" Gangs: "+i[t]+"</p>");for(t=1;5>=t;t++)i[10+t]&&(this.de.Lf.innerHTML+="<p>Murder Inc. "+t+": "+i[10+t]+"</p>")},Mf:function(t){t.innerHTML="<h7>Map</h7>",this.Bf("Update Map",this.bind(this.pd),t),this.td()},Nf:function(t){this.de.order={},t.innerHTML="<h7>Attack Orders</h7>",$("<div>City:</div>").append($('<select id="select_attack_city"></select>')).appendTo($(t)),this.fe("cities:update",function(){var t=$("#select_attack_city");if(t.empty(),t.append($('<option value="all">All</option>')),this.ld)for(var e=0;e<this.ld.length;e++)t.append($('<option value="'+this.ld[e].type+'">'+this.ld[e].type+"</option>"))}),$("<div>Gang Level:</div>").append($('<select id="select_gang"></select>')).appendTo($(t));for(var e=$("#select_gang"),i=1;15>=i;i++)e.append($('<option value="'+i+'">'+i+"</option>"));$('<div id="units_p">Units:</div>').append($('<select id="select_units"></select>')).appendTo($(t));var s=$("#select_units");for(var n in this.Md)s.append($('<option value="'+n+'">'+n+"</option>"));$('<input type="text" id="unit_count" value="0" class="unit_count" />').appendTo($("#units_p")),this.Bf("Add",this.bind(this.Of),document.getElementById("units_p")),$("<div>Use All:</div>").append('<input type="checkbox" id="check_attack_all" value="all"/>').appendTo($(t)),$('<textarea id="total_units" class="textinfo"></textarea>').appendTo($(t)),this.Bf("Save",this.bind(this.Pf),t),this.Bf("Clear",this.bind(this.Qf),t);var a=document.createElement("hr");t.appendChild(a);var o=document.createElement("select");o.size="10",o.width="100%",t.appendChild(o),this.de.order.list=o,this.Bf("Delete",this.bind(this.Rf),t),this.Sf()},Rf:function(){var t=this.de.order.list.value;this.options.zd.splice(t,1),this.Sf()},Sf:function(){if(this.de.order.list.innerHTML="",this.options.zd)for(var t=0;t<this.options.zd.length;t++){var e=this.options.zd[t];e.h||(e.h="all"),e.Cd||(e.Cd=!1);var i=document.createElement("option");this.de.order.list.appendChild(i),i.value=t,i.innerHTML=e.h+" | "+e.Bd+" | "+(e.Cd?"t":"f")+" | "+e.units}},Of:function(){var t=$("#total_units");""!==t.val()&&t.val(t.val()+","),t.val(t.val()+'"'+$("#select_units").val()+'":'+$("#unit_count").val())},Pf:function(){var t={};t.Bd=parseInt($("#select_gang").val(),10),
t.units="{"+$("#total_units").val()+"}",t.h=$("#select_attack_city").val(),t.Cd=$("#check_attack_all").is(":checked"),this.options.zd||(this.options.zd=[]),this.options.zd.push(t),this.ud(),this.Qf(),this.Sf()},Qf:function(){$("#total_units").val("")},ie:function(){var t=$("#stats").de("<h3><u>Stats</u></h3>");if(this.options.he)for(var e in this.options.he)t.append($("<p>"+e+": "+this.options.he[e]+"</p>"))},Tf:function(t){$(t).append($("<div></div>").addClass("stats").attr("id","stats")),this.ie(),$(t).append($("<textarea></textarea>").addClass("info").attr("id","debug_info"))},Uf:function(t){$(t).de("<h7>Prizes</h7>").append("<p>Prize Info:</p>").append($("<textarea/>").addClass("prize_info"))},$e:function(t,e){$("#debug_info").text(this.debug(t,e)+"\n"+$("#debug_info").text())},Vf:function(t,e){$(".prize_info").text(this.debug(t,e)+"\n"+$(".prize_info").text())},Wf:function(t,e){$("#panel").append("<dialog id='"+t+"' class='overlay'><h1>"+e+"</h1><button id='"+t+"_close'>Close</button></dialog>"),$("#"+t+"_close").click(function(){$("#"+t).hide()}),this["show"+t]=function(){$("#"+t).show()}},wf:function(){this.Wf("armorView","Armor View")},vf:function(){this.Wf("overview","Overview"),$("#overview").append("<button id='overview_update'>Update</button>"),$("#overview_update").click(this.bind(this.Xf,this)),$("#overview").append("<table id='overview_table'></table>"),$("#overview_table").append("<tr><td>City</td><th>Cash</th><th>Cement</th><th>Food</th><th>Steel</th><th>Jobs</th></tr><tr id='total'><td>Total</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),this.fe("jobs:update",this.Xf),this.fe("cities:update",this.Xf),this.fe("resources:update",this.Xf),this.Xf()},Xf:function(){var t=$("#overview_table"),e=t.find("#total"),i=this.Yf;if(this.ld){for(var s={},n=0;n<this.ld.length;n++){var a=this.ld[n];if(a&&a.type){var o=t.find("#"+a.type);if(0===o.length&&(e.before("<tr id='"+a.type+"'><td>"+a.type+"</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),o=t.find("#"+a.type)),a.Ld&&$.each(a.Ld,function(t,e){var n=s[t]||0;n+=parseInt(e,10),s[t]=n,o.find("#"+t).de(i(e))}),a.ke){var h,r,d,l;h=r=d=l="&nbsp;";for(var u=0;u<a.ke.length;u++)"research"==a.ke[u].le&&(r="R"),"building"==a.ke[u].le&&(h="B"),"units"==a.ke[u].le&&(d="U"),"defense_units"==a.ke[u].le&&(l="D");o.find("#jobs").de("("+a.ke.length+") "+h+" "+r+" "+d+" "+l)}}}$.each(s,function(t,s){e.find("#"+t).de(i(s))})}}},itemBot={Zf:function(){this.$f()},$f:function(){if(!this._f)return void this.debugItems("Items is not ready");if(!this.ld)return void this.debugItems("Cities is not ready");var t=this.ld[0];for(var e in this.ag)this.ag[e].Ub&&this._f[e]?(this.debugItems(e+": "+this._f[e]),this._f[e]--,this.Gd("Use "+e,"player_items/"+e+".json","_method=delete",t),this.Hd("Item",1)):this.debugItems("Can't find "+e+" in items",t)}},optionsBot={ud:function(){localStorage.setItem("gfb_options",JSON.stringify(this.options))},Ce:function(){var t=localStorage.getItem("gfb_options");t?this.options=JSON.parse(t):this.options={}}},parserBot={bg:function(t){var e,i,s;if(t){if("string"==typeof t&&(t=JSON.parse(t)),t.timestamp){var n=new Date,a=n.getTime()/1e3;this.Be=a-t.timestamp}if(t.ld&&t.ld[0]&&t.ld[0].id&&(this.ld||(this.ld=t.ld,this.cg("cities:update"))),t.dg&&(this.dg=t.dg,this.cg("player:armor:update")),t.neighborhoods)for(s in t.neighborhoods){var o=t.neighborhoods[s];if(o&&o.Te&&o.Te.length){var h=o.Te;if(h[0]&&h[0].city_id&&(i=this.ge(t.neighborhoods.Se.Te[0].city_id))){i.Se||(i.Se=[]),o.h=i;var r=!0;for(e=0;e<i.Se.length;e++)if(i.Se[e].id==o.id){r=!1;break}r&&i.Se.push(o)}}}if(t.h&&(i=this.ge(t.h.id))){if(i.type=t.h.type,i.ke&&t.h.ke)for(e=0;e<i.ke.length;e++){var d=!1;for(s=0;s<t.h.ke.length;s++)if(i.ke[e].le==t.h.ke[s].le){d=!0;break}!d&&i.ke[e].le&&i.ke[e].id&&this.ve(i.ke[e].le)}t.h.units&&(i.units=t.h.units,this.cg("units:update")),t.h.u&&(i.u=t.h.u,this.cg("research:update")),t.h.Ld&&(i.Ld=t.h.Ld,this.cg("resources:update")),t.h.figures&&t.h.figures.marches&&(i.Fd=t.h.figures.marches.Fd),t.h.ff&&(i.ff=t.h.ff),t.h.ke&&(i.ke=t.h.ke,this.cg("jobs:update")),t.h.eg&&(i.nd=t.h.eg,this.cg("city:armor:update",i)),i.data=t.h}if(t.terrain){this.options.map||(this.options.map={});for(var l in t.terrain){var u=t.terrain[l];for(var c in u){var f=u[c];("Gang"==f[0]||"BossGang"==f[0])&&(this.options.map[f[2]]||(this.options.map[f[2]]={}),this.options.map[f[2]][f[3]]||(this.options.map[f[2]][f[3]]={}),this.options.map[f[2]][f[3]].wd="Gang"==f[0]?f[1]:parseInt(f[1],10)+10,this.options.map[f[2]][f[3]].x=f[2],this.options.map[f[2]][f[3]].y=f[3])}}}if(t.fg&&(this.hf=t.fg),t.ag&&(this._f=t.ag,this.cg("player:items")),t.mf&&(this.mf=t.mf,this.cg("player:quests")),t.level&&(this.bf=t.level),t.result){if(t.result.gg)this.hg=t.result.gg,this.ig=t.result.ig;else if(t.result.item_won)for(var p in t.result.item_won)this.ld?this.Vf("Won: "+p,this.ld[0]):this.Vf("Won: "+p);if(t.result.prize)if(i=this.ge(t.result.city_id),t.result.prize.prize_type)this.Vf("Won: "+t.result.prize.prize_type,i);else for(var g in t.result.prize)"cash_multiplier"!=g&&this.Vf("Won: "+g+" "+t.result.prize[g],i);if(t.result.job&&(i=this.ge(t.result.job.city_id),i&&(i.ke||(i.ke=[]),i.ke.push(t.result.job),this.cg("jobs:update"))),this.Ee.h&&t.result.units&&(this.Ee.h.q=t.result.units,this.Kd(this.Ee.h)),t.result.kf&&(this.kf=t.result.kf),t.result.jg&&(this.debugReport("Update reports"),this.kg={},this.kg.total=t.result.total,this.kg.kg=t.result.jg,this.cg("report:update")),t.result.bonds_list)for(e=0;e<t.result.bonds_list.length;e++){var b=t.result.bonds_list[e];"BearerBond"==b.name&&100==b.quantity&&this.Od()}}t.Ad&&this.Ee.h&&(this.Ee.h.Ad=t.Ad)}}},prizeBot={lg:function(){this.trace(),this.ld&&this.ld[0]&&this.ig&&(this.debugPrize("Get Prize"),this.Gd("Get Prize","minigames/save_result.json","minigame_timestamp="+this.ig,this.ld[0]),this.Hd("Prize",1))},mg:function(){if(this.trace(),this.ld&&this.ld[0]){if(!(this.hf||this.ag&&this.ag.DailyChance&&this.ag.DailyChance>0))return this.debugPrize("No prize ticket - Update player data"),this.te(),3e5;this.debugPrize("Update Prize"),this.Jd("Update Prize","minigames/index.json","",this.ld[0],this.bind(this.ng))}else this.debugPrize("Cities not ready");return 0},ng:function(){this.trace();var t={j:1e3,name:""};if(this.hg&&this.hg.length){for(var e=0;e<this.hg.length;e++)if(this.ag[this.hg[e].type]){var i=this.ag[this.hg[e].type];t.j>i.j&&(t.j=i.j,t.name=this.hg[e].type)}else this.Vf(this.hg[e].type+" is unknown"),this.og(this.hg[e].type);t.j>=10&&(this.lg(),this.hf?this.hf=!1:this.ag&&this.ag.DailyChance&&this.ag.DailyChance>0&&this.ag.DailyChance--,this.te())}},og:function(t){this.options.pg||(this.options.pg=[]),this.options.pg.push(t),this.ud()},Qe:function(){if(this.trace(),this.options.pg){this.debug("Show Missing prizes");for(var t=0;t<this.options.pg.length;t++){var e=this.options.pg[t];this.ag[e]?this.options.pg.splice(t,1):this.debug("Missing prize info: "+e)}this.ud()}else this.debug("No missing prizes")}},queueBot={qg:function(t,e,i,s,n,a,o){this.trace(),void 0!==n&&(""!==i&&(i+="&"),i+="city_id="+n.id);var h={};h.name=t,h.type=s,h.url=this.Ge+e,h.h=n,h.data=i+"&_session_id="+this.Je+"&gangster="+this.Qa+"&user_id="+this.Ke,h.rg=a,o===!0?this.sg(this.De,h):this.sg(this.le,h)},sg:function(t,e){for(var i=0;i<t.length;i++)if(t[i].url==e.url&&t[i].data==e.data&&-1==e.name.indexOf("Collect "))return void this.debug("Dropping double command: "+e.name,e.h);t.push(e),this.cg("queue:update")},Gd:function(t,e,i,s,n){this.qg(t,e,i,"POST",s,n,!1)},Jd:function(t,e,i,s,n){this.qg(t,e,i,"GET",s,n,!1)},tg:function(t,e,i,s,n){this.qg(t,e,i,"POST",s,n,!0)},sd:function(t,e,i,s,n){this.qg(t,e,i,"GET",s,n,!0)},Pe:function(){this.le.length>0?this.ug(this.le.shift()):this.De.length>0&&this.ug(this.De.shift())},ug:function(t){this.Ee=t,this.cg("queue:update");var e=this;$.ajax({type:this.Ee.type,url:this.Ee.url,data:this.Ee.data,vg:function(t){e.wg(t)},error:function(t){e.xg(t)}})},xg:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.debug("Error sending command: "+t.responseText),this.debug(this.Ee),void 0!==this.Ee.rg&&this.Ee.rg()},wg:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&t.result&&(t.result.vg||(this.debug("Command send Error: "+t.result.errors[0]),this.debug(this.Ee),this.Ee.h?this.oe(this.Ee.h):this.te())),this.bg(t),void 0!==this.Ee.rg&&this.Ee.rg()}},reportBot={yg:function(){this.debugReport("Do Reports"),this.Jd("Reports","reports.json","count=18&page=1&category=reports")},Ff:function(){if(this.debugReport("Handle Reports"),this.kg&&this.kg.kg){for(var t="",e=0;e<this.kg.kg.length;e++){var i=this.kg.kg[e];"attacking"==i.battle_side&&"Won"==i.battle_result&&null===i.read_at&&(t+=i.id+"|")}this.debugReport("Ids: "+t),""!==t&&this.Gd("Delete reports","reports/bulk_delete.json","_method=delete&ids="+t)}}},researchBot={zg:function(t,e){for(var i=1;t>i;i++)e*=1.5;return e},Ag:function(t){this.trace();var e={wd:20,Bg:20,id:""};if(!t)return void this.debugResearch("No city");if(!t.u)return void this.debugResearch("Missing research",t);if(!t.Se)return void this.debugResearch("Missing neighborhood",t);for(var i in this.u){var s=this.u[i],n=t.u[i],a=!1;void 0===n&&(n=0);var o=s.t;if(o){if(o.A){var h=this.Re(o.A,t);if(this.debugResearch(i+" ("+n+"/"+(n-4)+") has req "+o.A+" and it is "+h+" ("+4*h+")",t),h*="Garage"==o.A||"Workshop"==o.A||"GuardPost"==o.A?4:2,n>1&&n>=h){this.debugResearch("skip because "+h+" is less then "+n,t);continue}}if(o.u){for(var r=0;r<o.u.length;r++){var d=o.u[r],l=t.u[d];if(void 0===l&&(l=0),this.debugResearch(i+" has req "+d+" and it is "+l,t),n>=l){this.debugResearch("Skip because "+l+" is less then "+n,t),a=!0;break}}if(a)continue}}this.Ye(t,i,s.j,n,this.zg)?(e.wd>n||e.wd==n&&e.Bg>this.u[i].Ma)&&(e.wd=n,e.name=i,e.Bg=this.u[i].Ma):this.debugResearch("Skip because we can't affort it",t)}20!=e.wd&&(this.$e("Research "+e.name+" lvl "+(e.wd+1),t),this.Gd("Research "+e.name+" lvl "+(e.wd+1)+" in "+t.type,"cities/"+t.id+"/researches.json","research[research_type]="+e.name,t),this.Hd("Research",1),t.u[e.name]=e.wd+1)},we:function(){if(this.trace(),!this.ld)return void this.debugResearch("Cities not ready");for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if("DoriaAirport"!=e.type){var i=this.je(e,"research");i?this.Ag(e):this.debugResearch("Already researching",e)}else this.debugResearch("Can't research in "+e.type,e)}}},trainBot={Cg:function(t,e,i,s){if(e.A)for(var n in e.A){var a=this.Re(n,i);if(this["debug"+s](t+" has build req "+n+" of "+e.A[n]+" and it is "+a,i),a<e.A[n])return this["debug"+s]("Skipping "+t,i),!1}if(e.u)for(var o in e.u){var h=i.u[o];if(void 0===h&&(h=0),this["debug"+s](t+" has req "+o+" of "+e.u[o]+" and it is "+h,i),h<e.u[o])return this["debug"+s]("Skiping "+t,i),!1}return!0},xe:function(){if(this.trace(),!this.ld)return void this.debugTrain("Cities is not ready");if(!this.options.Jf)return void this.debugTrain("Train data is not ready");this.debugTrain(this.options.Jf);for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if(e&&"DoriaAirport"!=e.type)for(var i in this.Md){var s=this.Md[i];if(s.i)if(s.h&&"All"!=s.h&&s.h!=e.type)this.debugDefense(i+" can't be trained in "+e.type+" only in "+s.h);else{var n=this.options.Jf[i];if(n){e.units||this.debugTrain("city.units is missing",e);var a=s.t;if(this.Cg(i,a,e,"Train")){var o=10,h=0,r=s.j;if(e.units[i]&&(h=e.units[i]),h>=n)this.debugTrain("Do not train "+i+", there is "+h,e);else if(this.je(e,"units")){if(void 0===r||this.Ye(e,i,r,o,void 0)){this.debugTrain("Train "+o+" "+i,e),this.Dg(i,o,e),this.Hd("Train",o);break}}else this.debugTrain("Already training units",e)}}else this.debugTrain("Do not train "+n+" "+i,e)}else this.debugTrain(i+" is not trainable",e)}}},ye:function(){if(this.trace(),!this.ld)return void this.debugDefense("Cities not ready");for(var t=0;t<this.ld.length;t++){var e=this.ld[t];if("DoriaAirport"!=e.type)if(this.je(e,"defense_units")){var i=void 0,s=10;for(var n in this.Ed){var a=this.Ed[n];if(a.i)if(a.h&&"All"!=a.h&&a.h!=e.type)this.debugDefense(n+" can't be trained in "+e.type+" only in "+a.h);else{var o=this.Ed[n].t;if(this.Cg(n,o,e,"Defense")){var h=this.Ed[n].j;(!h||this.Ye(e,n,h,s,void 0))&&(i=n,this.debugDefense("Can build "+n,e))}}else this.debugDefense(n+" is not trainable",e)}i?(this.Dg(i,s,e),this.debugTrain("Train "+s+" "+n,e),this.Hd("Defense",s)):this.debugDefense("Failed to find a unit to train",e)}else this.debugDefense("Already training defense units",e)}},Dg:function(t,e,i){this.Gd("Train "+e+" "+t+" in "+i.type,"cities/"+i.id+"/units.json","_method=post&units[include_requirements]=false&units[quantity]="+e+"&units[unit_type]="+t,i)}},utilBot={bind:function(t){if(t){var e=this;return function(){return t.apply(e,arguments)}}},cg:function(t,e){void 0===e?$(document).trigger(t):$(document).trigger(t,e)},fe:function(t,e){$(document).bind(t,this.bind(e))},Yf:function(t){return t=parseInt(t,10),t>=1e9?(t=Math.floor(t/1e8),t/=10,t+=" B"):t>=1e6?(t=Math.floor(t/1e5),t/=10,t+=" M"):t>=1e3&&(t=Math.floor(t/100),t/=10,t+=" K"),t}};if($&&$("#game_frame")&&($("#game_frame").width("1281px"),setTimeout(function(){location.reload()},72e5)),GM_addStyle(css),-1!=window.location.href.indexOf("platforms/kabam/game")){combine(bot,attackBot,bondsBot,buildBot,guiBot,itemBot,reportBot,trainBot,bailoutBot,collectBot,prizeBot,researchBot,optionsBot,parserBot,queueBot,debugBot,utilBot,armorBot),bot.Md=attackUnits,bot.Ed=defenseUnits,bot.Te=buildings,bot.u=research,bot.ag=items;var src=convertToSource(bot);src="var bot = "+src+";\n",src+="bot.start();",inject(src)}