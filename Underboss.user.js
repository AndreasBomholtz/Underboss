// ==UserScript==
// @name        The Underboss
// @namespace   Underboss
// @author      MrAnderson
// @description A bot for the game The Godfather from kabam.com
// @include     https://www.kabam.com/games/the-godfather/play*
// @include     https://www.kabam.com/*/games/the-godfather/play*
// @include     https://*godfather.*.com/platforms/kabam/game*
// @version     2.0.4
// @grant       GM_addStyle
// @downloadURL https://raw.githubusercontent.com/AndreasBomholtz/Underboss/master/Underboss.user.js
// ==/UserScript==
function combine(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(void 0!==i)for(var s=Object.keys(i),a=0;a<s.length;a++){var n=s[a];t[n]=i[n]}}return t}function convertToSource(t){var e,i=[];if("object"==typeof t&&void 0==t.join){i.push("{");for(e in t)i.push(e,": ",convertToSource(t[e]),",");i.push("}")}else if("object"==typeof t&&void 0!=t.join){i.push("[");for(e in t)i.push(convertToSource(t[e]),",");i.push("]")}else"function"==typeof t?i.push(t.toString()):i.push(JSON.stringify(t));return i.join("")}function inject(t){var e=document.createElement("script");e.innerHTML=t,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)}var attackUnits={g:{type:"Basic",h:"All",i:!0,j:{k:750,l:281,m:563,o:281,p:10},q:2250},s:{type:"Basic",h:"All",i:!0,t:{u:{v:1},A:{B:2}},j:{k:1100,l:825,m:413,o:413,p:10},q:3300},C:{type:"Intermediate",h:"All",i:!0,t:{u:{D:4},A:{F:3,B:3}},j:{k:1700,l:638,m:1274,o:638,p:20},q:5100},G:{type:"Intermediate",h:"All",i:!0,t:{u:{H:6},A:{I:3,B:4}},j:{k:2700,l:2025,m:1013,o:1013,p:20},q:8100},J:{type:"Advanced",h:"All",i:!0,t:{u:{H:7,D:7},A:{B:6,I:5,F:5}}},K:{type:"Advanced",h:"All",i:!0,t:{u:{D:8},A:{F:6,B:7}},q:17100},L:{type:"Expert",h:"All",i:!0,t:{u:{H:10},A:{I:6,B:8}}},M:{type:"Expert",h:"All",i:!0,t:{u:{D:12},A:{F:9,B:9}}},N:{type:"Elite",h:"All",i:!0,t:{u:{H:14,D:14},A:{B:9,I:9,F:9}},q:46800},O:{type:"Elite",h:"All",i:!0,t:{u:{H:16,P:17},A:{I:9,B:9}}},R:{type:"Femme Fatale",h:"All",i:!0,t:{u:{H:17},A:{B:9,I:9}},q:56628},S:{type:"Femme Fatale",h:"All",i:!0,t:{u:{D:17},A:{B:9,F:9}},q:56628},T:{type:"Normal",h:"All",i:!0,j:{k:500,l:188,m:188,o:375,p:10}},U:{type:"Normal",h:"All",i:!0,t:{u:{V:6,W:8},A:{B:5,F:2}}},X:{},Y:{type:"Pulitori",h:"LittleItaly",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},_:{type:"Pulitori",h:"GreenwichVillage",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},aa:{type:"Pulitori",h:"Brooklyn",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ba:{type:"Pulitori",h:"ParkAvenue",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ca:{type:"Pulitori",h:"AtlanticCity",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},da:{type:"Pulitori",h:"Chinatown",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ea:{type:"Pulitori",h:"Captial",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},fa:{type:"Pulitori",h:"Harlem",i:!0,t:{u:{Z:12,$:12},A:{B:9}},q:62292},ga:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ha:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ia:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ja:{type:"Johnney Law",h:"ParkAvenue",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ka:{type:"Johnney Law",h:"Chinatown",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},la:{type:"Johnney Law",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},ma:{type:"Johnney Law",h:"Harlem",i:!0,t:{u:{Z:16,$:16},A:{B:10,I:10,F:10}},q:68520},na:{type:"Clean-up Crew",q:75e3},oa:{type:"Clean-up Crew",q:75e3},pa:{type:"Clean-up Crew",q:75e3},qa:{type:"Clean-up Crew",q:75e3},ra:{type:"Clean-up Crew",q:75e3},sa:{type:"Clean-up Crew",q:75e3},ta:{type:"Clean-up Crew",q:75e3},ua:{i:!1},va:{i:!1},wa:{i:!1},xa:{i:!1},ya:{i:!1},za:{i:!1},Aa:{i:!1},Ba:{i:!1},Ca:{i:!1},Da:{i:!1},Ea:{i:!1},Fa:{i:!1}},buildings={Ga:{Ha:1,j:{k:600,l:200,m:200,o:500}},Ia:{Ha:1,j:{k:600,l:200,m:500,o:200}},Ja:{Ha:1,j:{k:600,l:500,m:200,o:200}},Ka:{Ha:6,j:{k:500,l:100,m:100,o:100}},B:{j:{k:1200,l:500,m:500,o:500}},La:{Ma:1,t:{A:{5:{Na:5},7:{Na:7},8:{Na:8}}},j:{k:2500,l:300,m:300,o:300}},Oa:{Ma:2,j:{k:2500,l:1500,m:200,o:200}},Pa:{t:{Qa:4},j:{k:1500,l:1e3,m:300,o:300}},F:{t:{A:{2:{Ia:5}},Qa:9},j:{k:2e3,l:300,m:1e3,o:300}},Ra:{t:{Qa:3},j:{k:3e3,l:300,m:300,o:1e3}},I:{t:{Qa:7},j:{k:3e3,l:300,m:1e3,o:300}},Sa:{t:{Qa:6},j:{k:2e3,l:500,m:300,o:300}},Na:{j:{k:6e3,l:1e3,m:1e3,o:1e3}},Ta:{t:{A:{0:{Ga:3}},Qa:8},j:{k:1500,l:300,m:300,o:1e3}},Ua:{t:{Qa:3},j:{k:3e3,l:300,m:300,o:1e3}},Va:{t:{Qa:5},j:{k:1500,l:500,m:1500,o:500}},Wa:{Ma:2,t:{A:{2:{Sa:3}}},j:{k:3e3,l:300,m:300,o:1e3}}},collect=["KickbackBundle100","KickbackBundle250","KickbackBundle500","KickbackBundle1000","KickbackBundle3000","AppointmentBundle100","AppointmentBundle250","AppointmentBundle500","AppointmentBundle1000","AppointmentBundle3000","FavorBundle100","FavorBundle250","FavorBundle500","FavorBundle1000","FavorBundle3000","AssortedResourcesBundle","InitiateBundle","TributeTicketBundle10"],defenseUnits={Xa:{h:"All",i:!1,t:{u:{v:4},A:{Ta:2,Na:2}},j:{k:1700,l:638,m:638,o:1275}},Ya:{h:"All",i:!1,t:{u:{v:8},A:{Ta:4,Na:4}},j:{k:1700,l:638,m:638,o:1275}},Za:{h:"All",i:!1,t:{u:{v:12},A:{Ta:6,Na:6}}},$a:{h:"All",i:!1,t:{u:{v:14},A:{Ta:7,Na:7}}},_a:{h:"All",i:!1,t:{u:{v:16},A:{Ta:8,Na:8}}},ab:{h:"All",i:!1,t:{u:{v:18},A:{Ta:9,Na:9}}},bb:{h:"All",i:!1,t:{u:{Z:16,$:16},A:{B:10,Ta:10,Na:10}}},cb:{i:!1},eb:{i:!1},fb:{i:!1}},prizes={gb:1,hb:3,ib:5,jb:10,kb:15,lb:40,mb:65,nb:95,ob:10,pb:7,qb:7,rb:7,sb:35,tb:35,ub:40,vb:40,wb:40,xb:25,yb:40,zb:10,Ab:35,Bb:35,Cb:30,Db:7,Eb:9,Fb:25,Gb:5,Hb:10,Ib:2,Jb:10,Kb:150,Lb:300,Mb:300,Nb:35,Ob:35,Pb:40,Qb:40,Rb:10,Sb:40,Tb:40,Ub:1,Vb:2,Wb:5,Xb:1,Yb:2,Zb:5,$b:15,_b:1,ac:3,bc:5,cc:10,dc:10,ec:10,fc:10,gc:5,hc:10,ic:10,jc:10,kc:10,lc:10,mc:20,nc:20,oc:10,pc:10,qc:10,rc:10,sc:10,tc:10,uc:20,vc:75,wc:135,xc:300,yc:40,zc:95,Ac:12,Bc:10,Cc:20,Dc:35,Ec:40,Fc:75,Gc:35,Hc:40,Ic:60,Jc:75,Kc:10,Lc:30,Mc:30,Nc:30,Oc:30,Pc:30,Qc:30,Rc:30,Sc:30,Tc:30,Uc:30,Vc:10},research={W:{Ma:4,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:250,l:175,m:175,o:175}},Wc:{Ma:5,t:{u:["Capacity"],A:"Garage"},j:{k:400,l:200,m:200,o:200}},Xc:{Ma:2,t:{u:["Logistics"],A:"CementFactory"},j:{k:150,l:100,m:100,o:200}},Yc:{Ma:4,t:{u:["Maneuver"]},j:{k:400,l:200,m:200,o:200}},P:{Ma:2,t:{u:["Logistics"],A:"Restaurant"},j:{k:150,l:200,m:100,o:100}},H:{Ma:5,t:{u:["Capacity"],A:"Hideout"},j:{k:400,l:200,m:200,o:200}},v:{Ma:1,t:{u:[],A:"Library"},j:{k:225,l:150,m:300,o:150}},Zc:{Ma:3,t:{u:["Spying"],A:"Garage"},j:{k:250,l:175,m:175,o:175}},V:{Ma:4,t:{u:["Trafficking"]},j:{k:250,l:175,m:175,o:175}},Z:{Ma:6,t:{u:["Construction","Corruption"]},j:{k:500,l:250,m:250,o:250}},$:{Ma:6,t:{u:["Proficiency","Mechanics"],$c:"GaurdPost"},j:{k:500,l:250,m:250,o:250}},D:{Ma:5,t:{u:["Mechanics"],A:"Workshop"},j:{k:400,l:200,m:200,o:200}},_c:{Ma:2,t:{u:["Logistics"]},j:{k:200,l:150,m:150,o:150}},ad:{Ma:2,t:{u:["Logistics"],A:"SteelMill"},j:{k:150,l:100,m:200,o:100}},bd:{Ma:3,t:{u:["Cooking","Cementing","Steelwork"]},j:{k:200,l:150,m:150,o:150}}},css=".panel,.hiddenPanel{background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');border:1px solid darkred;color:white;position:absolute;top:0;right:0;width:300px;height:688px;z-index:10}.hiddenPanel{height:25px}.header{background-color:darkred;color:white;width:100%;height:25px;text-align:center;font-size:150%;font-weight:bold}.info{width:295px;height:260px}.textinfo{width:295px;height:95px}.prize_info{width:295px;height:200px}div.option{width:110px;float:left}div.stats{width:100%}input.button{background-color:darkred;color:white;border-color:red}.tab-box{border-bottom:1px solid darkred;padding-bottom:5px;margin-top:5px}.tab-box a{border:1px solid red;color:white;padding:5px 5px;text-decoration:none;background-color:darkred}.tab-box a.activeLink{background-color:red;border-bottom:0;padding:6px 5px;border-color:darkred}.tabcontent{border:1px solid darkred;border-top:0;overflow-y:auto;height:430px}.hide{display:none}.unit_count{width:25px}input.number{width:35px;margin-right:5px}h7{font-weight:bold;display:block}.overlay{position:absolute;top:50%;left:50%;width:930px;height:640px;margin-left:-1120px;margin-top:-335px;background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');color:white;text-align:center;border-radius:5px;z-index:20;box-shadow:0 0 0 9999px rgba(0,0,0,0.5)}#overview table{width:100%;text-align:left}#overview #total{border-top:double;border-bottom:solid}",attackBot={dd:function(){if(this.trace(),this.ed&&this.ed[0]&&this.ed[0].data){this.options.fd+=2;var t=10*((this.options.fd-1)/2);this.options.gd||(this.options.gd={});for(var e=0;e<this.ed.length;e++){var i=this.ed[e];if(i&&i.data){var s=i.x-t;0>s&&(s=750+s);var a=i.y-t;0>a&&(a=750+a);for(var n=0;n<this.options.fd;n++)for(var d=0;d<this.options.fd;d++){var h=(s+10*n)%750,o=(a+10*d)%750;this.options.gd[h]||(this.options.gd[h]={}),this.options.gd[h][o]?this.debugAttack("Not reloading ("+h+","+o+")"):(this.options.gd[h][o]=!0,this.debugAttack("Get map ("+h+","+o+")"),this.hd("Get map ("+h+","+o+")","map.json","x="+h+"&y="+o,i,this.bind(this.jd)))}this.kd()}}}else setTimeout(this.bind(this.dd),1e3)},ld:function(t,e){this.trace(),this.debugAttack("FindBestGang for "+t.type+" with lvl "+e);var i=new Date,s={md:0},a=1e3;for(var n in this.options.map)for(var d in this.options.map[n]){var h=this.options.map[n][d];if((h.md==e||e>1&&h.md==e-1)&&(!h.nd||h.nd<i.getTime())){var o=Math.abs(n-t.x);o>250&&(o=Math.abs(750-o));var r=Math.abs(d-t.y);r>250&&(r=Math.abs(750-r)),(s.md<h.md||a>o+r&&s.md===h.md)&&(a=o+r,s=h,this.debugAttack("Found better Gang "+s.md+" at ("+n+","+d+") with dist ("+o+" + "+r+") = "+a))}}return s},od:function(){this.trace();var t=6e4,e=new Date;if(!this.ed||!this.ed[0]||!this.ed[0].data)return 1e3;if(!this.options.map)return this.dd(),1e4;if(this.ed&&this.options.pd)for(var i=0;i<this.ed.length;i++){var s=this.ed[i];if(s&&s.data&&s.qd>1&&"DoriaAirport"!=s.type){for(var a={rd:0},n=0;n<this.options.pd.length;n++){var d=this.options.pd[n];this.debugAttack("Order: "+d.rd+" City: "+d.h+" Units: "+d.units,s);var h=!1;if(d.h&&"all"!=d.h&&d.h!=s.type?this.debugAttack("Wrong city",s):h=!0,h){var o=JSON.parse(d.units);for(var r in o)if(!s.data.units[r]||s.data.units[r]<o[r]){this.debugAttack("Do not have "+r+" ("+o[r]+")",s),h=!1;break}}if(h){var l=parseInt(a.rd,10),u=parseInt(d.rd,10);u>l&&(a=d)}}if(a.units){var c=this.ld(s,a.rd);if(c.md>0){this.debugAttack("Attack "+c.md+" Gang at ("+c.x+","+c.y+")",s),c.md<=10&&(c.nd=e.getTime()+18e5);var p=a.units;a.sd&&(p=this.td(s)),this.attack(c.x,c.y,p,s),t=6e5,this.kd()}else this.debugAttack("Failed to find a gang to attack",s)}}else this.debugAttack("No more energy",s)}else this.debugAttack("City or orders not ready");return t},td:function(t){if(this.trace(),t&&t.data&&t.data.units){var e=jQuery.extend(!0,{},t.data.units);for(var i in this.ud)e[i]&&delete e[i];var s=0;for(var a in e)s<t.vd?(e[a]>t.vd-s&&(e[a]=t.vd-s),this.debugAttack("Add attack units "+a+" => "+e[a]+" ("+s+"/"+t.vd+")",t),s+=e[a]):delete e[a];return JSON.stringify(e)}return""},attack:function(t,e,i,s){this.trace(),this.wd("Attack ("+t+","+e+") from "+s.type,"cities/"+s.id+"/marches.json","_method=post&march[x]="+t+"&march[y]="+e+"&march[units]="+i,s),this.xd("Attack",1)}},bailoutBot={yd:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];"DoriaAirport"!=e.type&&this.zd("Update bail","cities/"+e.id+"/cash_jail.json","",e)}},Ad:function(t){if(this.trace(),t)if(t.q){var e=0;t.data&&t.data.resources?e=parseInt(t.data.resources.k,10):this.debugBailout("No resources",t);var i="",s="",a=0;for(var n in t.q){var d=0;if(this.Bd[n]&&this.Bd[n].q){var h=this.Bd[n].q,o=parseInt(t.q[n],10),r=h*o;this.debugBailout(n+" costs "+r+" and all units costs "+a+" and I have "+e,t);var l=parseInt((e-a)/h,10);if(l>0){l=l>o?o:l;var u=l*h;this.debugBailout("I can affort "+l+" "+n+" because it cost "+u+" and I have "+(e-a)+" ("+e+")",t),d=l,a+=u}else this.debugBailout("Can't affort "+n+" because it cost "+h+" and I have "+(e-a)+" ("+e+")",t)}else this.debug("Missing bailout for "+n,t);d>0&&(i+="&units["+n+"]="+d,s+=d+" "+n+", ")}t.q={},""!==i?(this.debugBailout(s,t),this.wd("Pay Bailout in "+t.type,"cities/"+t.id+"/cash_jail/bail.json","payment_method=cash"+i,t)):this.debugBailout("No bailout data to send",t)}else this.debugBailout("No bailout",t);else this.debugBailout("City is missing")}},bondsBot={Cd:function(){if(this.debugBonds("Get Bonds"),this.ed){var t=this.ed[0];this.zd("Get Bonds","bonds.json","action=index",t)}},Dd:function(){if(this.debugBonds("Handle bonds"),this.ed){var t=this.ed[0];this.wd("Collect Bonds","bonds/redeem.json","action=index",t)}}},bot={Ed:{Fd:{},$c:{},Gd:{},Hd:{},Id:{},Jd:{},Kd:{},Ld:{},Md:{},Nd:{},Wa:{},Od:{},Pd:{},Qd:{},Rd:{}},bind:function(t){if(t){var e=this;return function(){return t.apply(e,arguments)}}},Sd:function(t){$(document).trigger(t)},Td:function(t,e){$(document).bind(t,this.bind(e))},Ud:function(t){this["changeEnable"+t]=function(){this.options["enable"+t]=this.Vd["enable_"+t].checked,this.kd(),this.debug("Enable "+t+": "+this.options["enable"+t])}},Wd:function(t){this["auto"+t+"Thread"]=function(){var e=this.bind(this["auto"+t+"Thread"]),i=6e4;if(this.ed&&this.options["enable"+t]){var s=this["do"+t]();s&&(i=s)}setTimeout(e,i)},this["auto"+t+"Thread"]()},Xd:function(t){this["changeDebugEnable"+t]=function(){this["enableDebug"+t]=this.Vd["enable_debug_"+t].checked,this.debug("Enable Debug "+t+": "+this["enableDebug"+t])}},Yd:function(t){if(this.ed)for(var e=0;e<this.ed.length;e++)if(this.ed[e].id==t)return this.ed[e];return void 0},Zd:function(t,e){var i=0;if(e&&e.$d&&e.$d.length)for(var s=0;s<e.$d.length;s++){var a=e.$d[s];if(a&&a._d)for(var n=a._d,d=0;d<n.length;d++)n[d].type==t&&i<n[d].level&&(i=n[d].level)}return i},ae:function(t,e){this.trace();var i=0;if(t&&t._d)for(var s=t._d,a=0;a<s.length;a++)"neighborhood"==s[a].location&&(void 0!==e||s[a].hasOwnProperty("unlocked")||"Exchange"==s[a].type?s[a].type==e&&i++:i++);return i},be:function(t){this.trace();var e=[],i=0;for(i=0;45>i;i++)e[i]=!0;if(t&&t._d)for(var s=t._d,a=0;a<s.length;a++)s[a].hasOwnProperty("slot")&&"neighborhood"==s[a].location&&(e[s[a].ce]=!1);for(i=0;i<e.length;i++)if(e[i])return i;return 0},xd:function(t,e){this.options.de||(this.options.de={}),this.options.de[t]||(this.options.de[t]=0),this.options.de[t]+=e,this.kd(),this.ee()},fe:function(t){var e,i,s;if(t){if("string"==typeof t&&(t=JSON.parse(t)),t.timestamp){var a=new Date,n=a.getTime()/1e3;this.ge=n-t.timestamp}if(t.ed&&t.ed[0]&&t.ed[0].id&&(this.ed||(this.ed=t.ed,this.Sd("cities:update"))),t.neighborhoods)for(s in t.neighborhoods){var d=t.neighborhoods[s];if(d&&d._d&&d._d.length){var h=d._d;if(h[0]&&h[0].city_id&&(i=this.Yd(t.neighborhoods.$d._d[0].city_id))){i.$d||(i.$d=[]),d.h=i;var o=!0;for(e=0;e<i.$d.length;e++)if(i.$d[e].id==d.id){o=!1;break}o&&i.$d.push(d)}}}if(t.h&&(i=this.Yd(t.h.id))){if(i.data&&i.data.he&&t.h.he)for(e=0;e<i.data.he.length;e++){var r=!1;for(s=0;s<t.h.he.length;s++)if(i.data.he[e].ie==t.h.he[s].ie){r=!0;break}!r&&i.data.he[e].ie&&this.je(i.data.he[e].ie)}i.data=t.h,this.Sd("jobs:update"),t.h.figures&&t.h.figures.marches&&(i.vd=t.h.figures.marches.vd)}if(t.terrain){this.options.map||(this.options.map={});for(var l in t.terrain){var u=t.terrain[l];for(var c in u){var p=u[c];("Gang"==p[0]||"BossGang"==p[0])&&(this.options.map[p[2]]||(this.options.map[p[2]]={}),this.options.map[p[2]][p[3]]||(this.options.map[p[2]][p[3]]={}),this.options.map[p[2]][p[3]].md="Gang"==p[0]?p[1]:parseInt(p[1],10)+10,this.options.map[p[2]][p[3]].x=p[2],this.options.map[p[2]][p[3]].y=p[3])}}}if(t.ke&&(this.le=t.ke),t.me&&(this.me=t.me,this.Sd("player:items")),t.ne&&(this.ne=t.ne,this.Sd("player:quests")),t.level&&(this.oe=t.level),t.result){if(t.result.pe)this.qe=t.result.pe,this.re=t.result.re;else if(t.result.item_won)for(var f in t.result.item_won)this.ed?this.se("Won: "+f,this.ed[0]):this.se("Won: "+f);if(t.result.prize)if(i=this.Yd(t.result.city_id),t.result.prize.prize_type)this.se("Won: "+t.result.prize.prize_type,i);else for(var b in t.result.prize)"cash_multiplier"!=b&&this.se("Won: "+b+" "+t.result.prize[b],i);if(t.result.job&&(i=this.Yd(t.result.job.city_id),i&&i.data&&(i.data.he||(i.data.he=[]),i.data.he.push(t.result.job),this.Sd("jobs:update"))),this.te.h&&t.result.units&&(this.te.h.q=t.result.units,this.Ad(this.te.h)),t.result.ue&&(this.ue=t.result.ue),t.result.ve&&(this.debugReport("Update reports"),this.we={},this.we.total=t.result.total,this.we.we=t.result.ve,this.Sd("report:update")),t.result.bonds_list)for(e=0;e<t.result.bonds_list.length;e++){var g=t.result.bonds_list[e];"BearerBond"==g.name&&100==g.quantity&&this.Dd()}}t.qd&&this.te.h&&(this.te.h.qd=t.qd)}},xe:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.debug("Error sending command"),this.debug(this.te),void 0!==this.te.ye&&this.te.ye()},ze:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&t.result&&(t.result.Ae||(this.debug("Command send Error: "+t.result.errors[0]),this.debug(this.te),this.te.h?this.Be(this.te.h):this.Ce())),this.fe(t),void 0!==this.te.ye&&this.te.ye()},De:function(t,e,i){this.trace();var s=!1;if(t&&t.data&&t.data.he){s=!0;for(var a=0;a<t.data.he.length;a++)if(void 0===i){if(t.data.he[a].ie&&t.data.he[a].ie==e){s=!1;break}}else if(t.data.he[a].Ee&&t.data.he[a].Ee==i){s=!1;break}if(s){var n=new Date,d=n.getTime(),h={Fe:d};void 0===i?h.ie=e:h.Ee=i,t.data.he.push(h)}}return s},Be:function(t){if(this.trace(),t&&t.id){var e="unknown";t.data&&t.data.type&&(e=t.data.type),t.type&&(e=t.type),this.zd("Load city "+e,"cities/"+t.id+".json","",t),this.zd("Load city "+e+" neighborhood","cities/"+t.id+"/neighborhood_buildings.json","",t);var i=new Date;t.Ge=i.getTime()}},He:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++)this.Be(this.ed[t])},Ie:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=new Date;(!this.ed[t].Ge||this.ed[t].Ge<e.getTime()+300)&&this.Be(this.ed[t])}},Je:function(){if(this.trace(),this.ed&&this.ed[0]&&this.ed[0].id){for(var t=0;t<this.ed.length;t++)this.wd("Load Game Data","player/game_loaded.json","_method=put",this.ed[t]);this.He()}},Ce:function(){this.trace(),this.zd("Load Player","player.json")},Ke:function(){this.trace();var t=this.bind(this.Je);this.zd("Load Player Init","player.json","",void 0,t)},Le:function(t,e,i,s,a,n,d){this.trace(),void 0!==a&&(""!==i&&(i+="&"),i+="city_id="+a.id);var h={};h.name=t,h.type=s,h.url=this.Me+e,h.h=a,h.data=i+"&_session_id="+this.Ne+"&gangster="+this.Qa+"&user_id="+this.Oe,h.ye=n,d===!0?this.Pe(this.Qe,h):this.Pe(this.ie,h)},Pe:function(t,e){for(var i=0;i<t.length;i++)if(t[i].url==e.url&&t[i].data==e.data&&-1==e.name.indexOf("Collect "))return void this.debug("Dropping double command: "+e.name,e.h);t.push(e),this.Sd("queue:update")},wd:function(t,e,i,s,a){this.Le(t,e,i,"POST",s,a,!1)},zd:function(t,e,i,s,a){this.Le(t,e,i,"GET",s,a,!1)},Re:function(t,e,i,s,a){this.Le(t,e,i,"POST",s,a,!0)},hd:function(t,e,i,s,a){this.Le(t,e,i,"GET",s,a,!0)},Se:function(){this.ie.length>0?this.Te(this.ie.shift()):this.Qe.length>0&&this.Te(this.Qe.shift())},Te:function(t){this.te=t,this.Sd("queue:update");var e=this;$.ajax({type:this.te.type,url:this.te.url,data:this.te.data,Ae:function(t){e.ze(t)},error:function(t){e.xe(t)}})},kd:function(){localStorage.setItem("gfb_options",JSON.stringify(this.options))},Ue:function(){var t=localStorage.getItem("gfb_options");t?this.options=JSON.parse(t):this.options={}},trace:function(){this.Ve&&this.debug(arguments.callee.caller.name)},debug:function(t,e,i){var s=new Date;return"object"==typeof t&&(t=""),e&&e.data&&(t=e.data.type+": "+t),i&&(t=i+": "+t),t=s.toLocaleTimeString()+": "+t},We:function(t){this["enableDebug"+t]=!1,this["debug"+t]=function(e,i){this["enableDebug"+t]&&this.debug(e,i,t)}},je:function(t){this.trace(),"building"==t&&this.options.enableBuild?this.He():"research"==t&&this.options.enableResearch?this.Xe():"units"==t&&this.options.enableTrain?this.Ye():"defense_units"==t&&this.options.enableDefense?this.Ze():-1!=t.indexOf("collect")&&this.options.enableCollect&&this.$e()},_e:function(){var t=this.bind(this.main),e=1e3;if(this.ed)for(var i=new Date,s=i.getTime()/1e3,a=0;a<this.ed.length;a++){var n=this.ed[a];if(n&&n.data&&n.data.he)for(var d=0;d<n.data.he.length;d++){var h=n.data.he[d],o=h.Fe+this.ge;if(s>=o){this.Be(n),n.data.he.splice(d,1),e=1e4,this.je(h.ie);break}}}setTimeout(t,e)},init:function(t){this.Ue(),this.ie=[],this.Qe=[],this.te={},this.Vd={},this.Ve=!1,this.Me=t.apiServer+"/",this.Me=this.Me.replace("http","https"),this.af=t.bf,this.Ne=t.sessionId,this.Oe=t.cf,this.Qa=t.Qa;for(var e in this.Ed)this.Ud(e),this.Wd(e),this.Xd(e),this.We(e);this.Ke(),this.df();var i=this.bind(this.Se);setInterval(i,800);var s=this.bind(this.Ie);setInterval(s,6e4),this._e(),this.ef()},start:function(){"undefined"!=typeof C?this.init(C.attrs):window.setTimeout(this.bind(this.start,this),1e3)}},buildBot={ff:function(t,e){return e*Math.pow(2,t-1)},gf:function(t,e,i,s,a){if(i&&t&&t.data&&t.data.resources){var n=t.data.resources;for(var d in i){var h=0;if(h=a?a(parseInt(s,10),i[d]):i[d]*s,h>parseInt(n[d],10))return void 0===a?this.debugTrain("Can't train "+e+" because "+d+" ("+h+") is more then "+n[d],t):a==this.ff?this.debugBuild("Can't build "+e+" because "+d+" ("+h+") is more then "+n[d],t):this.debugResearch("Can't research "+e+" because "+d+" ("+h+") is more then "+n[d],t),!1}for(var o in i){var r=a(s,i[o]);t.data.resources[o]=parseInt(t.data.resources[o],10)-r}}else i?a==this.ff?this.debugBuild("Missing city data"):this.debugResearch("Missing city data"):a==this.ff?this.debugBuild("Missing cost for "+e):this.debugResearch("Missing cost for "+e);return!0},hf:function(t){if(this.trace(),t&&t._d&&t.h){var e=t.h;if("DoriaAirport"==e.type)return this.debugBuild("Do not build new building in Doria Airport",e),!1;var i=this.Zd("Mansion",t.h),s=3*i+10,a=this.ae(t);if(this.debugBuild("Man Level: "+i+" Total building: "+a+" => "+s,e),s>a){var n=this.be(t),d="Hideout";for(var h in this._d){var o=this._d[h],r=0;if(this.options.A[h]?r=this.options.A[h]:o.Ha&&(r=o.Ha),r){var l=this.ae(t,h);if(r>l){var u=o.j;if(!this.gf(e,h,u,1,this.ff))continue;d=h;break}}}this.if("Build new "+d+" at slot "+n,e);var c="_method=post&city_building[building_type]="+d;return c+="&city_building[include_requirements]=false&city_building[instant_build]=false",c+="&city_building[neighborhood_id]="+t.id+"&city_building[slot]="+n,this.wd("Build new "+d+" at slot "+n+" in "+e.type,"cities/"+e.id+"/buildings.json",c,e),this.xd("Build",1),t._d.push({ce:n,location:"neighborhood",type:d}),!0}this.debugBuild("No more slots for new buildings ("+s+")",e)}else this.debugBuild("Can't find neighborhood or buildings",e);return!1},jf:function(t,e){this.trace();for(var i=["Hideout","Apartment"],s=0;s<i.length;s++){var a=i[s],n=this.Zd(a,t.h);if(9>n&&t&&t._d)for(var d=t._d,h=0;h<d.length;h++){var o=d[h];if(o.type==a&&o.level==n)return e.md=o.level,e.id=o.id,e.name=o.type,e.location=o.location,this.debugBuild("Build Importent "+e.name,t.h),e}}return this.debugBuild("Failed to find impotent building",t.h),e},kf:function(t){if(this.trace(),this.hf(t))return!0;var e={};if(e.md=20,e.id="",e.location="",t&&t._d){for(var i=t._d,s=t.h,a=0;a<i.length;a++){var n=i[a];if(!n.hasOwnProperty("unlocked")&&n.level<9){var d=!0,h=this._d[n.type];if(h&&h.t){var o=h.t;if(o.A){var r=o.A[n.level];if(r)for(var l in r){var u=this.Zd(l,t.h);if(u<r[l]){this.debugBuild("Can't build "+n.type+" because "+l+" is not "+r[l],s),d=!1;break}this.debugBuild(n.type+" has req "+l+" ("+r[l]+") and it is "+u,s)}}if(o.Qa&&o.Qa>this.oe){this.debugBuild("Can't build "+n.type+" because gangster is not "+o.Qa,s),d=!1;break}o.Qa&&this.debugBuild(n.type+" has gangster "+o.Qa+" and we are "+this.oe,s)}else this.debugBuild(n.type+" has no requirements",s);d&&h&&h.j?this.gf(s,n.type,h.j,n.level,this.ff)?this.debugBuild("Lots of resources",s):d=!1:d&&this.debugBuild("Not cost info for "+n.type,s),d&&(e.md>n.level||n.level>3&&e.md==n.level&&"neighborhood"==e.location)&&(e.md=n.level,e.id=n.id,e.name=n.type,e.location=n.location,e.lf=n)}}if(20!=e.md){if(e.md>5){var c=this.jf(t,e);this.gf(s,c.name,this._d[c.name].j,c.md,this.ff)?e=c:this.debugBuild("Do not upgrade importent building, not egnogh rescources",s)}return this.if("Build "+e.name+" "+(e.md+1),s),this.wd("Build "+e.name+" "+(e.md+1)+" in "+s.type,"cities/"+s.id+"/buildings/"+e.id+".json","_method=put",s),e.lf.level++,!0}}return!1},mf:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if("DoriaAirport"==e.type)return void this.debugBuild("Build is disabled for Doria Airport",e);var i=this.De(e,"building");if(i)if(e.$d)for(var s=0;s<e.$d.length&&!this.kf(e.$d[s]);s++);else this.debugBuild("Neighborhood not ready",e);else this.debugBuild("Build queue not ready",e)}else this.debugBuild("Cities not ready")}},collectBot={$e:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if(e&&e.$d)for(var i=0;i<e.$d.length;i++){var s=e.$d[i];if(s&&s._d)for(var a=s._d,n=0;n<a.length;n++){var d=a[n];if(d.hasOwnProperty("unlocked")&&d.unlocked){var h=this.De(s.h,void 0,d.id);if(h){this.debug("Collect "+d.type,e);var o="cities/"+s.h.id+"/npc_buildings/"+d.id+".json",r="_method=put&city_building_id="+d.id;this.wd("Collect "+d.type+" in "+e.type,o,r,s.h),this.xd("Collect",1)}}}}}return 1e3},nf:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if(e&&e.data&&e.data.wildernesses&&e.data.wildernesses)for(var i=0;i<e.data.wildernesses.length;i++){var s=e.data.wildernesses[i];if(s)if("CityScape"==s.type){var a=new Date,n=a.getTime()/1e3,d=n-s.last_collected_at,h=21600;if(d>=h){this.debugCityscape("Collect cityscapes",e),this.wd("Collect Cityscape in "+e.type,"cities/"+e.id+"/wildernesses/collect_all.json","",e),this.xd("CityScape",1);break}this.debugCityscape("Diff is "+d+" < "+h)}else this.debugCityscape("Wild is "+s.type,e);else this.debugCityscape("Wild is empty",e)}else this.debugCityscape("Wilderness is not ready",e)}else this.debugCityscape("Cities is not ready");return 36e5},pf:function(){if(this.trace(),this.ed&&this.ed[0]&&this.ed[0].$d&&this.ed[0].$d.length){var t=this.ed[0];if(t&&t.$d&&t.$d.length)for(var e=0;e<this.ed[0].$d.length;e++){var i=this.ed[0].$d[e];if(i&&i._d)for(var s=0;s<i._d.length;s++)if("Exchange"==i._d[s].type){if(i._d[s].le){var a="cities/"+t.city_id+"/exchanges/"+i._d[s].id+"/collect.json",n="_method=put&_action=collect&city_building_id="+i._d[s].id;return this.wd("Collect Exchange",a,n,this.ed[0]),i._d[s].le=!1,this.if("Collect Exchange"),this.xd("Exchange",1),36e5}this.debugExchange("No free ticket",t)}else this.debugExchange("No Exchange building",t);else this.debugExchange("Buildings not ready",t)}else this.debugExchange("Neighborhod not ready",t)}else this.debugExchange("Cities not ready");return 0},qf:function(){return this.trace(),this.ed&&this.ed[0]&&(this.debugLoyaltyToken("Checking token"),this.zd("Update tokes","loyalty_tokens.json","",this.ed[0],this.bind(this.rf))),36e5},rf:function(){if(this.trace(),this.ue)for(var t=0;t<this.ue.length;t++)this.ue[t].collectable&&(this.debugLoyaltyToken("Collect token"),this.wd("Collect token","loyalty_tokens/collect.json","type="+this.ue[t].type,this.ed[0]),this.xd("Token",1))},sf:function(){if(this.trace(),this.ne)if(this.ne.Completed){var t=this.ne.Completed[0].name;this.debugQuests("Collect quest: "+t),this.wd("Collect Quest","player_quests/claim.json","quest_name="+t+"&_method=put",this.ed[0])}else this.debugQuests("No Completed Quests");else this.debugQuests("No Quests yet")}},guiBot={tf:function(t){this.options.uf||(this.options.uf=[]),this.options.uf.push(t),this.kd()},ef:function(){if(this.trace(),this.options.uf){this.debug("Show Missing prizes");for(var t=0;t<this.options.uf.length;t++){var e=this.options.uf[t];this.vf[e]?this.options.uf.splice(t,1):this.debug("Missing prize info: "+e)}this.kd()}else this.debug("No missing prizes")},wf:function(){this.trace();var t={j:1e3,name:""};if(this.qe&&this.qe.length){for(var e=0;e<this.qe.length;e++)this.vf[this.qe[e].type]?t.j>this.vf[this.qe[e].type]&&(t.j=this.vf[this.qe[e].type],t.name=this.qe[e].type):(this.se(this.qe[e].type+" is unknown"),this.tf(this.qe[e].type));t.j>=10&&(this.xf(),this.le?this.le=!1:this.me&&this.me.DailyChance&&this.me.DailyChance>0&&this.me.DailyChance--,this.Ce())}},yf:function(t){var e=this.zf(t,this.Vd.Af,"enable_","changeEnable",this.options["enable"+t]),i=document.createElement("span");i.innerHTML=" - ",e.appendChild(i),this.Bf(t+" Now",this.bind(this["do"+t]),e)},Cf:function(t){this.zf(t,this.Vd.DebugInfoData,"enable_debug_","changeDebugEnable",!1)},zf:function(t,e,i,s,a){var n=document.createElement("div");e.appendChild(n);var d=document.createElement("div");d.className="option",d.innerHTML=t+": ",n.appendChild(d);var h=document.createElement("input");return h.type="checkbox",h.name=i+t,h.id=i+t,h.checked=a,h.onclick=this.bind(this[s+t]),n.appendChild(h),this.Vd[i+t]=h,n},Bf:function(t,e,i){var s=document.createElement("input");s.name=t,s.value=t,s.type="button",s.onclick=e,void 0===i?this.Vd.Af.appendChild(s):i.appendChild(s)},Df:function(t,e){var i=document.createElement("a");return i.href="javascript:;",i.className="tabLink",i.id=t,i.innerHTML=e,i.onclick=function(){var t=$(this).attr("id");return $(".tabLink").removeClass("activeLink"),$(this).addClass("activeLink"),$(".tabcontent").addClass("hide"),$("#"+t+"_data").removeClass("hide"),!1},i},Ef:function(t){var e=document.createElement("div");return e.id=t+"_data",e.className="tabcontent hide",e},df:function(){var t=document.createElement("div");t.setAttribute("id","panel"),t.setAttribute("class","panel"),document.body.appendChild(t),this.Vd.Ff=t;var e=document.createElement("p");e.className="header",e.innerHTML="The Underboss",e.onclick=function(){$("#panel").hasClass("panel")?($("#panel").removeClass("panel").addClass("hiddenPanel"),$("#mainPanel").hide()):($("#panel").removeClass("hiddenPanel").addClass("panel"),$("#mainPanel").show())},t.appendChild(e);var i=document.createElement("div");i.setAttribute("id","mainPanel"),this.Vd.Ff.appendChild(i),this.Vd.Af=i;for(var s in this.Ed)this.yf(s);this.Gf();var a=document.createElement("div");i.appendChild(a);var n=document.createElement("div");n.className="tab-box",a.appendChild(n);for(var d=["Info","Prizes","Attack","Map","Train","Build","Debug"],h=0;h<d.length;h++){n.appendChild(this.Df("info-"+(h+1),d[h]));var o=this.Ef("info-"+(h+1));a.appendChild(o),this.Vd[d[h]+"InfoData"]=o,this["draw"+d[h]+"Tab"]&&this["draw"+d[h]+"Tab"](o)}this.Td("queue:update",this.Hf)},If:function(t){$(t).Vd("<h7>Debug Info</h7>").append($("<div/>").attr("id","debug_jobs")).append($("<div/>").attr("id","debug_queue")),this.Bf("Update Jobs",this.bind(this.He),t),this.Bf("Execute",this.bind(this.Jf),t),this.Bf("Trace",this.bind(this.Kf),t),this.Bf("Overview",this.showoverview,t);for(var e in this.Ed)this.Cf(e);this.Td("jobs:update",this.Lf),this.Td("report:update",this.Mf)},Kf:function(){this.Ve=!this.Ve},Jf:function(){var cmd=window.prompt("Enter CMD","");try{var res=eval(cmd);res&&this.debug(res)}catch(t){alert(t)}},Hf:function(){$("#debug_queue").Vd("<h7>Queue: "+this.ie.length+"</h7><h7>Slow Queue: "+this.Qe.length+"</h7>")},Lf:function(){var t=$("#debug_jobs").Vd("<h7>Jobs</h7>");if(this.ed)for(var e=0;e<this.ed.length;e++){var i=this.ed[e];if(i&&i.data&&i.data.he){for(var s,a,n,d="&nbsp;",h=0;h<i.data.he.length;h++)"research"==i.data.he[h].ie&&(a="R"),"building"==i.data.he[h].ie&&(s="B"),"units"==i.data.he[h].ie&&(n="U"),"defense_units"==i.data.he[h].ie&&(d="D");t.append("<h7>"+i.type+" ("+i.data.he.length+") "+s+" "+a+" "+n+" "+d+"</h7>")}}},Nf:function(t){this.Vd.A={},this.options.A||(this.options.A={}),t.innerHTML="<h7>Build Orders</h7><p>Build this amount of buildings and the rest will be Hideout.</p>";var e=document.createElement("table");t.appendChild(e);var i=!1;for(var s in this._d)if(this._d[s].Ha){var a=document.createElement("tr");e.appendChild(a);var n=document.createElement("td");n.innerHTML=s,a.appendChild(n),n=document.createElement("td"),a.appendChild(n);var d=document.createElement("input");this.options.A.hasOwnProperty(s)&&"number"==typeof this.options.A[s]?d.value=this.options.A[s]:(d.value=this._d[s].Ha,i=!0),this.Vd.A[s]=d,n.appendChild(d)}i&&this.Of(),this.Bf("Save",this.bind(this.Of),t)},Of:function(){this.options.A={};for(var t in this._d)this._d[t].Ha&&(this.options.A[t]=parseInt(this.Vd.A[t].value,10));
this.kd()},Pf:function(t){t.innerHTML="<h7>Training Orders</h7>";var e=$("<table/>");$(t).append(e);var i,s=0;for(var a in this.Bd)s%2===0&&(i=$("<tr/>"),e.append(i)),i.append($("<td/>").text(a).append($("<td/>").append($("<input class='number'/>").attr("id","unit_"+a)))),this.options.Qf&&this.options.Qf[a]&&$("#unit_"+a).val(this.options.Qf[a]),s++;this.Bf("Save",this.bind(this.Rf),t)},Rf:function(){this.trace(),this.options.Qf||(this.options.Qf={});for(var t in this.Bd)this.options.Qf[t]=$("#unit_"+t).val();this.kd()},jd:function(){this.Vd.Sf||(this.Vd.Sf=document.createElement("div"),this.Vd.MapInfoData.appendChild(this.Vd.Sf)),this.options.fd||(this.options.fd=2,this.dd()),this.Vd.Sf.innerHTML="<p>Scan size: "+this.options.fd+"</p>";var t,e,i={};for(e in this.options.map)for(var s in this.options.map[e]){var a=this.options.map[e][s];i[a.md]||(i[a.md]=0),i[a.md]++}for(t=1;10>=t;t++)i[t]&&(this.Vd.Sf.innerHTML+="<p>Lvl "+t+" Gangs: "+i[t]+"</p>");for(t=1;5>=t;t++)i[10+t]&&(this.Vd.Sf.innerHTML+="<p>Murder Inc. "+t+": "+i[10+t]+"</p>")},Tf:function(t){t.innerHTML="<h7>Map</h7>",this.Bf("Update Map",this.bind(this.dd),t),this.jd()},Uf:function(t){this.Vd.order={},t.innerHTML="<h7>Attack Orders</h7>",$("<div>City:</div>").append($('<select id="select_attack_city"></select>')).appendTo($(t)),this.Td("cities:update",function(){var t=$("#select_attack_city");if(t.empty(),t.append($('<option value="all">All</option>')),this.ed)for(var e=0;e<this.ed.length;e++)t.append($('<option value="'+this.ed[e].type+'">'+this.ed[e].type+"</option>"))}),$("<div>Gang Level:</div>").append($('<select id="select_gang"></select>')).appendTo($(t));for(var e=$("#select_gang"),i=1;15>=i;i++)e.append($('<option value="'+i+'">'+i+"</option>"));$('<div id="units_p">Units:</div>').append($('<select id="select_units"></select>')).appendTo($(t));var s=$("#select_units");for(var a in this.Bd)s.append($('<option value="'+a+'">'+a+"</option>"));$('<input type="text" id="unit_count" value="0" class="unit_count" />').appendTo($("#units_p")),this.Bf("Add",this.bind(this.Vf),document.getElementById("units_p")),$("<div>Use All:</div>").append('<input type="checkbox" id="check_attack_all" value="all"/>').appendTo($(t)),$('<textarea id="total_units" class="textinfo"></textarea>').appendTo($(t)),this.Bf("Save",this.bind(this.Wf),t),this.Bf("Clear",this.bind(this.Xf),t);var n=document.createElement("hr");t.appendChild(n);var d=document.createElement("select");d.size="10",d.width="100%",t.appendChild(d),this.Vd.order.list=d,this.Bf("Delete",this.bind(this.Yf),t),this.Zf()},Yf:function(){var t=this.Vd.order.list.value;this.options.pd.splice(t,1),this.Zf()},Zf:function(){if(this.Vd.order.list.innerHTML="",this.options.pd)for(var t=0;t<this.options.pd.length;t++){var e=this.options.pd[t];e.h||(e.h="all"),e.sd||(e.sd=!1);var i=document.createElement("option");this.Vd.order.list.appendChild(i),i.value=t,i.innerHTML=e.h+" | "+e.rd+" | "+(e.sd?"t":"f")+" | "+e.units}},Vf:function(){var t=$("#total_units");""!==t.val()&&t.val(t.val()+","),t.val(t.val()+'"'+$("#select_units").val()+'":'+$("#unit_count").val())},Wf:function(){var t={};t.rd=parseInt($("#select_gang").val(),10),t.units="{"+$("#total_units").val()+"}",t.h=$("#select_attack_city").val(),t.sd=$("#check_attack_all").is(":checked"),this.options.pd||(this.options.pd=[]),this.options.pd.push(t),this.kd(),this.Xf(),this.Zf()},Xf:function(){$("#total_units").val("")},ee:function(){var t=$("#stats").Vd("<h3><u>Stats</u></h3>");if(this.options.de)for(var e in this.options.de)t.append($("<p>"+e+": "+this.options.de[e]+"</p>"))},$f:function(t){$(t).append($("<div></div>").addClass("stats").attr("id","stats")),this.ee(),$(t).append($("<textarea></textarea>").addClass("info").attr("id","debug_info"))},_f:function(t){$(t).Vd("<h7>Prizes</h7>").append("<p>Prize Info:</p>").append($("<textarea/>").addClass("prize_info"))},if:function(t,e){$("#debug_info").text(this.debug(t,e)+"\n"+$("#debug_info").text())},se:function(t,e){$(".prize_info").text(this.debug(t,e)+"\n"+$(".prize_info").text())},ag:function(t,e){$("#panel").append("<dialog id='"+t+"' class='overlay'><h1>"+e+"</h1><button id='"+t+"_close'>Close</button></dialog>"),$("#"+t+"_close").click(function(){$("#"+t).hide()}),this["show"+t]=function(){$("#"+t).show()}},Gf:function(){this.ag("overview","Overview"),$("#overview").append("<button id='overview_update'>Update</button>"),$("#overview_update").click(this.bind(this.bg,this)),$("#overview").append("<table id='overview_table'></table>"),$("#overview_table").append("<tr><td>City</td><th>Cash</th><th>Cement</th><th>Food</th><th>Steel</th><th>Jobs</th></tr><tr id='total'><td>Total</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),this.Td("jobs:update",this.bg),this.Td("cities:update",this.bg),this.bg()},cg:function(t){return t=parseInt(t,10),t>=1e9?(t=Math.floor(t/1e8),t/=10,t+=" B"):t>=1e6?(t=Math.floor(t/1e5),t/=10,t+=" M"):t>=1e3&&(t=Math.floor(t/100),t/=10,t+=" K"),t},bg:function(){var t=$("#overview_table"),e=t.find("#total"),i=this.cg;if(this.ed){for(var s={},a=0;a<this.ed.length;a++){var n=this.ed[a];if(n&&n.data){var d=t.find("#"+n.data.type);if(0===d.length&&(e.before("<tr id='"+n.data.type+"'><td>"+n.data.type+"</td><td id='cash'>0</td><td id='cement'>0</td><td id='food'>0</td><td id='steel'>0</td><td id='jobs'></td></tr>"),d=t.find("#"+n.data.type)),n.data.resources&&$.each(n.data.resources,function(t,e){var a=s[t]||0;a+=parseInt(e,10),s[t]=a,d.find("#"+t).Vd(i(e))}),n.data.he){for(var h,o,r,l="&nbsp;",u=0;u<n.data.he.length;u++)"research"==n.data.he[u].ie&&(o="R"),"building"==n.data.he[u].ie&&(h="B"),"units"==n.data.he[u].ie&&(r="U"),"defense_units"==n.data.he[u].ie&&(l="D");d.find("#jobs").Vd("("+n.data.he.length+") "+h+" "+o+" "+r+" "+l)}}}$.each(s,function(t,s){e.find("#"+t).Vd(i(s))})}}},itemBot={dg:function(){if(this.me)if(this.ed)for(var t=this.ed[0],e=0;e<this.collect.length;e++){if(this.me[this.collect[e]])return this.debugItems(this.collect[e]+": "+this.me[this.collect[e]]),this.me[this.collect[e]]--,this.wd("Collect "+this.collect[e],"player_items/"+this.collect[e]+".json","_method=delete",t),this.xd("Item",1),1e3;this.debugItems("Can't find "+this.collect[e]+" in items",t)}else this.debugItems("Cities is not ready");else this.debugItems("Items is not ready");return 1e3}},optionsBot={kd:function(){localStorage.setItem("gfb_options",JSON.stringify(this.options))},Ue:function(){var t=localStorage.getItem("gfb_options");t?this.options=JSON.parse(t):this.options={}}},parserBot={fe:function(t){var e,i,s;if(t){if("string"==typeof t&&(t=JSON.parse(t)),t.timestamp){var a=new Date,n=a.getTime()/1e3;this.ge=n-t.timestamp}if(t.ed&&t.ed[0]&&t.ed[0].id&&(this.ed||(this.ed=t.ed,this.Sd("cities:update"))),t.neighborhoods)for(s in t.neighborhoods){var d=t.neighborhoods[s];if(d&&d._d&&d._d.length){var h=d._d;if(h[0]&&h[0].city_id&&(i=this.Yd(t.neighborhoods.$d._d[0].city_id))){i.$d||(i.$d=[]),d.h=i;var o=!0;for(e=0;e<i.$d.length;e++)if(i.$d[e].id==d.id){o=!1;break}o&&i.$d.push(d)}}}if(t.h&&(i=this.Yd(t.h.id))){if(i.data&&i.data.he&&t.h.he)for(e=0;e<i.data.he.length;e++){var r=!1;for(s=0;s<t.h.he.length;s++)if(i.data.he[e].ie==t.h.he[s].ie){r=!0;break}!r&&i.data.he[e].ie&&this.je(i.data.he[e].ie)}i.data=t.h,this.Sd("jobs:update"),t.h.figures&&t.h.figures.marches&&(i.vd=t.h.figures.marches.vd)}if(t.terrain){this.options.map||(this.options.map={});for(var l in t.terrain){var u=t.terrain[l];for(var c in u){var p=u[c];("Gang"==p[0]||"BossGang"==p[0])&&(this.options.map[p[2]]||(this.options.map[p[2]]={}),this.options.map[p[2]][p[3]]||(this.options.map[p[2]][p[3]]={}),this.options.map[p[2]][p[3]].md="Gang"==p[0]?p[1]:parseInt(p[1],10)+10,this.options.map[p[2]][p[3]].x=p[2],this.options.map[p[2]][p[3]].y=p[3])}}}if(t.ke&&(this.le=t.ke),t.me&&(this.me=t.me,this.Sd("player:items")),t.ne&&(this.ne=t.ne,this.Sd("player:quests")),t.level&&(this.oe=t.level),t.result){if(t.result.pe)this.qe=t.result.pe,this.re=t.result.re;else if(t.result.item_won)for(var f in t.result.item_won)this.ed?this.se("Won: "+f,this.ed[0]):this.se("Won: "+f);if(t.result.prize)if(i=this.Yd(t.result.city_id),t.result.prize.prize_type)this.se("Won: "+t.result.prize.prize_type,i);else for(var b in t.result.prize)"cash_multiplier"!=b&&this.se("Won: "+b+" "+t.result.prize[b],i);if(t.result.job&&(i=this.Yd(t.result.job.city_id),i&&i.data&&(i.data.he||(i.data.he=[]),i.data.he.push(t.result.job),this.Sd("jobs:update"))),this.te.h&&t.result.units&&(this.te.h.q=t.result.units,this.Ad(this.te.h)),t.result.ue&&(this.ue=t.result.ue),t.result.ve&&(this.debugReport("Update reports"),this.we={},this.we.total=t.result.total,this.we.we=t.result.ve,this.Sd("report:update")),t.result.bonds_list)for(e=0;e<t.result.bonds_list.length;e++){var g=t.result.bonds_list[e];"BearerBond"==g.name&&100==g.quantity&&this.Dd()}}t.qd&&this.te.h&&(this.te.h.qd=t.qd)}}},prizeBot={xf:function(){this.trace(),this.ed&&this.ed[0]&&this.re&&(this.debugPrize("Get Prize"),this.wd("Get Prize","minigames/save_result.json","minigame_timestamp="+this.re,this.ed[0]),this.xd("Prize",1))},eg:function(){if(this.trace(),this.ed&&this.ed[0]){if(!(this.le||this.me&&this.me.DailyChance&&this.me.DailyChance>0))return this.debugPrize("No prize ticket - Update player data"),this.Ce(),3e5;this.debugPrize("Update Prize"),this.zd("Update Prize","minigames/index.json","",this.ed[0],this.bind(this.wf))}else this.debugPrize("Cities not ready");return 0}},queueBot={Le:function(t,e,i,s,a,n,d){this.trace(),void 0!==a&&(""!==i&&(i+="&"),i+="city_id="+a.id);var h={};h.name=t,h.type=s,h.url=this.Me+e,h.h=a,h.data=i+"&_session_id="+this.Ne+"&gangster="+this.Qa+"&user_id="+this.Oe,h.ye=n,d===!0?this.Pe(this.Qe,h):this.Pe(this.ie,h)},Pe:function(t,e){for(var i=0;i<t.length;i++)if(t[i].url==e.url&&t[i].data==e.data&&-1==e.name.indexOf("Collect "))return void this.debug("Dropping double command: "+e.name,e.h);t.push(e),this.Sd("queue:update")},wd:function(t,e,i,s,a){this.Le(t,e,i,"POST",s,a,!1)},zd:function(t,e,i,s,a){this.Le(t,e,i,"GET",s,a,!1)},Re:function(t,e,i,s,a){this.Le(t,e,i,"POST",s,a,!0)},hd:function(t,e,i,s,a){this.Le(t,e,i,"GET",s,a,!0)},Se:function(){this.ie.length>0?this.Te(this.ie.shift()):this.Qe.length>0&&this.Te(this.Qe.shift())},Te:function(t){this.te=t,this.Sd("queue:update");var e=this;$.ajax({type:this.te.type,url:this.te.url,data:this.te.data,Ae:function(t){e.ze(t)},error:function(t){e.xe(t)}})},xe:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.debug("Error sending command"),this.debug(this.te),void 0!==this.te.ye&&this.te.ye()},ze:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&t.result&&(t.result.Ae||(this.debug("Command send Error: "+t.result.errors[0]),this.debug(this.te),this.te.h?this.Be(this.te.h):this.Ce())),this.fe(t),void 0!==this.te.ye&&this.te.ye()}},reportBot={fg:function(){this.debugReport("Do Reports"),this.zd("Reports","reports.json","count=18&page=1&category=reports")},Mf:function(){if(this.debugReport("Handle Reports"),this.we&&this.we.we){for(var t="",e=0;e<this.we.we.length;e++){var i=this.we.we[e];"attacking"==i.battle_side&&"Won"==i.battle_result&&null===i.read_at&&(t+=i.id+"|")}this.debugReport("Ids: "+t),""!==t&&this.wd("Delete reports","reports/bulk_delete.json","_method=delete&ids="+t)}}},researchBot={gg:function(t,e){for(var i=1;t>i;i++)e*=1.5;return e},hg:function(t){this.trace();var e={md:20,ig:20,id:""};if(t&&t.data&&t.data.u&&t.$d)for(var i in this.u){var s=t.data.u[i],a=!1;if(void 0===s&&(s=0),this.u[i]){var n=this.u[i];if(n.t){var d=n.t;if(d){if(d.A){var h=this.Zd(d.A,t);this.debugResearch(i+" ("+s+"/"+(s-4)+") has req "+d.A+" and it is "+h+" ("+4*h+")",t),h*="Garage"==d.A||"Workshop"==d.A||"GuardPost"==d.A?4:2,s>1&&s>=h&&(this.debugResearch("skip because "+h+" is less then "+s,t),a=!0)}if(!a&&d.u)for(var o=0;o<d.u.length;o++){var r=d.u[o],l=t.data.u[r];void 0===l&&(l=0),this.debugResearch(i+" has req "+r+" and it is "+l,t),s>=l&&(this.debugResearch("Skip because "+l+" is less then "+s,t),a=!0)}}}a||this.gf(t,i,n.j,s,this.gg)||(this.debugResearch("Skip because we can't affort it",t),a=!0)}a||(e.md>s||e.md==s&&e.ig>this.u[i].Ma)&&(e.md=s,e.name=i,e.ig=this.u[i].Ma)}20!=e.md&&(this.if("Research "+e.name+" lvl "+(e.md+1),t),this.wd("Research "+e.name+" lvl "+(e.md+1)+" in "+t.type,"cities/"+t.id+"/researches.json","research[research_type]="+e.name,t),this.xd("Research",1),t.data.u[e.name]=e.md+1)},Xe:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if("DoriaAirport"!=e.type){var i=this.De(e,"research");i?this.hg(e):this.debugResearch("Already researching",e)}}}},trainBot={Ye:function(){if(this.trace(),this.ed&&this.options.Qf){this.debugTrain(this.options.Qf);for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if("DoriaAirport"!=e.type)for(var i in this.Bd){var s=this.options.Qf[i];if(s)if(e&&e.data&&e.data.units){var a=10,n=0,d=this.Bd[i].j;if(e.data.units[i]&&(n=e.data.units[i]),n>=s)this.debugTrain("Do not train "+i+", there is "+n,e);else if(this.De(e,"units")){if(void 0===d||this.gf(e,i,d,a,void 0)){this.debugTrain("Train "+a+" "+i,e),this.jg(i,a,e),this.xd("Train",a);break}}else this.debugTrain("Already training units",e)}else this.debugTrain("Data is missing",e);else this.debugTrain("Do not train "+s+" "+i,e)}}}else this.debugTrain("Train data is not ready")},Ze:function(){if(this.trace(),this.ed)for(var t=0;t<this.ed.length;t++){var e=this.ed[t];if("DoriaAirport"!=e.type)if(this.De(e,"defense_units")){var i=void 0,s=10;for(var a in this.ud){var n=!1,d=this.ud[a].t;if(d.A)for(var h in d.A){var o=this.Zd(h,e);if(this.debugDefense(a+" has build req "+h+" of "+d.A[h]+" and it is "+o,e),o<d.A[h]){this.debugDefense("Skipping",e),n=!0;break}}if(!n&&d.u)for(var r in d.u){var l=e.data.u[r];if(void 0===l&&(l=0),this.debugDefense(a+" has req "+r+" of "+d.u[r]+" and it is "+l,e),l<d.u[r]){this.debugDefense("Skiping",e),n=!0;break}}var u=this.ud[a].j;u&&(this.gf(e,a,u,s,void 0)||(n=!0)),n||(i=a,this.debugDefense("Can build "+a,e))}i?(this.jg(i,s,e),this.debugTrain("Train "+s+" "+a,e),this.xd("Defense",s)):this.debugDefense("Failed to find a unit to train",e)}else this.debugDefense("Already training defense units",e)}},jg:function(t,e,i){this.wd("Train "+e+" "+t+" in "+i.type,"cities/"+i.id+"/units.json","_method=post&units[include_requirements]=false&units[quantity]="+e+"&units[unit_type]="+t,i)}};if($&&$("#game_frame")&&($("#game_frame").width("1281px"),setTimeout(function(){location.reload()},72e5)),GM_addStyle(css),-1!=window.location.href.indexOf("platforms/kabam/game")){combine(bot,attackBot,bondsBot,buildBot,guiBot,itemBot,reportBot,trainBot,bailoutBot,collectBot,prizeBot,researchBot,optionsBot,parserBot,queueBot),bot.Bd=attackUnits,bot.ud=defenseUnits,bot._d=buildings,bot.u=research,bot.vf=prizes,bot.collect=collect;var src=convertToSource(bot);src="var bot = "+src+";\n",src+="bot.start();",inject(src)}