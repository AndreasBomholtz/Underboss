// ==UserScript==
// @name        The Underboss
// @namespace   Underboss
// @author      MrAnderson
// @description A bot for the game The Godfather from kabam.com
// @include     https://apps.facebook.com/play_godfather*
// @include     https://*godfather.*.com/platforms/facebook/game*
// @version     2.2.5
// @grant       GM_addStyle
// @downloadURL https://raw.githubusercontent.com/AndreasBomholtz/Underboss/master/Underboss.user.js
// ==/UserScript==
function combine(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(void 0!==i)for(var s=Object.keys(i),n=0;n<s.length;n++){var a=s[n];e[a]=i[a]}}return e}function convertToSource(e){var t,i=[],s=[];if("object"==typeof e&&void 0==e.join){i.push("{");for(t in e)s.push(t+": "+convertToSource(e[t]));i.push(s.join(",")),i.push("}")}else if("object"==typeof e&&void 0!=e.join){i.push("[");for(var n=0;n<e.length;n++)s.push("'"+e[n]+"'");i.push(s.join(",")),i.push("]")}else if("function"==typeof e){var a=e.toString();-1!=a.indexOf("random")||i.push(a)}else i.push(JSON.stringify(e));return i.join("")}function inject(e){var t=document.createElement("script");t.innerHTML=e,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)}var attackUnits={Thug:{type:"Basic",city:"All",trainable:!0,cost:{cash:750,food:281,steel:563,cement:281,influence:10},bailout:2250},Arsonist:{type:"Basic",city:"All",trainable:!0,requirement:{research:{Logistics:1},build:{Hideout:2}},cost:{cash:1100,food:825,steel:413,cement:413,influence:10},bailout:3300},Demolitionist:{type:"Intermediate",city:"All",trainable:!0,requirement:{research:{Proficiency:4},build:{Garage:3,Hideout:3}},cost:{cash:1700,food:638,steel:1274,cement:638,influence:20},bailout:5100},Bruiser:{type:"Intermediate",city:"All",trainable:!0,requirement:{research:{Corruption:6},build:{Workshop:3,Hideout:4}},cost:{cash:2700,food:2025,steel:1013,cement:1013,influence:20},bailout:8100},Hitman:{type:"Advanced",city:"All",trainable:!0,requirement:{research:{Corruption:7,Proficiency:7},build:{Hideout:6,Workshop:5,Garage:5}},cost:{cash:3800,food:1900,steel:1900,cement:1900,influence:30},bailout:11172},Enforcer:{type:"Advanced",city:"All",trainable:!0,requirement:{research:{Proficiency:8},build:{Garage:6,Hideout:7}},cost:{cash:5700,food:2138,steel:4250,cement:2138,influence:30},bailout:17100},TommyGunner:{type:"Expert",city:"All",trainable:!0,requirement:{research:{Corruption:10},build:{Workshop:6,Hideout:8}},cost:{cash:8500,food:6375,steel:3188,cement:3188,influence:40}},Professional:{type:"Expert",city:"All",trainable:!0,requirement:{research:{Proficiency:12},build:{Garage:9,Hideout:9}},cost:{cash:13e3,food:4875,steel:9750,cement:4875,influence:40}},Sniper:{type:"Elite",city:"All",trainable:!0,requirement:{research:{Corruption:14,Proficiency:14},build:{Hideout:9,Workshop:9,Garage:9}},cost:{cash:15600,food:7800,steel:7800,cement:7800,influence:40},bailout:46800},Butcher:{type:"Elite",city:"All",trainable:!0,requirement:{research:{Corruption:16,Cooking:17},build:{Workshop:9,Hideout:9}},cost:{cash:17160,food:12870,steel:6435,cement:6435,influence:35}},BlackWidow:{type:"Femme Fatale",city:"All",trainable:!0,requirement:{research:{Corruption:17},build:{Hideout:9,Workshop:9}},cost:{cash:18876,food:14157,steel:7079,cement:7079,influence:35},bailout:56628},Assassin:{type:"Femme Fatale",city:"All",trainable:!0,requirement:{research:{Proficiency:17},build:{Hideout:9,Garage:9}},cost:{cash:18876,food:7079,steel:14157,cement:7079,influence:35},bailout:56628},Courier:{type:"Normal",city:"All",trainable:!0,cost:{cash:500,food:188,steel:188,cement:375,influence:10}},DeliveryTruck:{type:"Normal",city:"All",trainable:!0,requirement:{research:{Mechanics:6,Capacity:8},build:{Hideout:5,Garage:2}},cost:{cash:3800,food:1425,steel:1425,cement:2850,influence:15}},Heavyweight:{type:"Pulitori",city:"LittleItaly",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Foreman:{type:"Pulitori",city:"Queens",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Smuggler:{type:"Pulitori",city:"GreenwichVillage",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Undertaker:{type:"Pulitori",city:"Brooklyn",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Doctor:{type:"Pulitori",city:"ParkAve",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Loanshark:{type:"Pulitori",city:"AtlanticCity",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},HatchetMan:{type:"Pulitori",city:"Chinatown",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},TriggerMan:{type:"Pulitori",city:"Capital",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Bartender:{type:"Pulitori",city:"Harlem",trainable:!0,requirement:{research:{Medicine:12,Muscle:12},build:{Hideout:9}},bailout:62292},Hardliner:{type:"Johnney Law",trainable:!0,city:"Queens",requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},CrookedCop:{type:"Johnney Law",trainable:!0,city:"GreenwichVillage",requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},Captain:{type:"Johnney Law",trainable:!0,city:"LittleItaly",requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},DRC:{type:"Johnney Law",city:"Brooklyn",trainable:!0,requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},PIG:{type:"Johnney Law",city:"ParkAve",trainable:!0,requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},Highbinder:{type:"Johnney Law",city:"Chinatown",trainable:!0,requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},Gman:{type:"Johnney Law",trainable:!0,city:"AtlanticCity",requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},Bookie:{type:"Johnney Law",city:"Harlem",trainable:!0,requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,Workshop:10,Garage:10}},bailout:68520},MisterSnip:{type:"Clean-up Crew",bailout:75e3},MisterHaul:{type:"Clean-up Crew",bailout:75e3},MisterFixit:{type:"Clean-up Crew",bailout:75e3},MissesNeat:{type:"Clean-up Crew",bailout:75e3},MisterSplit:{type:"Clean-up Crew",bailout:75e3},MisterKippy:{type:"Clean-up Crew",bailout:75e3},MisterPao:{type:"Clean-up Crew",bailout:75e3},Freighttrain:{trainable:!1},Hitsquad:{trainable:!1},Deathsquad:{trainable:!1},Deliverybomber:{trainable:!1},Medicalcourier:{trainable:!1},Frontman:{trainable:!1},Skinner:{trainable:!1},Bassist:{trainable:!1},Clyde:{trainable:!1},Bonnie:{trainable:!1},Romeo:{trainable:!1},Maneater:{trainable:!1},Carbomber:{trainable:!1}},buildings={SteelMill:{buildNew:1,cost:{cash:600,food:200,steel:200,cement:500}},Restaurant:{buildNew:1,cost:{cash:600,food:200,steel:500,cement:200}},CementFactory:{buildNew:1,cost:{cash:600,food:500,steel:200,cement:200}},Apartment:{buildNew:6,cost:{cash:500,food:100,steel:100,cement:100}},Hideout:{buildNew:-1,cost:{cash:1200,food:500,steel:500,cement:500}},Mansion:{priority:1,requirement:{build:{5:{Wall:5},7:{Wall:7},8:{Wall:8}}},cost:{cash:2500,food:300,steel:300,cement:300}},Library:{priority:2,cost:{cash:2500,food:1500,steel:200,cement:200}},Warehouse:{requirement:{gangster:4},cost:{cash:1500,food:1e3,steel:300,cement:300}},Garage:{requirement:{build:{2:{Restaurant:5}},gangster:9},cost:{cash:2e3,food:300,steel:1e3,cement:300}},Armory:{requirement:{gangster:3},cost:{cash:3e3,food:300,steel:300,cement:1e3}},Workshop:{requirement:{gangster:7},cost:{cash:3e3,food:300,steel:1e3,cement:300}},GuestHouse:{requirement:{gangster:6},cost:{cash:2e3,food:500,steel:300,cement:300}},Wall:{cost:{cash:6e3,food:1e3,steel:1e3,cement:1e3}},GuardPost:{requirement:{build:{0:{SteelMill:3}},gangster:8},cost:{cash:1500,food:300,steel:300,cement:1e3}},Vault:{requirement:{gangster:3},cost:{cash:3e3,food:300,steel:300,cement:1e3}},FrontGate:{requirement:{gangster:5},cost:{cash:1500,food:500,steel:1500,cement:500}},Exchange:{priority:2,requirement:{build:{2:{GuestHouse:3}}},cost:{cash:3e3,food:300,steel:300,cement:1e3}},Condo:{skip:!0},CrewBank:{offset:{cash:146286,res:38152},requirement:{alliance:!0},cost:{cash:43885,food:11445,steel:11445,cement:11445}},FinanciersOffice:{offset:{cash:146286,res:38152},cost:{cash:43885,food:11445,steel:11445,cement:11445}},BlackMarket:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Haberdashery:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Pharmacy:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Hotel:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Gym:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Morgue:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Laundromat:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},DeputyMayorsOffice:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},FerrisWheel:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},GasStation:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Headquarters:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},Hospital:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},ClipJoint:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}},ShootingRange:{offset:{cash:146286,res:38152},cost:{cash:438857,food:114457,steel:114457,cement:114457}}},defenseUnits={BarbedWire:{city:"All",trainable:!0,requirement:{research:{Logistics:4},build:{GuardPost:2,Wall:2}},cost:{cash:1700,food:638,steel:638,cement:1275}},BoobyTrap:{city:"All",trainable:!0,requirement:{research:{Logistics:8},build:{GuardPost:4,Wall:4}},cost:{cash:2700,food:1013,steel:1013,cement:2025}},GuardDog:{city:"All",trainable:!0,requirement:{research:{Logistics:12},build:{GuardPost:6,Wall:6}},cost:{cash:8e3,food:6e3,steel:4e3,cement:1e3}},ArmedGuard:{city:"All",trainable:!0,requirement:{research:{Logistics:14},build:{GuardPost:7,Wall:7},cost:{cash:1e4,food:1600,steel:4e3,cement:8e3}}},Bodyguard:{city:"All",trainable:!0,requirement:{research:{Logistics:16},build:{GuardPost:8,Wall:8}},cost:{cash:17160,food:6435,steel:6435,cement:12870}},UnnamedDefender:{city:"All",trainable:!0,requirement:{research:{Logistics:18},build:{GuardPost:9,Wall:9}},cost:{cash:18876,food:7049,steel:7049,cement:14157}},Moneyman:{city:"Capital",trainable:!0,requirement:{research:{Medicine:16,Muscle:16},build:{Hideout:10,GuardPost:10,Wall:10}},cost:{cash:23e3,food:15e3,steel:15e3,cement:15e3}},LeatherHead:{trainable:!1},Mastermind:{trainable:!1},DonCompanion:{trainable:!1}},items={SpeedUp1Minute:{cost:1},SpeedUp5Minute:{cost:3},SpeedUp15Minute:{cost:5},SpeedUp1Hour:{cost:10},SpeedUp2HalfHour:{cost:15},SpeedUp8Hour:{cost:40},SpeedUp15Hour:{cost:65},SpeedUp24Hour:{cost:95},AttackBoost24Hour:{cost:10},SteelBoost24Hour:{cost:7},CementBoost24Hour:{cost:7},FoodBoost24Hour:{cost:7},CashBoost24Hour:{cost:35},SpeedUpTraining30Percent:{cost:35},SteelBoost1Week:{cost:40},FoodBoost1Week:{cost:40},CementBoost1Week:{cost:40},OliveBranch12Hour:{cost:25},OliveBranch24Hour:{cost:40},HealthBoost24Hour:{cost:10},AttackBoost7Day:{cost:35},HealthBoost7Day:{cost:35},RelocationProgram:{cost:30},WreckingBall:{cost:7},ChangeEstateName:{cost:9},Perfume:{cost:25},Energizer:{cost:5},SlickStitch:{cost:10},BoxingTicket:{cost:2},TokenOfServitude:{cost:10},GreenwichVillageDeed:{cost:150},ParkAveDeed:{cost:300},BrooklynDeed:{cost:300},AtlanticCityDeed:{cost:35},ChinatownDeed:{cost:35},RookieBundle:{cost:40},DonsBlessing:{cost:40},DonsBlessing11:{cost:40},ZoningPermit:{cost:40},ContractBundle100:{cost:1,autoCollect:!1},ContractBundle500:{cost:2,autoCollect:!1},ContractBundle1000:{cost:5,autoCollect:!1},FavorBundle100:{cost:1,autoCollect:!1},FavorBundle250:{cost:2,autoCollect:!1},FavorBundle500:{cost:2,autoCollect:!1},FavorBundle1000:{cost:5,autoCollect:!1},FavorBundle3000:{cost:9,autoCollect:!1},KickbackBundle100:{cost:1,autoCollect:!1},KickbackBundle250:{cost:1,autoCollect:!1},KickbackBundle500:{cost:3,autoCollect:!1},KickbackBundle1000:{cost:5,autoCollect:!1},KickbackBundle3000:{cost:6,autoCollect:!1},AppointmentBundle100:{cost:1,autoCollect:!1},AppointmentBundle250:{cost:2,autoCollect:!1},AppointmentBundle500:{cost:3,autoCollect:!1},AppointmentBundle1000:{cost:4,autoCollect:!1},AppointmentBundle3000:{cost:5,autoCollect:!1},ThugBundle25:{cost:5},ArsonistBundle25:{cost:5},ArsonistBundle400:{cost:100},BruiserBundle25:{cost:5},EnforcerBundle25:{cost:5},DemolitionistBundle25:{cost:5},ArmedGuardBundle100:{cost:5},ArmedGuardBundle500:{cost:25},SniperBundle25:{cost:5},ButcherBundle25:{cost:5},TommyGunnerBundle25:{cost:5},HitmanBundle25:{cost:5},AssassinBundle25:{cost:5},GuardDogBundle100:{cost:5},ProfessionalBundle25:{cost:5},BlackWidowBundle25:{cost:5},BlackWidowBundle100:{cost:20},AssassinBundle100:{cost:20},UnnamedDefenderBundle100:{cost:5},BodyguardBundle100:{cost:5},BodyguardBundle500:{cost:25},LesserAttireMedallion:{cost:40},GreaterAttireMedallion:{cost:95},GreaterLuckyToken:{cost:12},PoisonHealth10Percent10Minutes:{cost:10},PoisonHealth25Percent10Minutes:{cost:20},ColesMotorOil:{cost:35},BronzeToolbox:{cost:40},GoldToolbox:{cost:75},Antidote:{cost:35},BronzeBuildingPermit:{cost:40},SilverBuildingPermit:{cost:60},GoldBuildingPermit:{cost:75},UpgradeGuarantee5:{cost:30},UpgradeGuarantee7:{cost:30},PromoteGuarantee1:{cost:30},PromoteGuarantee2:{cost:30},PromoteGuarantee3:{cost:30},PromoteGuarantee4:{cost:30},PromoteGuarantee5:{cost:30},PromoteGuarantee6:{cost:30},PromoteGuarantee7:{cost:30},BankHeistStamp:{cost:30},TributeTicketBundle10:{cost:5,autoCollect:!1},InitiateBundle:{cost:10,autoCollect:!1},AssortedResourcesBundle:{cost:9,autoCollect:!1},AssortedResources250KBundle:{cost:9,autoCollect:!1},PromotionBundle1000:{cost:40},BootleggerBundle25:{cost:10},AddiopizzoBundle10:{cost:10},AddiopizzoBundle50:{cost:50},AddiopizzoBundle100:{cost:100},BonnieBundle250:{cost:200},BrassManBundle500:{cost:250},MastermindBundle500:{cost:250},MissusPatchBundle500:{cost:250},FrontManBundle500:{cost:250},BassistBundle500:{cost:250},MisterHaulBundle500:{cost:250},JazzManBundle500:{cost:250},DeathSquadBundle500:{cost:250},GManBundle500:{cost:250},MisterSplitBundle500:{cost:250},BookieBundle500:{cost:250},PIGBundle500:{cost:250},HitSquadBundle500:{cost:250},MisterKippyBundle500:{cost:250},AssassinBundle500:{cost:250},HatchetManBundle500:{cost:250},BlackWidowBundle500:{cost:250},DeliveryBomberBundle500:{cost:250},MisterFixitBundle500:{cost:250},UndertakerBundle500:{cost:250},TriggerManBundle500:{cost:250},PromotionBundle500:{cost:250},GuardDogBundle500:{cost:100},HardlinerBundle500:{cost:250},MissesNeatBundle500:{cost:250},MoneyManBundle500:{cost:250},LeatherHeadBundle500:{cost:250},DRCBundle500:{cost:250},BartenderBundle500:{cost:250},SkinnerBundle500:{cost:250},SniperBundle500:{cost:250},GetawayDriverBundle500:{cost:250},MisterSnipBundle500:{cost:250},MedicalCourierBundle500:{cost:250},HighbinderBundle500:{cost:250},AddiopizzoBundle25:{cost:5},LoansharkBundle500:{cost:250},HeavyweightBundle500:{cost:250},TributeTicket:{cost:1},MisterPaoBundle500:{cost:250},AddiopizzoBundle5:{cost:1},UnnamedDefenderBundle500:{cost:250},ForemanBundle500:{cost:250},ButcherBundle500:{cost:250}},research={Capacity:{priority:4,requirement:{research:["Cooking","Cementing","Steelwork"]},cost:{cash:250,food:175,steel:175,cement:175}},Carjacking:{priority:5,requirement:{research:["Capacity"],build:"Garage"},cost:{cash:400,food:200,steel:200,cement:200}},Cementing:{priority:2,requirement:{research:["Logistics"],build:"CementFactory"},cost:{cash:150,food:100,steel:100,cement:200}},Construction:{priority:4,requirement:{research:["Maneuver"]},cost:{cash:400,food:200,steel:200,cement:200}},Cooking:{priority:2,requirement:{research:["Logistics"],build:"Restaurant"},cost:{cash:150,food:200,steel:100,cement:100}},Corruption:{priority:5,requirement:{research:["Capacity"],build:"Hideout"},cost:{cash:400,food:200,steel:200,cement:200}},Logistics:{priority:1,requirement:{research:[],build:"Library"},cost:{cash:225,food:150,steel:300,cement:150}},Maneuver:{priority:3,requirement:{research:["Spying"],build:"Garage"},cost:{cash:250,food:175,steel:175,cement:175}},Mechanics:{priority:4,requirement:{research:["Trafficking"],build:"Wall"},cost:{cash:250,food:175,steel:175,cement:175}},Medicine:{priority:6,requirement:{research:["Construction","Corruption"]},cost:{cash:500,food:250,steel:250,cement:250}},Muscle:{priority:6,requirement:{research:["Proficiency","Mechanics"],build:"GaurdPost"},cost:{cash:500,food:250,steel:250,cement:250}},Proficiency:{priority:5,requirement:{research:["Mechanics"],build:"Workshop"},cost:{cash:400,food:200,steel:200,cement:200}},Spying:{priority:2,requirement:{research:["Logistics"]},cost:{cash:200,food:150,steel:150,cement:150}},Steelwork:{priority:2,requirement:{research:["Logistics"],build:"SteelMill"},cost:{cash:150,food:100,steel:200,cement:100}},Trafficking:{priority:3,requirement:{research:["Cooking","Cementing","Steelwork"]},cost:{cash:200,food:150,steel:150,cement:150}},Barricade:{priority:6,requirement:{research:["Construction","Medicine"],city:"Queens"},cost:{cash:5e3,food:2500,steel:2500,cement:2500}}},css=".panel,.hiddenPanel{background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');border:1px solid darkred;color:white;position:absolute;top:0;right:0;width:300px;height:688px;z-index:10}.hiddenPanel{height:25px}.header{background-color:darkred;color:white;width:100%;height:25px;text-align:center;font-size:150%;font-weight:bold}.info{width:295px;height:260px}.textinfo{width:295px;height:95px}.prize_info{width:295px;height:200px}div.option{width:110px;float:left}div.stats{width:50%;text-align:left}input.button{background-color:darkred;color:white;border-color:red}.tab-box{border-bottom:1px solid darkred;padding-bottom:5px;margin-top:5px}.tab-box a{border:1px solid red;color:white;padding:5px 5px;text-decoration:none;background-color:darkred}.tab-box a.activeLink{background-color:red;border-bottom:0;padding:6px 5px;border-color:darkred}.tabcontent{border:1px solid darkred;border-top:0;overflow-y:auto;height:430px}.hide{display:none}.unit_count{width:25px}input.number{width:35px;margin-right:5px}h7{font-weight:bold;display:block}.overlay{position:absolute;top:50%;left:50%;width:930px;height:640px;margin-left:-1120px;margin-top:-335px;background-color:red;background-image:url('/images/banner/TGFF_banner_bg.jpg');color:white;text-align:center;border-radius:5px;z-index:20;box-shadow:0 0 0 9999px rgba(0,0,0,0.5)}#overview_table{width:100%;text-align:left}#overview_table th{font-weight:bold}#overview #total{border-top:double;border-bottom:solid}input.close{position:absolute;top:0;right:0}",ajaxBot={ajax_send:function(e,t,i,s,n,a){void 0===a&&(a=!0);var o=this,r=new XMLHttpRequest;"GET"==s&&(e+="?"+n),r.open(s,e,a),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t.call(o,r.responseText):i.call(o,r.status,r.responseText))},"POST"==s&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(n)}},armorBot={doArmor:function(){this.trace(),this.eachCity(this.doArmorEvent)},doArmorEvent:function(e){if(this.trace(),!e||e.armory)return void this.debugArmor("City do not have armor",e);for(var t=0;t<e.armor.length;t++){var i=e.armor[t].equipped_armory_item.item_id;this.debugArmor("Has item id "+i,e);var s=this.mapIdToName(i);s?this.debugArmor(s[0]+" ("+s[1]+") Lvl "+s[2]):this.debugArmor(i+" not found",e)}},mapIdToName:function(e){return this.trace(),31>e?e>20?["Piano Wire","Gold",e-19]:e>10?["Stilettos","Silver",e-9]:["Bat","Bronze",e]:61>e?e>50?["Tommy Gun","Gold",e-49]:e>40?["Magnum","Silver",e-39]:["Molotov","Bronze",e-29]:91>e?e>80?["Italian Suit","Gold",e-79]:e>70?["Fedora","Silver",e-69]:["Scarf","Bronze",e-59]:e>110?["Caddy","Gold",e-109]:e>100?["Speedster","Silver",e-99]:["Motorcycle","Bronze",e-89]}},attackBot={resetMap:function(){this.trace(),this.options.map_size=3,this.options.map_loaded={},this.updateMap()},updateMap:function(e){if(e||(e=this),e.trace(),!e.cities||!e.cities[0])return void setTimeout(e.updateMap,1e3,e);e.options.map_size+=2;var t=10*((e.options.map_size-1)/2);e.options.map_loaded||(e.options.map_loaded={}),e.eachCity(function(i){var s=i.x-t;0>s&&(s=750+s);var n=i.y-t;0>n&&(n=750+n);for(var a=0;a<e.options.map_size;a++)for(var o=0;o<e.options.map_size;o++){var r=(s+10*a)%750,d=(n+10*o)%750;e.options.map_loaded[r]||(e.options.map_loaded[r]={}),e.options.map_loaded[r][d]?e.debugAttack("Not reloading ("+r+","+d+")"):(e.options.map_loaded[r][d]=!0,e.debugAttack("Get map ("+r+","+d+")"),e.sendSlowGetCommand("Get map ("+r+","+d+")","map.json","x="+r+"&y="+d,i))}}),e.saveOptions()},findBestGang:function(e,t){this.trace(),this.debugAttack("FindBestGang for "+e.type+" with lvl "+t);var i=new Date,s={lvl:0},n=1e3;for(var a in this.options.map)for(var o in this.options.map[a]){var r=this.options.map[a][o];if(r.lvl!=t&&t>1&&r.lvl!=t-1)this.debugAttack("Gang has wrong level ("+r.lvl+" != "+t,e);else if(s.lvl>r.lvl)this.debugAttack("Selected gang is better ("+s.lvl+" > "+r.lvl+")",e);else if(r.attacked&&r.attacked>=i.getTime())this.debugAttack("Gang already attacked",e);else{var d=Math.abs(a-e.x);d>250&&(d=Math.abs(750-d));var l=Math.abs(o-e.y);l>250&&(l=Math.abs(750-l)),d+l>n&&s.lvl===r.lvl?this.debugAttack("Selected gang is closer",e):(n=d+l,s=r,this.debugAttack("Found better Gang "+s.lvl+" at ("+a+","+o+") with dist ("+d+" + "+l+") = "+n,e))}}return s},doAttack:function(){this.trace();var e=6e4,t=new Date;return this.options.map?this.cities&&this.options.attackOrders?(this.eachCity(function(i){if(i.energy<=1)return void this.debugAttack("No more energy",i);if("DoriaAirport"==i.type)return void this.debugAttack(i.type+" can't attack",i);for(var s={gang:0},n=0;n<this.options.attackOrders.length;n++){var a=this.options.attackOrders[n];if(this.debugAttack("Order: "+a.gang+" City: "+a.city+" Units: "+a.units,i),a.city&&"all"!=a.city&&a.city!=i.type)this.debugAttack("Wrong city ("+a.city+" != "+i.type+")",i);else{var o=!0,r=JSON.parse(a.units);if(i.units){for(var d in r)if(!i.units[d]||i.units[d]<r[d]){this.debugAttack("Do not have "+d+" ("+r[d]+")",i),o=!1;break}}else o=!1,this.debugAttack("Missing units in city",i);if(o){var l=parseInt(s.gang,10),c=parseInt(a.gang,10);c>l&&(s=a)}}}if(s.units){var u=this.findBestGang(i,s.gang);if(0===u.lvl)return void this.debugAttack("Failed to find a gang to attack",i);this.debugAttack("Attack "+u.lvl+" Gang at ("+u.x+","+u.y+")",i),u.lvl<=10&&(u.attacked=t.getTime()+18e5);var h=s.units;s.use_all&&(h=this.getAttackUnits(i)),this.attack(u.x,u.y,h,i),e=6e5,this.saveOptions()}}),e):(this.debugAttack("City or orders not ready"),1e4):(this.updateMap(),1e4)},getAttackUnits:function(e){if(this.trace(),e&&e.units){var t=this.clone(e.units);for(var i in this.defenseUnits)t[i]&&delete t[i];var s=0;for(var n in t)s>=e.maximum_troops?delete t[n]:(t[n]>e.maximum_troops-s&&(t[n]=e.maximum_troops-s),this.debugAttack("Add attack units "+n+" => "+t[n]+" ("+s+"/"+e.maximum_troops+")",e),s+=t[n]);return JSON.stringify(t)}return""},attack:function(e,t,i,s){this.trace(),this.sendCommand("Attack ("+e+","+t+") from "+s.type,"cities/"+s.id+"/marches.json","_method=post&march[x]="+e+"&march[y]="+t+"&march[units]="+i,s),this.addStat("Attack",1)}},bailoutBot={doBailout:function(){this.trace(),this.eachCity(function(e){"DoriaAirport"!=e.type&&this.sendGetCommand("Update bail in "+e.name,"cities/"+e.id+"/cash_jail.json","",e)})},payBailout:function(e){if(this.trace(),!e||!e.bailout)return void this.debugBailout("No city or bailout",e);var t=0;e.resources?t=parseInt(e.resources.cash,10):this.debugBailout("No resources",e);var i="",s="",n=0;for(var a in e.bailout)if(this.attackUnits[a]&&this.attackUnits[a].bailout){var o=this.attackUnits[a].bailout,r=parseInt(e.bailout[a],10),d=o*r;this.debugBailout(a+" costs "+d+" and all units costs "+n+" and I have "+t,e);var l=parseInt((t-n)/o,10);if(l>0){l=l>r?r:l-1;var c=l*o;this.debugBailout("I can affort "+l+" "+a+" because it cost "+c+" and I have "+(t-n)+" ("+t+")",e),n+=c,i+="&units["+a+"]="+l,s+=l+" "+a+", "}else this.debugBailout("Can't affort "+a+" because it cost "+o+" and I have "+(t-n)+" ("+t+")",e)}else this.debug("Missing bailout for "+a,e);e.bailout={},""!==i?(this.debugBailout(s,e),this.sendCommand("Pay Bailout in "+e.type,"cities/"+e.id+"/cash_jail/bail.json","payment_method=cash"+i,e)):this.debugBailout("No bailout data to send",e)}},bondsBot={doBonds:function(){if(this.debugBonds("Get Bonds"),this.cities){var e=this.cities[0];this.sendGetCommand("Get Bonds","bonds.json","action=index",e)}},handleBonds:function(){if(this.debugBonds("Handle bonds"),this.cities){var e=this.cities[0];this.sendCommand("Collect Bonds","bonds/redeem.json","action=index",e)}}},bot={autoFunctions:{Collect:{},Build:{},Research:{},Attack:{},Bailout:{},Train:{},Defense:{},Prize:{},LoyaltyToken:{},Cityscape:{},Exchange:{},Items:{event:"player:items"},Report:{},Bonds:{},Quests:{},Armor:{event:"city:armor:update"},Financier:{}},generateChangeEnable:function(e){this["changeEnable"+e]=function(){this.options["enable"+e]=$("#enable_"+e).is(":checked"),this.saveOptions(),this.debug("Enable "+e+": "+this.options["enable"+e])}},generateAutoThread:function(e,t){if(void 0===this.options["enable"+e]&&(this.options["enable"+e]=!0,this.saveOptions()),t.event){if(void 0===this["do"+e+"Event"])return void this.debug("Missing function: do"+e+"Event");this.listen(t.event,function(t,i){this.cities&&this.options["enable"+e]&&this["do"+e+"Event"](i,t)})}else{if(void 0===this["do"+e])return void this.debug("Missing function: do"+e);this["auto"+e+"Thread"]=function(t){t.trace_r("auto"+e+"Thread");var i=6e4;if(t.cities&&t.options["enable"+e])if(t.enablePause)t.debug("Do not "+e+" because we are on pause"),i=1e4;else{var s=t["do"+e]();s&&(i=s)}setTimeout(t["auto"+e+"Thread"],i,t)},this["auto"+e+"Thread"](this)}},getCity:function(e){if(!this.cities)return void 0;for(var t=0;t<this.cities.length;t++)if(this.cities[t].id==e)return this.cities[t];return void 0},addStat:function(e,t){this.options.stats||(this.options.stats={}),this.options.stats[e]||(this.options.stats[e]=0),this.options.stats[e]+=t,this.saveOptions(),this.signal("stats:update")},checkCityQueue:function(e,t,i){if(this.trace(),!e||!e.jobs)return!1;for(var s=!0,n=0;n<e.jobs.length;n++)if(void 0===i){if(e.jobs[n].queue&&e.jobs[n].queue===t){s=!1;break}}else if(e.jobs[n].city_building_id&&e.jobs[n].city_building_id===i){s=!1;break}if(s){var a=new Date,o=a.getTime(),r={run_at:o};void 0===i?r.queue=t:r.city_building_id=i,e.jobs.push(r)}return s},loadCityData:function(e){if(this.trace(),e&&e.id){var t="unknown";e.type&&(t=e.type),this.sendDataGetCommand("Load city "+t,"cities/"+e.id+".json","",e),this.sendDataGetCommand("Load city "+t+" neighborhood","cities/"+e.id+"/neighborhood_buildings.json","",e);var i=new Date;e.lastUpdate=i.getTime()}},loadCitiesData:function(){this.trace(),this.eachCity(function(e){this.loadCityData(e)})},autoLoadCities:function(e){return e.trace(),e.enablePause?void e.debug("Do not load cities, because we are on pause"):void e.eachCity(function(t){var i=new Date;(!t.lastUpdate||t.lastUpdate<i.getTime()+300)&&e.loadCityData(t)})},loadGameLoadedData:function(e){e.trace(),e.sendDataCommand("Load Game Data","player/game_loaded.json","_method=put",e.cities[0]),e.loadCitiesData()},loadPlayerData:function(){this.trace(),this.sendDataGetCommand("Load Player","player.json")},loadPlayerDataInit:function(){this.trace(),this.sendDataGetCommand("Load Player Init","player.json","",void 0,this.loadGameLoadedData)},handleQueueComplete:function(e){this.trace(),"building"==e&&this.options.enableBuild?this.loadCitiesData():"research"==e&&this.options.enableResearch?this.doResearch():"units"==e&&this.options.enableTrain?this.doTrain():"defense_units"==e&&this.options.enableDefense?this.doDefense():-1!=e.indexOf("collect")&&this.options.enableCollect&&this.doCollect()},updateJobs:function(e){var t=1e3;if(e.cities)for(var i=new Date,s=i.getTime()/1e3,n=0;n<e.cities.length;n++){var a=e.cities[n];if(a&&a.jobs)for(var o=0;o<a.jobs.length;o++){var r=a.jobs[o],d=r.run_at+e.time_diff;if(s>=d){e.loadCityData(a),a.jobs.splice(o,1),t=1e4,e.handleQueueComplete(r.queue);break}}}setTimeout(e.updateJobs,t,e)},init:function(e){this.loadOptions(),this.queue=[],this.data_queue=[],this.slow_queue=[],this.queue_type="data",this.html={},this.enableTrace=!1,this.enablePause=!1,this.debug(e),this.server=e.apiServer.replace("http","https")+"/",this.player=e.playerId,this.session=e.sessionId,this.user=e.userId,this.gangster=e.gangster;for(var t in this.autoFunctions)this.generateAutoThread(t,this.autoFunctions[t]),this.generateChangeEnable(t),this.generateDebugEnable(t),this.generateDebugFunction(t);this.loadPlayerDataInit(),this.initGUI&&this.initGUI(),void 0===this.options.queue_interval&&(this.options.queue_interval=800,this.saveOptions()),setInterval(this.sendQueue,this.options.queue_interval,this),setInterval(this.autoLoadCities,6e4,this),this.updateJobs(this),this.showMissingPrizeInfo()},start:function(e){e||(e=this),"undefined"!=typeof C?e.init(C.attrs):window.setTimeout(e.start,1e3,e)}},buildBot={findBuildingLevel:function(e,t){this.trace();var i=0;return this.eachNeighborhood(function(t,s){if(s.buildings)for(var n=s.buildings,a=0;a<n.length;a++)n[a].type==e&&i<n[a].level&&(i=n[a].level)},t),i},countBuilding:function(e,t){this.trace();var i=0;if(e&&e.buildings)for(var s=e.buildings,n=0;n<s.length;n++)"neighborhood"==s[n].location&&(void 0!==t||s[n].hasOwnProperty("unlocked")||"Exchange"==s[n].type?s[n].type==t&&i++:i++);return i},findBuildingSlot:function(e,t){this.trace();var i=e.id;this.options.reserved_slots||(this.options.reserved_slots={}),this.options.reserved_slots[i]||(this.options.reserved_slots[i]={});var s=[],n=0;for(n=0;t>n;n++)"reserved"===this.options.reserved_slots[i][n]?s[n]=!1:s[n]=!0;if(e&&e.buildings)for(var a=e.buildings,o=0;o<a.length;o++)a[o].hasOwnProperty("slot")&&"neighborhood"==a[o].location&&(s[a[o].slot]=!1);for(n=0;n<s.length;n++)if(s[n])return n;return 0},calcBuldingCost:function(e,t){return 1==e?t:t*Math.pow(2,e)},hasResources:function(e,t,i,s,n,a){if(i&&e&&e.resources){var o=e.resources;for(var r in i){var d=0;if(d=a?a[r]?i[r]+a[r]*(s-1):i[r]+a.res*(s-1):n?n(parseInt(s,10),i[r]):i[r]*s,d>parseInt(o[r],10))return void 0===n?this.debugTrain("Can't train "+t+" because "+r+" ("+d+") is more then "+o[r],e):n==this.calcBuldingCost?this.debugBuild("Can't build "+t+" because "+r+" ("+d+") is more then "+o[r],e):this.debugResearch("Can't research "+t+" because "+r+" ("+d+") is more then "+o[r],e),!1;void 0===n?this.debugTrain("I have "+o[r]+" "+r+" and "+t+" costs "+d,e):n==this.calcBuldingCost?this.debugBuild("I have "+o[r]+" "+r+" and "+t+" costs "+d,e):this.debugResearch("I have "+o[r]+" "+r+" and "+t+" costs "+d,e)}}else i?void 0===n?this.debugTrain("Missing city data"):n==this.calcBuldingCost?this.debugBuild("Missing city data"):this.debugResearch("Missing city data"):void 0===n?this.debugTrain("Missing cost for "+t):n==this.calcBuldingCost?this.debugBuild("Missing cost for "+t):this.debugResearch("Missing cost for "+t);return!0},buildNewBuilding:function(e){if(this.trace(),e&&e.buildings&&e.city){var t=e.city;if("DoriaAirport"==t.type)return this.debugBuild("Do not build new building in Doria Airport",t,e),!1;var i=this.findBuildingLevel("Mansion",e.city),s=e.max_slot_number,n=this.countBuilding(e);if(this.debugBuild("Man Level: "+i+" Total building: "+n+" => "+s,t,e),s>n){var a=this.findBuildingSlot(e,s);if(0===a)return this.debugBuild("Failed to find a valid slot",t,e),!1;var o,r="Hideout";if(this.options.build||(this.options.build={}),this.options.build[t.type])for(o in this.options.build[t.type])if(-1==this.options.build[t.type][o]){
this.debugBuild("Set default building to "+o,t,e),r=o;break}var d=this.buildings[r].cost;if(!this.hasResources(t,r,d,1,this.calcBuldingCost))return this.debugBuild("Can't build new "+r+", can't afford it",t,e),!1;for(o in this.buildings){var l=this.buildings[o],c=0;if(this.options.build[t.type]&&this.options.build[t.type][o]?c=this.options.build[t.type][o]:l.buildNew&&(c=l.buildNew),c>0){var u=this.countBuilding(e,o);if(c>u){if(d=l.cost,!this.hasResources(t,o,d,1,this.calcBuldingCost))continue;r=o;break}}}this.info("Build new "+r+" at slot "+a,t,"build",e);var h="_method=post&city_building[building_type]="+r;return h+="&city_building[include_requirements]=false&city_building[instant_build]=false",h+="&city_building[neighborhood_id]="+e.id+"&city_building[slot]="+a,this.sendCommand("Build new "+r+" at slot "+a+" in "+t.type+" ("+e.id+")","cities/"+t.id+"/buildings.json",h,t,void 0,e,{slot:a}),this.addStat("Build",1),e.buildings.push({slot:a,location:"neighborhood",type:r}),!0}this.debugBuild("No more slots for new buildings ("+s+")",t,e)}else this.debugBuild("Can't find neighborhood or buildings",t,e);return!1},upgradeImportentBuilding:function(e,t){this.trace();for(var i=["Hideout","Apartment"],s=0;s<i.length;s++){var n=i[s],a=this.findBuildingLevel(n,e.city);if(9>a&&e&&e.buildings)for(var o=e.buildings,r=0;r<o.length;r++){var d=o[r];if(d.type==n&&d.level==a)return t.lvl=d.level,t.id=d.id,t.name=d.type,t.location=d.location,this.debugBuild("Build Importent "+t.name,e.city),t}}return this.debugBuild("Failed to find impotent building",e.city),t},upgradeLowestBuilding:function(e){if(this.trace(),this.buildNewBuilding(e))return!0;if(!e||!e.buildings)return!1;for(var t={lvl:1e3},i=e.buildings,s=e.city,n=0;n<i.length;n++){var a=i[n];if(!(a.hasOwnProperty("unlocked")||a.level>=9)){var o=!0,r=this.buildings[a.type];if(r||(this.debug("Missing data for "+a.type,s,"Build",e),r={}),r.skip)this.debugBuild("Skipping "+a.type,s,e);else{if(r.requirement){var d=r.requirement;if(d.build){var l=d.build[a.level];if(l)for(var c in l){var u=this.findBuildingLevel(c,e.city);if(u<l[c]){this.debugBuild("Can't build "+a.type+" because "+c+" is not "+l[c],s,e),o=!1;break}this.debugBuild(a.type+" has req "+c+" ("+l[c]+") and it is "+u,s,e)}}if(d.gangster){if(d.gangster>this.player_level){this.debugBuild("Can't build "+a.type+" because gangster is not "+d.gangster,s,e),o=!1;break}this.debugBuild(a.type+" has gangster "+d.gangster+" and we are "+this.player_level,s,e)}if(d.alliance&&!this.alliance){this.debugBuild(a.type+" has alliance as a requirement and we are not part of a Crew: "+this.alliance,s,e),o=!1;break}}else this.debugBuild(a.type+" has no requirements",s,e);o&&r.cost?this.hasResources(s,a.type,r.cost,a.level,this.calcBuldingCost,r.offset)?this.debugBuild("Lots of resources",s,e):o=!1:o&&this.debugBuild("Not cost info for "+a.type,s,e),o&&(t.lvl>a.level||a.level>3&&t.lvl==a.level&&"neighborhood"==t.location)&&(t.lvl=a.level,t.id=a.id,t.name=a.type,t.location=a.location,t.building=a)}}}if(1e3!=t.lvl){if(t.lvl>5){var h=this.upgradeImportentBuilding(e,t);if(!h)return this.debugBuild("Faild to find a building",s,e),!1;this.buildings[h.name]?this.hasResources(s,h.name,this.buildings[h.name].cost,h.lvl,this.calcBuldingCost)?t=h:this.debugBuild("Do not upgrade importent building, not egnogh rescources",s,e):this.debug("Missing info for: "+h.name,s,e)}return this.info("Build "+t.name+" "+(t.lvl+1),s,"build",e),this.sendCommand("Build "+t.name+" "+(t.lvl+1)+" in "+s.type,"cities/"+s.id+"/buildings/"+t.id+".json","_method=put",s,void 0,e),t.building.level++,!0}return!1},doBuild:function(){if(this.trace(),this.cities)for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if("DoriaAirport"!=t.type){var i=this.checkCityQueue(t,"building");if(i)if(t.neighborhood)for(var s=0;s<t.neighborhood.length&&!this.upgradeLowestBuilding(t.neighborhood[s]);s++);else this.debugBuild("Neighborhood not ready",t);else this.debugBuild("Build queue not ready",t)}else this.debugBuild("Build is disabled for Doria Airport",t)}else this.debugBuild("Cities not ready")}},cityscapeBot={doCityscape:function(){if(this.trace(),!this.cities)return this.debugCityscape("Cities not ready"),5e3;for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if(t&&t.wildernesses)for(var i=0;i<t.wildernesses.length;i++){var s=t.wildernesses[i];if(s)if("CityScape"==s.type){var n=new Date,a=n.getTime()/1e3,o=a-s.last_collected_at,r=21600;o>=r?(this.debugCityscape("Collect cityscapes",t),this.sendCommand("Collect Cityscape in "+t.type,"cities/"+t.id+"/wildernesses/collect_all.json","",t),this.addStat("CityScape",1)):this.debugCityscape("Diff is "+o+" < "+r)}else this.debugCityscape("Wild is "+s.type,t);else this.debugCityscape("Wild "+i+" is empty",t)}else this.debugCityscape("Wilderness is not ready",t)}return 36e5}},collectBot={doCollect:function(){if(this.trace(),!this.cities)return this.debugCollect("Cities is not ready"),5e3;for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if(t&&t.neighborhood)for(var i=0;i<t.neighborhood.length;i++){var s=t.neighborhood[i];if(s&&s.buildings)for(var n=s.buildings,a=0;a<n.length;a++){var o=n[a];if(o.hasOwnProperty("unlocked")&&o.unlocked){var r=this.checkCityQueue(s.city,void 0,o.id);if(r){this.debugCollect("Collect "+o.type,t);var d="cities/"+s.city.id+"/npc_buildings/"+o.id+".json",l="_method=put&city_building_id="+o.id;this.sendCommand("Collect "+o.type+" in "+t.type,d,l,s.city),this.addStat("Collect",1)}}else this.debugCollect(o.type+" is not unlocked",t)}else this.debugCollect("Building not ready",t)}else this.debugCollect("Neighborhood not ready",t)}return 6e4},doExchange:function(){if(this.trace(),!(this.cities&&this.cities[0]&&this.cities[0].neighborhood&&this.cities[0].neighborhood.length))return this.debugCollect("Neighborhood not ready"),0;var e=this.cities[0];if(e&&e.neighborhood&&e.neighborhood.length)for(var t=0;t<this.cities[0].neighborhood.length;t++){var i=this.cities[0].neighborhood[t];if(i&&i.buildings){for(var s=0;s<i.buildings.length;s++)if("Exchange"==i.buildings[s].type){if(!i.buildings[s].free_ticket){this.debugExchange("No free ticket",e);break}var n="cities/"+e.city_id+"/exchanges/"+i.buildings[s].id+"/collect.json",a="_method=put&_action=collect&city_building_id="+i.buildings[s].id;return this.sendCommand("Collect Exchange",n,a,this.cities[0]),i.buildings[s].free_ticket=!1,this.info("Collect Exchange",e,"collect",i),this.addStat("Exchange",1),36e5}}else this.debugCollect("Building not ready",e)}return 0},doLoyaltyToken:function(){return this.trace(),this.cities&&this.cities[0]&&(this.debugLoyaltyToken("Checking token"),this.sendGetCommand("Update tokes","loyalty_tokens.json","",this.cities[0],this.checkLoyalyToken)),36e5},checkLoyalyToken:function(e){if(e.trace(),!e.tokens)return void e.debugLoyaltyToken("No tokens");for(var t=0;t<e.tokens.length;t++)e.tokens[t].collectable&&(e.debugLoyaltyToken("Collect token: "+e.tokens[t].type+" ("+t+")"),e.sendCommand("Collect token","loyalty_tokens/collect.json","type="+e.tokens[t].type,e.cities[0]),e.addStat("Token",1))},doQuests:function(){if(this.trace(),!this.quests)return void this.debugQuests("No Quests yet");if(!this.quests.Completed)return void this.debugQuests("No Completed Quests");var e=this.quests.Completed[0].name;this.debugQuests("Collect quest: "+e),this.sendCommand("Collect Quest","player_quests/claim.json","quest_name="+e+"&_method=put",this.cities[0])}},debugBot={trace:function(){this.trace_r(arguments.callee.caller.name)},trace_r:function(e){this.enableTrace&&this.debug(e)},setDebugCity:function(e){this.debugCity=e},log_format:function(e,t,i,s){if(t&&this.debugCity&&"All"!=this.debugCity&&this.debugCity!=t.type)return"";if("object"==typeof e)return e;var n=new Date;return t&&t.type&&(e=s&&s.id?t.type+" ("+s.id+"): "+e:t.type+": "+e),i&&(e=i+": "+e),e=n.toLocaleTimeString()+": "+e},log:function(e,t,i,s,n){var a=this.log_format(t,i,s,n);""!==a&&e(a)},debug:function(e,t,i,s){this.log(console.debug,e,t,i,s)},info:function e(t,i,e,s){this.log(console.info,t,i,e,s),this.updateInfo&&this.updateInfo(t,i)},generateDebugFunction:function(e){this["enableDebug"+e]=!1,this["debug"+e]=function(t,i,s){this["enableDebug"+e]&&this.debug(t,i,e,s)}},generateDebugEnable:function(e){this["changeDebugEnable"+e]=function(){this["enableDebug"+e]=$("#enable_debug_"+e).is(":checked"),this.debug("Enable Debug "+e+": "+this["enableDebug"+e])}},toggleTrace:function(){this.enableTrace=!this.enableTrace},togglePause:function(){this.enablePause=!this.enablePause},executeCMD:function executeCMD(){var cmd=window.prompt("Enter CMD","");try{var res=eval(cmd);res&&this.debug(res)}catch(e){alert(e)}}},financierBot={doFinancier:function(){if(this.debugFinancier("Get Financier Office"),this.cities){for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if("Queens"===t.type)return this.sendGetCommand("Get Financier Office","financiers_office/show.json","",t),6e5}this.debugFinancier("Failed to find Queens")}},handleFinancier:function(){if(this.financier_trades>0&&this.options.financier_order){for(var e=0;e<this.options.financier_order.length;e++){var t=this.options.financier_order[e];if(this.my_items[t])return this.debugFinancier("Selling "+t+" because there is "+this.my_items[t]),void this.sellFinancierItem(t)}this.debugFinancier("Failed to find an item to sell")}else this.debugFinancier("Missing Financier trades or Financier orders")},sellFinancierItem:function(e){if(this.debugFinancier("Handle Financier Office"),this.cities){for(var t=0;t<this.cities.length;t++){var i=this.cities[t];if("Queens"===i.type)return this.debugFinancier("Sell Financier Item: "+e,i),this.financier_trades-=1,this.my_items[e]-=1,this.addStat("Financier",1),void this.sendCommand("Sell Financier Item: "+e,"financiers_office/exchange.json","item="+e,i)}this.debugFinancier("Failed to find Queens")}}},itemBot={doItems:function(){this.doItemsEvent()},doItemsEvent:function(){if(!this.my_items)return void this.debugItems("Items is not ready");if(!this.cities)return void this.debugItems("Cities is not ready");var e=this.cities[0];for(var t in this.items)this.items[t].autoCollect&&this.my_items[t]?(this.debugItems(t+": "+this.my_items[t]),this.my_items[t]--,this.sendCommand("Use "+t,"player_items/"+t+".json","_method=delete",e),this.addStat("Item",1)):this.debugItems("Can't find "+t+" in items",e)}},optionsBot={saveOptions:function(){localStorage.setItem("gfb_options",JSON.stringify(this.options))},loadOptions:function(){var e=localStorage.getItem("gfb_options");if(e?this.options=JSON.parse(e):this.options={},!this.options.attackOrders){var t={};t.gang=10,t.units="",t.city="all",t.use_all=!0}}},parserBot={parseData:function(e){this.trace();var t,i,s;if(e){if(e="string"==typeof e?JSON.parse(e):this.clone(e),e.timestamp){var n=new Date,a=n.getTime()/1e3;this.time_diff=a-e.timestamp}if(e.cities&&e.cities[0]&&e.cities[0].id&&(this.cities||(this.cities=e.cities,this.signal("cities:update"))),e.player_armory_items&&(this.player_armory_items=e.player_armory_items,this.signal("player:armor:update")),e.alliance&&(this.alliance=e.alliance),e.neighborhoods)for(s in e.neighborhoods){var o=e.neighborhoods[s];if(o&&o.buildings&&o.buildings.length){var r=o.buildings;if(r[0]&&r[0].city_id&&(i=this.getCity(e.neighborhoods.neighborhood.buildings[0].city_id))){i.neighborhood||(i.neighborhood=[]);var d=!0;for(t=0;t<i.neighborhood.length;t++)if(i.neighborhood[t].id==o.id){d=!1;break}d&&(o.city=i,i.neighborhood.push(o))}}}if(e.city&&(i=this.getCity(e.city.id))){if(i.type||(i.type=e.city.type),i.jobs&&e.city.jobs)for(t=0;t<i.jobs.length;t++){var l=!1;for(s=0;s<e.city.jobs.length;s++)if(i.jobs[t].queue==e.city.jobs[s].queue){l=!0;break}!l&&i.jobs[t].queue&&i.jobs[t].id&&this.handleQueueComplete(i.jobs[t].queue)}e.city.units&&(i.units=e.city.units,this.signal("units:update")),e.city.research&&(i.research=e.city.research,this.signal("research:update")),e.city.resources&&(i.resources=e.city.resources,this.signal("resources:update")),e.city.figures&&e.city.figures.marches&&(i.maximum_troops=e.city.figures.marches.maximum_troops),e.city.wildernesses&&(i.wildernesses=e.city.wildernesses),e.city.jobs&&(i.jobs=e.city.jobs,this.signal("jobs:update")),e.city.equipped_armory_items&&(i.armor=e.city.equipped_armory_items,this.signal("city:armor:update",i))}if(e.terrain){this.options.map||(this.options.map={});var c=e.terrain;for(var u in c){var h=c[u];for(var p in h){var b=h[p];("Gang"==b[0]||"BossGang"==b[0])&&(this.options.map[b[2]]||(this.options.map[b[2]]={}),this.options.map[b[2]][b[3]]||(this.options.map[b[2]][b[3]]={}),this.options.map[b[2]][b[3]].lvl="Gang"==b[0]?b[1]:parseInt(b[1],10)+10,this.options.map[b[2]][b[3]].x=b[2],this.options.map[b[2]][b[3]].y=b[3])}}this.signal("map:update")}if(e.has_free_ticket&&(this.free_ticket=e.has_free_ticket),e.items&&(this.my_items=e.items,this.signal("player:items")),e.quests&&(this.quests=e.quests,this.signal("player:quests")),e.level&&(this.player_level=e.level,this.signal("player:level")),e.result){var g=e.result;if(e.result.prize_list)this.prizeList=g.prize_list,this.minigame_timestamp=g.minigame_timestamp;else if(e.result.item_won)for(var f in e.result.item_won)this.cities?this.updatePrizeInfo("Won: "+f,this.cities[0]):this.updatePrizeInfo("Won: "+f);if(e.result.prize)if(i=this.getCity(e.result.city_id),e.result.prize.prize_type)this.updatePrizeInfo("Won: "+e.result.prize.prize_type,i);else for(var m in e.result.prize)"cash_multiplier"!=m&&this.updatePrizeInfo("Won: "+m+" "+e.result.prize[m],i);if(e.result.job&&(i=this.getCity(e.result.job.city_id),i&&(i.jobs||(i.jobs=[]),i.jobs.push(e.result.job),this.signal("jobs:update"))),this.lastCommand&&this.lastCommand.city&&e.result.units&&(this.lastCommand.city.bailout=e.result.units,this.payBailout(this.lastCommand.city)),e.result.tokens&&(this.tokens=e.result.tokens),e.result.report_notifications&&(this.debugReport("Update reports"),this.reports={},this.reports.total=parseInt(e.result.total,10),this.reports.reports=e.result.report_notifications,this.signal("report:update")),e.result.bonds_list)for(t=0;t<e.result.bonds_list.length;t++){var v=e.result.bonds_list[t];"BearerBond"==v.name&&100==v.quantity&&this.handleBonds()}e.result.financiers_office&&(e.result.financiers_office.remaining_trades&&(this.financier_trades=e.result.financiers_office.remaining_trades),this.handleFinancier())}e.energy&&this.lastCommand&&this.lastCommand.city&&(this.lastCommand.city.energy=e.energy)}}},prizeBot={getPrize:function(){this.trace(),this.cities&&this.cities[0]&&this.minigame_timestamp&&(this.debugPrize("Get Prize"),this.sendCommand("Get Prize","minigames/save_result.json","minigame_timestamp="+this.minigame_timestamp,this.cities[0]),this.addStat("Prize",1))},doPrize:function(){if(this.trace(),this.cities&&this.cities[0]){if(!(this.free_ticket||this.items&&this.items.DailyChance&&this.items.DailyChance>0))return this.debugPrize("No prize ticket - Update player data"),this.loadPlayerData(),3e5;this.debugPrize("Update Prize"),this.sendGetCommand("Update Prize","minigames/index.json","",this.cities[0],this.updatePrizeList)}else this.debugPrize("Cities not ready");return 0},updatePrizeList:function(e){e.trace();var t={cost:1e3,name:""};if(e.prizeList&&e.prizeList.length){for(var i=0;i<e.prizeList.length;i++)if(e.items[e.prizeList[i].type]){var s=e.items[e.prizeList[i].type];t.cost>s.cost&&(t.cost=s.cost,t.name=e.prizeList[i].type)}else e.updatePrizeInfo(e.prizeList[i].type+" is unknown"),e.addMissingPrizeInfo(e.prizeList[i].type);t.cost>=10&&(e.getPrize(),e.free_ticket?e.free_ticket=!1:e.items&&e.items.DailyChance&&e.items.DailyChance>0&&e.items.DailyChance--,e.loadPlayerData())}},addMissingPrizeInfo:function(e){this.options.missing_prize||(this.options.missing_prize=[]),this.options.missing_prize.push(e),this.saveOptions()},showMissingPrizeInfo:function(){if(this.trace(),this.options.missing_prize){for(var e=0;e<this.options.missing_prize.length;e++){var t=this.options.missing_prize[e];this.items[t]?this.options.missing_prize.splice(e,1):this.debug("Missing prize info: "+t)}this.saveOptions()}}},queueBot={Command:function(){},enqueCommand:function(e,t,i,s,n,a,o,r,d){this.trace(),void 0!==n&&(i=""!==i?"city_id="+n.id+"&"+i:"city_id="+n.id);var l=new this.Command;l.name=e,l.type=s,l.url=this.server+t,l.city=n,l.neighborhood=r,l.data="_session_id="+this.session+"&gangster="+this.gangster+"&user_id="+this.user+"&"+i,l.callback=a,l.custom=d,"slow"===o?this.addToQueue(this.slow_queue,l):"data"===o?this.addToQueue(this.data_queue,l):(this.enableHTTP&&(l.url=l.url.replace("https","http")),this.addToQueue(this.queue,l))},addToQueue:function(e,t){for(var i=0;i<e.length;i++)if(e[i].url==t.url&&e[i].data==t.data&&-1==t.name.indexOf("Collect "))return void this.debug("Dropping double command: "+t.name,t.city);e.push(t),this.signal("queue:update")},sendCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"POST",s,n,"cmd",a,o)},sendGetCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"GET",s,n,"cmd",a,o)},sendSlowCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"POST",s,n,"slow",a,o)},sendSlowGetCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"GET",s,n,"slow",a,o)},sendDataCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"POST",s,n,"data",a,o)},sendDataGetCommand:function(e,t,i,s,n,a,o){this.enqueCommand(e,t,i,"GET",s,n,"data",a,o)},sendQueue:function(e){return e.queue_busy?void 0:e.lastCommand?(e.debug("Resending last command: "+e.lastCommand.name,e.lastCommand.city),e.debug(e.lastCommand),void e.executeCommand(e.lastCommand)):void("data"===e.queue_type?e.data_queue.length?e.executeCommand(e.data_queue.shift()):e.queue.length?(e.executeCommand(e.queue.shift()),e.queue_type="cmd",e.signal("queue:change")):e.slow_queue.length&&e.executeCommand(e.slow_queue.shift()):e.queue.length?e.executeCommand(e.queue.shift()):e.data_queue.length?(e.executeCommand(e.data_queue.shift()),e.queue_type="data",e.signal("queue:change")):e.slow_queue.length&&e.executeCommand(e.slow_queue.shift()))},executeCommand:function(e){function t(e,t,i){e||200!=t.statusCode?s.errorCommand(t.statusCode,i):s.revCommand(i)}if(void 0!==e){if(e.resends>2)return this.debug("Last command has been send 3 times: "+this.lastCommand.name,this.lastCommand.city),void(this.lastCommand=void 0);if(this.debug(e.name),"undefined"!=typeof $)this.ajax_send(e.url,this.revCommand,this.errorCommand,e.type,e.data,!0);else{this.request||(this.request=require("request"));var i={method:e.type,url:e.url,body:e.data,headers:{Origin:"https://c1.godfather.rykaiju.com","User-Agent":"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140","Content-Type":"application/x-www-form-urlencoded",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","Cache-Control":"max-age=0",Referer:"https://c1.godfather.rykaiju.com/platforms/facebook/",Connection:"keep-alive","X-Requested-With":"ShockwaveFlash/28.0.0.126"}},s=this;this.request(i,t)}this.queue_busy=!0,e.resends=e.resends+1||1,this.lastCommand=e,this.signal("queue:update")}},errorCommand:function(e,t){this.queue_busy=!1;var i="";if(404!=e){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return this.debug("Recevied invalid JSON in error handler: "+this.lastCommand.name,this.lastCommand.city),void this.debug(e)}i=t.responseText?t.responseText:t}else i=t;this.debug("Error sending command: "+i),this.debug(this.lastCommand),this.lastCommand&&void 0!==this.lastCommand.callback&&this.lastCommand.callback(this)},revCommand:function(e){if(this.queue_busy=!1,"string"==typeof e)try{e=JSON.parse(e)}catch(e){return this.debug("Received invalid JSON for command: "+this.lastCommand.name),this.debug(e),void(this.lastCommand=void 0)}if(e&&e.result&&!e.result.success&&(this.debug("Command send Error: "+e.result.errors[0]),this.debug(this.lastCommand),"Slot is reserved"===e.result.errors[0]))if(this.debug("Slot is reserved"),this.lastCommand.neighborhood&&this.lastCommand.custom&&this.lastCommand.custom.slot){this.debug("Setting slot");var t=this.lastCommand.neighborhood.id,i=this.lastCommand.custom.slot;this.options.reserved_slots||(this.options.reserved_slots={}),this.options.reserved_slots[t]||(this.options.reserved_slots[t]={}),this.debug(this.options.reserved_slots),this.options.reserved_slots[t][i]="reserved",this.debug(this.options.reserved_slots),this.saveOptions()}else this.debug("Missing neighborhood or custom slot to handle error");this.parseData(e),this.lastCommand&&(void 0!==this.lastCommand.callback&&this.lastCommand.callback(this),this.lastCommand=void 0)}},reportBot={doReport:function(){this.debugReport("Do Reports"),this.sendGetCommand("Reports","reports.json","count=18&page=1&category=reports")},handleReport:function(){if(this.debugReport("Handle Reports"),this.reports&&this.reports.reports){for(var e="",t=0;t<this.reports.reports.length;t++){var i=this.reports.reports[t];"attacking"==i.battle_side&&"Won"==i.battle_result&&null===i.read_at&&(e+=i.id+"|")}this.debugReport("Ids: "+e),""!==e&&this.sendCommand("Delete reports","reports/bulk_delete.json","_method=delete&ids="+e)}}},researchBot={calcReseachCost:function(e,t){for(var i=t,s=1;e>s;s++)10>s?i=Math.ceil(1.5*i):15>s?i=Math.ceil(1.6*i):15==s?i=Math.ceil(2.7*i):20>s&&(i=Math.ceil(1.2*i));return i},researchLowest:function(e){this.trace();var t={lvl:1e3,pri:1e3,id:""};if(!e)return void this.debugResearch("No city");if(!e.research)return void this.debugResearch("Missing research",e);if(!e.neighborhood)return void this.debugResearch("Missing neighborhood",e);for(var i in this.research){var s=this.research[i],n=(e.research[i]||0)+1,a=!1,o=s.requirement;if(o){if(o.city&&o.city!==e.type){this.debugResearch("Skip "+i+" in "+e.name,e);continue}if(o.build){var r=this.findBuildingLevel(o.build,e);if(this.debugResearch(i+" ("+n+"/"+(n-4)+") has req "+o.build+" and it is "+r+" ("+4*r+")",e),"Garage"==o.build||"Workshop"==o.build||"GuardPost"==o.build?n>=20?r*=2:5>=n?r=5:r*=3:r*=2,0===r||n>1&&n>=r){this.debugResearch("skip because "+r+" is less then "+n,e);continue}}if(o.research){for(var d=0;d<o.research.length;d++){var l=o.research[d],c=e.research[l]||0;if(this.debugResearch(i+" has req "+l+" and it is "+c,e),n>=c){this.debugResearch("Skip because "+c+" is less then "+n,e),a=!0;break}}if(a)continue}}this.hasResources(e,i,s.cost,n,this.calcReseachCost)?(t.lvl>n||t.lvl==n&&t.pri>this.research[i].priority)&&(t.lvl=n,t.name=i,t.pri=this.research[i].priority):this.debugResearch("Skip because we can't affort it",e)}1e3!=t.lvl&&(this.info("Research "+t.name+" lvl "+t.lvl,e,"research"),this.sendCommand("Research "+t.name+" lvl "+t.lvl+" in "+e.type,"cities/"+e.id+"/researches.json","research[research_type]="+t.name,e),this.addStat("Research",1),e.research[t.name]=t.lvl)},doResearch:function(){if(this.trace(),!this.cities)return void this.debugResearch("Cities not ready");for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if("DoriaAirport"!=t.type){var i=this.checkCityQueue(t,"research");i?this.researchLowest(t):this.debugResearch("Already researching",t)}else this.debugResearch("Can't research in "+t.type,t)}}},trainBot={checkRequirements:function(e,t,i,s){if(this.trace(),t&&t.build)for(var n in t.build){var a=this.findBuildingLevel(n,i);if(this["debug"+s](e+" has build req "+n+" of "+t.build[n]+" and it is "+a,i),a<t.build[n])return this["debug"+s]("Skipping "+e,i),!1}if(t&&t.research)for(var o in t.research){var r=i.research[o];if(void 0===r&&(r=0),this["debug"+s](e+" has req "+o+" of "+t.research[o]+" and it is "+r,i),r<t.research[o])return this["debug"+s]("Skiping "+e,i),!1}return!0},doTrain:function(){if(this.trace(),!this.cities)return void this.debugTrain("Cities is not ready");if(!this.options.trainOrders)return void this.debugTrain("Train data is not ready");this.debugTrain(this.options.trainOrders);for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if(t&&"DoriaAirport"!=t.type)if(t.units)for(var i in this.attackUnits){var s=this.attackUnits[i];if(s.trainable)if(s.city&&"All"!=s.city&&s.city!=t.type)this.debugTrain(i+" can't be trained in "+t.type+" only in "+s.city);else{var n=this.options.trainOrders[i];if(n){t.units||this.debugTrain("city.units is missing",t);var a=s.requirement;if(this.checkRequirements(i,a,t,"Train")){var o=10,r=0,d=s.cost;if(t.units[i]&&(r=t.units[i]),r>=n)this.debugTrain("Do not train "+i+", there is "+r,t);else if(this.checkCityQueue(t,"units")){if(void 0===d||this.hasResources(t,i,d,o,void 0)){this.debugTrain("Train "+o+" "+i,t),this.sendTrainOrders(i,o,t),this.addStat("Train",o);break}}else this.debugTrain("Already training units",t)}}else this.debugTrain("Do not train "+n+" "+i,t)}else this.debugTrain(i+" is not trainable",t)}else this.debugTrain("Missing units in city",t)}},doDefense:function(){if(this.trace(),!this.cities)return void this.debugDefense("Cities not ready");for(var e=0;e<this.cities.length;e++){var t=this.cities[e];if("DoriaAirport"!=t.type)if(this.checkCityQueue(t,"defense_units")){var i=void 0,s=10;for(var n in this.defenseUnits){var a=this.defenseUnits[n];if(a.trainable)if(a.city&&"All"!=a.city&&a.city!=t.type)this.debugDefense(n+" can't be trained in "+t.type+" only in "+a.city);else{var o=this.defenseUnits[n].requirement;if(this.checkRequirements(n,o,t,"Defense")){var r=this.defenseUnits[n].cost;(!r||this.hasResources(t,n,r,s,void 0))&&(i=n,this.debugDefense("Can build "+n,t))}}else this.debugDefense(n+" is not trainable",t)}i?(this.sendTrainOrders(i,s,t),this.debugTrain("Train "+s+" "+n,t),this.addStat("Defense",s)):this.debugDefense("Failed to find a unit to train",t)}else this.debugDefense("Already training defense units",t)}},sendTrainOrders:function(e,t,i){this.sendCommand("Train "+t+" "+e+" in "+i.type,"cities/"+i.id+"/units.json","_method=post&units[include_requirements]=false&units[quantity]="+t+"&units[unit_type]="+e,i)}},utilBot={bind:function(e){var t=this;return function(){return e.apply(t,arguments)}},handlers:{},signal:function(e,t){if(this.handlers[e])for(var i=0;i<this.handlers[e].length;i++)void 0===t?this.handlers[e][i].call(this):this.handlers[e][i].call(this,t)},listen:function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},numberToString:function(e){return e=parseInt(e,10),e>=1e9?(e=Math.floor(e/1e8),e/=10,e+=" B"):e>=1e6?(e=Math.floor(e/1e5),e/=10,e+=" M"):e>=1e3&&(e=Math.floor(e/100),e/=10,e+=" K"),e},eachCity:function(e){if(this.cities)for(var t=0;t<this.cities.length;t++)this.cities[t]&&this.cities[t].id&&e.call(this,this.cities[t])},eachNeighborhood:function(e,t){var i=function(t){if(t.neighborhood&&t.neighborhood.length)for(var i=0;i<t.neighborhood.length;i++){var s=t.neighborhood[i];s&&e.call(this,t,s)}};void 0===t?this.eachCity(i):i(t)},clone:function(e){return JSON.parse(JSON.stringify(e))}},guiBot={initGUI:function(){var e=document.createElement("div");e.setAttribute("id","panel"),e.setAttribute("class","panel"),document.body.appendChild(e);var t=document.createElement("p");t.className="header",t.innerHTML="The Underboss",t.onclick=function(){$("#panel").hasClass("panel")?($("#panel").removeClass("panel").addClass("hiddenPanel"),$("#mainPanel").hide()):($("#panel").removeClass("hiddenPanel").addClass("panel"),$("#mainPanel").show())},e.appendChild(t);var i=document.createElement("div");i.setAttribute("id","mainPanel"),e.appendChild(i);for(var s in this.autoFunctions)this.drawOption(s,i);var n=document.createElement("div");i.appendChild(n);var a=document.createElement("div");a.className="tab-box",n.appendChild(a);for(var o=["Overview","Prizes","Armor","Training","Options"],r=0;r<o.length;r++)this.createDialog(o[r].toLowerCase()+"_view",o[r]),this["create"+o[r]+"View"]?this["create"+o[r]+"View"]():this.debug("create"+o[r]+"View function is missing!"),this["show"+o[r]]=this.generateShowView(o[r]);for(var d=["Info","Prizes","Attack","Map","Build","Financier","Debug"],l=0;l<d.length;l++){a.appendChild(this.drawTab("info-"+(l+1),d[l]));var c=this.drawTabData("info-"+(l+1));n.appendChild(c),this["draw"+d[l]+"Tab"]&&this["draw"+d[l]+"Tab"](c)}},generateShowView:function(e){return function(){$("#"+e.toLowerCase()+"_view").show()}},drawOption:function(e,t){var i=this.drawGenericOption(e,t,"enable_","changeEnable",this.options["enable"+e]),s=document.createElement("span");s.innerHTML=" - ",i.appendChild(s),this.drawButton(e+" Now",this["do"+e],i)},drawDebugOption:function(e,t){this.drawGenericOption(e,t,"enable_debug_","changeDebugEnable",!1)},drawGenericOption:function(e,t,i,s,n){var a=document.createElement("div");t.appendChild(a);var o=document.createElement("div");o.className="option",o.innerHTML=e+": ",a.appendChild(o);var r=this,d=document.createElement("input");return d.type="checkbox",d.name=i+e,d.id=i+e,d.checked=n,d.onclick=function(){r[s+e]()},a.appendChild(d),a},drawButton:function(e,t,i){var s=this,n=$("<button/>").html(e).click(function(){t.call(s)});$(i).append(n)},drawTab:function(e,t){var i=document.createElement("a");return i.href="javascript:;",i.className="tabLink",i.id=e,i.innerHTML=t,i.onclick=function(){var e=$(this).attr("id");return $(".tabLink").removeClass("activeLink"),$(this).addClass("activeLink"),$(".tabcontent").addClass("hide"),$("#"+e+"_data").removeClass("hide"),!1},i},drawTabData:function(e){var t=document.createElement("div");return t.id=e+"_data",t.className="tabcontent",1!=e&&(t.className+=" hide"),t},drawDebugTab:function(e){$(e).html("<h7>Debug Info</h7>").append($("<div/>").attr("id","debug_queue")),this.drawButton("Update Jobs",this.loadCitiesData,e),this.drawButton("Execute",this.executeCMD,e),this.drawButton("Trace",this.toggleTrace,e),this.drawButton("Pause",this.togglePause,e),$(e).append("<select id='debug_city' />");var t=this;$("#debug_city").change(function(){t.changeDebugCity()});for(var i in this.autoFunctions)this.drawDebugOption(i,e);this.listen("queue:update",this.updateDebugQueue),this.listen("queue:change",this.updateDebugQueue),this.listen("cities:update",this.updateDebugCities),this.listen("report:update",this.handleReport)},changeDebugCity:function(){this.debugCity=$("#debug_city").val()},updateDebugCities:function(){$("#debug_city").html("").append("<option value='All'>All</option>");for(var e=0;e<this.cities.length;e++){var t=this.cities[e];t&&t.type&&$("#debug_city").append("<option value='"+t.type+"'>"+t.type+"</option>")}},updateDebugQueue:function(){$("#debug_queue").html("<h7>CMD Queue: "+this.queue.length+"</h7><h7>Data Queue: "+this.data_queue.length+"</h7><h7>Slow Queue: "+this.slow_queue.length+"</h7><h7>Queue Type: "+this.queue_type+"</h7>")},drawBuildTab:function(e){this.options.build||(this.options.build={}),$(e).append("<h7>Build Orders</h7>"),$(e).append("<p>Build this amount of buildings. If you set it to -1 it will keep building that building.</p>"),$(e).append("<select id='build_order_city' />"),this.buildOrderCity="Capital";var t=this;$("#build_order_city").change(function(){t.changeBuildOrderCity()});var i=$("<table/>");$(e).append(i);for(var s in this.buildings)if(this.buildings[s].buildNew){var n=$("<input id='build_"+s+"' />");this.addTableRow(i,s,n)}this.drawButton("Save",this.saveBuildOrder,e),this.changeBuildOrder(),this.listen("cities:update",this.updateBuildOrderCities)},changeBuildOrder:function(){for(var e in this.buildings)if(this.buildings[e].buildNew){var t=$("#build_"+e);this.options.build[this.buildOrderCity]&&this.options.build[this.buildOrderCity][e]&&"number"==typeof this.options.build[this.buildOrderCity][e]?t.val(this.options.build[this.buildOrderCity][e]):t.val(this.buildings[e].buildNew)}},changeBuildOrderCity:function(){this.buildOrderCity=$("#build_order_city").val(),this.changeBuildOrder()},updateBuildOrderCities:function(){$("#build_order_city").html("");for(var e=0;e<this.cities.length;e++){var t=this.cities[e];t&&t.type&&$("#build_order_city").append("<option value='"+t.type+"'>"+t.type+"</option>")}},saveBuildOrder:function(){
this.options.build[this.buildOrderCity]={};for(var e in this.buildings)this.buildings[e].buildNew&&(this.options.build[this.buildOrderCity][e]=parseInt($("#build_"+e).val(),10));this.saveOptions()},drawMapTab:function(e){this.options.map_size||(this.options.map_size=2,this.updateMap()),e.innerHTML="<h7>Map</h7>",this.drawButton("Update Map",this.updateMap,e),this.drawButton("Reset Map",this.resetMap,e),$(e).append("<p id='scan-size'>Scan size: "+this.options.map_size+"</span>");var t;for(t=1;10>=t;t++)$(e).append("<p>Lvl "+t+" Gangs: <span id='gang_"+t+"'>0</span></p>");for(t=1;5>=t;t++)$(e).append("<p>Murder Inc. "+t+": <span id='gang_"+(10+t)+"'>0</span></p>");this.updateMapInfo(),this.listen("map:update",this.updateMapInfo)},updateMapInfo:function(){$("#scan_size").text("Scan size: "+this.options.map_size);var e,t,i={};for(t in this.options.map)for(var s in this.options.map[t]){var n=this.options.map[t][s];i[n.lvl]||(i[n.lvl]=0),i[n.lvl]++}for(e=1;15>=e;e++)i[e]&&$("#gang_"+e).text(i[e])},drawAttackTab:function(e){e.innerHTML="<h7>Attack Orders</h7>",$("<div>City:</div>").append($('<select id="select_attack_city"></select>')).appendTo($(e)),this.listen("cities:update",function(){var e=$("#select_attack_city");if(e.empty(),e.append($('<option value="all">All</option>')),this.cities)for(var t=0;t<this.cities.length;t++)e.append($('<option value="'+this.cities[t].type+'">'+this.cities[t].type+"</option>"))}),$("<div>Gang Level:</div>").append($('<select id="select_gang"></select>')).appendTo($(e));for(var t=$("#select_gang"),i=1;15>=i;i++)t.append($('<option value="'+i+'">'+i+"</option>"));$('<div id="units_p">Units:</div>').append($('<select id="select_units"></select>')).appendTo($(e));var s=$("#select_units");for(var n in this.attackUnits)s.append($('<option value="'+n+'">'+n+"</option>"));$('<input type="text" id="unit_count" value="0" class="unit_count" />').appendTo($("#units_p")),this.drawButton("Add",this.addUnitToAttackOrder,document.getElementById("units_p")),$("<div>Use All:</div>").append('<input type="checkbox" id="check_attack_all" value="all"/>').appendTo($(e)),$('<textarea id="total_units" class="textinfo"></textarea>').appendTo($(e)),this.drawButton("Save",this.saveAttackOrder,e),this.drawButton("Clear",this.clearAttackOrder,e);var a=document.createElement("hr");e.appendChild(a),$(e).append("<select id='order_list' size='10' width='100%' />"),this.drawButton("Delete",this.deleteAttackOrder,e),this.updateAttackOrders()},deleteAttackOrder:function(){var e=$("#order_list").val();this.options.attackOrders.splice(e,1),this.updateAttackOrders()},updateAttackOrders:function(){if($("#order_list").empty(),this.options.attackOrders)for(var e=0;e<this.options.attackOrders.length;e++){var t=this.options.attackOrders[e];t.city||(t.city="all"),t.use_all||(t.use_all=!1);var i=t.city+" | "+t.gang+" | "+(t.use_all?"t":"f")+" | "+t.units;$("#order_list").append("<option value='"+e+"'>"+i+"</option>")}},addUnitToAttackOrder:function(){var e=$("#total_units");""!==e.val()&&e.val(e.val()+","),e.val(e.val()+'"'+$("#select_units").val()+'":'+$("#unit_count").val())},saveAttackOrder:function(){var e={};e.gang=parseInt($("#select_gang").val(),10),e.units="{"+$("#total_units").val()+"}",e.city=$("#select_attack_city").val(),e.use_all=$("#check_attack_all").is(":checked"),this.options.attackOrders||(this.options.attackOrders=[]),this.options.attackOrders.push(e),this.saveOptions(),this.clearAttackOrder(),this.updateAttackOrders()},clearAttackOrder:function(){$("#total_units").val("")},updateStats:function(){var e=$("#stats").html("<h3><u>Stats</u></h3>");if(this.options.stats)for(var t in this.options.stats)e.append($("<p>"+t+": "+this.options.stats[t]+"</p>"))},drawFinancierTab:function(e){if($(e).append("<h7>Financiers Office</h7>").append("<p>Select items that should be sold</p>"),$(e).append("<select id='financier_all_items' />"),this.my_items)for(var t in this.my_items)this.my_items.hasOwnProperty(t)&&$("#financier_all_items").append("<option value='"+t+"'>"+t+"</option>");if(this.listen("player:items",this.updateFinancierItems),this.drawButton("Add item",this.addFinancierItem,e),this.drawButton("Remove item",this.removeFinancierItem,e),$(e).append("<br />"),$(e).append("<select id='financier_order' size='10' width='100%' />"),this.options.financier_order)for(var i=0;i<this.options.financier_order.length;i++){var s=this.options.financier_order[i];$("#financier_order").append("<option value='"+s+"'>"+s+"</option>")}$(e).append("<br />"),this.drawButton("Save Financiers Orders",this.saveFinancierOrder,e)},updateFinancierItems:function(){if($("#financier_all_items").empty(),this.my_items){var e=Object.keys(this.my_items).sort();for(var t in e)e.hasOwnProperty(t)&&$("#financier_all_items").append("<option value='"+e[t]+"'>"+e[t]+"</option>")}},addFinancierItem:function(){var e=$("#financier_all_items").val();$("#financier_order").append("<option value='"+e+"'>"+e+"</option>")},removeFinancierItem:function(){$("#financier_order :selected").remove()},saveFinancierOrder:function(){this.options.financier_order=$("select#financier_order option").map(function(){return $(this).val()}).get()},drawInfoTab:function(e){this.drawButton("Overview",this.showOverview,e),this.drawButton("Traning",this.showTraining,e),$(e).append($("<textarea></textarea>").addClass("info").attr("id","debug_info"))},drawPrizesTab:function(e){$(e).html("<h7>Prizes</h7>").append("<p>Prize Info:</p>").append($("<textarea/>").addClass("prize_info"))},updateInfo:function(e,t){var i=$("#debug_info").text().split("\n")||[];i=i.slice(0,100).join("\n"),$("#debug_info").text(this.log_format(e,t)+"\n"+i)},updatePrizeInfo:function(e,t){var i=$(".prize_info").text().split("\n")||[];i=i.slice(0,100).join("\n"),$(".prize_info").text(this.log_format(e,t)+"\n"+i)},createDialog:function(e,t){$("#panel").append("<dialog id='"+e+"' class='overlay'><h1>"+t+"</h1><button class='close' id='"+e+"_close'>Close</button></dialog>"),$("#"+e+"_close").click(function(){$("#"+e).hide()}),this["show"+e]=function(){$("#"+e).show()}},createArmorView:function(){},createPrizesView:function(){},addTableRow:function(e,t,i){var s=$("<td/>").append(t),n=$("<td/>").append(i);e.append($("<tr/>").append(s,n))},createOptionsView:function(){var e=$("#options_view");e.append("<h7>Options</h7>");var t=$("<table/>");e.append(t),this.addTableRow(t,"Reload Time",""),this.addTableRow(t,"Underboss Size",""),this.addTableRow(t,"Queue Send Interval",""),this.addTableRow(t,"Hide side panel",""),this.addTableRow(t,"",""),this.drawButton("Save",this.saveOptionsPage,e)},saveOptionsPage:function(){this.debug("Save Options")},createTrainingView:function(){var e=$("#training_view");e.append("<h7>Training Orders</h7>");var t=$("<table/>");e.append(t);var i,s=0;for(var n in this.attackUnits)this.attackUnits[n].trainable&&(s%3===0&&(i=$("<tr/>"),t.append(i)),i.append($("<td/>").text(n).append($("<td/>").append($("<input class='number'/>").attr("id","unit_"+n)))),this.options.trainOrders&&this.options.trainOrders[n]&&$("#unit_"+n).val(this.options.trainOrders[n]),s++);this.drawButton("Save",this.saveTrainOrder,$("#trainview"))},saveTrainOrder:function(){this.trace(),this.options.trainOrders||(this.options.trainOrders={});for(var e in this.attackUnits)this.options.trainOrders[e]=$("#unit_"+e).val();this.saveOptions()},createOverviewView:function(){var e=$("#overview_view");this.drawButton("Update",this.updateOverview,e),e.append("<table id='overview_table'></table>"),$("#overview_table").append("                                    <tr><td style>City</td>                                    <th>Cash</th><th>Cement</th><th>Food</th><th>Steel</th>                                    <th>Jobs</th>                                    </tr>                                    <tr id='total'>                                    <td>Total</td>                                    <td id='cash'>0</td><td id='cement'>0</td>                                    <td id='food'>0</td><td id='steel'>0</td>                                    <td id='jobs'></td>                                    </tr>"),e.append($("<div></div>").addClass("stats").attr("id","stats")),this.listen("jobs:update",this.updateOverview),this.listen("cities:update",this.updateOverview),this.listen("resources:update",this.updateOverview),this.listen("stats:update",this.updateStats),this.updateOverview(),this.updateStats()},updateOverview:function(){var e=$("#overview_table"),t=e.find("#total"),i=this.numberToString;if(this.cities){for(var s={},n=0;n<this.cities.length;n++){var a=this.cities[n];if(a&&a.type){var o=e.find("#"+a.type);if(0===o.length&&(t.before("                             <tr id='"+a.type+"'>                             <td>"+a.type+"</td>                             <td id='cash'>0</td><td id='cement'>0</td>                             <td id='food'>0</td><td id='steel'>0</td>                             <td id='jobs'></td>                             </tr>"),o=e.find("#"+a.type)),a.resources&&$.each(a.resources,function(e,t){var n=s[e]||0;n+=parseInt(t,10),s[e]=n,o.find("#"+e).html(i(t))}),a.jobs){var r,d,l,c,u;r=d=l=c=u="&nbsp;";for(var h=0;h<a.jobs.length;h++)"research"==a.jobs[h].queue&&(d="R"),"building"==a.jobs[h].queue&&(r="B"),"units"==a.jobs[h].queue&&(l="U"),"defense_units"==a.jobs[h].queue&&(c="D"),"march"==a.jobs[h].queue&&(u="M");o.find("#jobs").html("("+a.jobs.length+") "+r+" "+d+" "+l+" "+c+" "+u)}}}$.each(s,function(e,s){t.find("#"+e).html(i(s))})}}};if($&&$("#game_frame")&&($("#game_frame").width("1281px"),setTimeout(function(){location.reload()},72e5)),GM_addStyle(css),-1!=window.location.href.indexOf("platforms/facebook/game")){combine(bot,attackBot,bondsBot,buildBot,itemBot,cityscapeBot,reportBot,trainBot,bailoutBot,collectBot,prizeBot,researchBot,optionsBot,parserBot,queueBot,debugBot,utilBot,armorBot,ajaxBot,financierBot),guiBot&&combine(bot,guiBot),bot.attackUnits=attackUnits,bot.defenseUnits=defenseUnits,bot.buildings=buildings,bot.research=research,bot.items=items;var src=convertToSource(bot);src="var underboss = "+src+";\n",src+="underboss.start();",inject(src)}